<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LegacyMap Generator — Higgins Estate Planning</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #f6f4ef;
    --bg2: #efecea;
    --border: #d8d2c4;
    --tx: #2c2a26;
    --txl: #8a847a;
    --ac: #1a5c3a;
    --acl: #e8f2ec;
    --wa: #b8860b;
    --wal: #fef8ec;
    --da: #b03a2e;
    --dal: #fbeae8;
    --white: #ffffff;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    color: var(--tx);
  }

  /* ── HEADER ── */
  header {
    background: #1c2a1e;
    padding: 18px 40px;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .header-monogram {
    width: 32px; height: 32px;
    border-radius: 50%;
    border: 1.5px solid rgba(255,255,255,.3);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px; color: rgba(255,255,255,.8);
    flex-shrink: 0;
  }
  .header-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 18px; font-weight: 400;
    color: rgba(255,255,255,.85);
    letter-spacing: 0.3px;
  }
  .header-sub {
    font-size: 11px;
    color: rgba(255,255,255,.4);
    margin-left: auto;
    font-weight: 300;
    letter-spacing: 0.5px;
  }

  /* ── MAIN LAYOUT ── */
  main {
    max-width: 860px;
    margin: 0 auto;
    padding: 48px 24px 80px;
  }

  /* ── INTRO ── */
  .intro {
    margin-bottom: 40px;
  }
  .intro h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 34px; font-weight: 300;
    letter-spacing: -0.5px;
    line-height: 1.2;
    margin-bottom: 12px;
    color: var(--tx);
  }
  .intro h1 em {
    font-style: italic;
    color: var(--ac);
  }
  .intro p {
    font-size: 14px;
    color: var(--txl);
    line-height: 1.7;
    max-width: 620px;
  }

  /* ── STEPS ── */
  .steps {
    display: flex;
    gap: 0;
    margin-bottom: 36px;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: var(--white);
  }
  .step {
    flex: 1;
    padding: 18px 20px;
    border-right: 1px solid var(--border);
    position: relative;
  }
  .step:last-child { border-right: none; }
  .step-num {
    font-size: 10px;
    font-weight: 500;
    color: var(--txl);
    letter-spacing: 1.2px;
    text-transform: uppercase;
    margin-bottom: 5px;
  }
  .step-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    font-weight: 500;
    color: var(--tx);
    margin-bottom: 4px;
  }
  .step-desc {
    font-size: 11.5px;
    color: var(--txl);
    line-height: 1.5;
  }
  .step-active .step-num { color: var(--ac); }
  .step-active .step-title { color: var(--ac); }
  .step-active::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--ac);
  }

  /* ── CARD ── */
  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 28px 32px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,.04);
  }
  .card-label {
    font-size: 10px;
    font-weight: 500;
    color: var(--txl);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }
  .card h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px; font-weight: 400;
    margin-bottom: 8px;
  }
  .card p {
    font-size: 13px;
    color: var(--txl);
    line-height: 1.6;
    margin-bottom: 16px;
  }

  /* ── TEXTAREA ── */
  textarea {
    width: 100%;
    height: 320px;
    border: 1.5px solid var(--border);
    border-radius: 6px;
    padding: 16px 18px;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
    font-size: 12px;
    line-height: 1.6;
    color: var(--tx);
    background: #fdfcf8;
    resize: vertical;
    outline: none;
    transition: border-color .2s;
  }
  textarea:focus {
    border-color: var(--ac);
  }
  textarea::placeholder {
    color: var(--txl);
    opacity: 0.6;
  }

  /* ── VALIDATION ── */
  .validation {
    margin-top: 10px;
    font-size: 12px;
    min-height: 20px;
    transition: all .2s;
  }
  .validation.ok    { color: var(--ac); }
  .validation.error { color: var(--da); }
  .validation.warn  { color: var(--wa); }

  /* ── BUTTONS ── */
  .actions {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-top: 20px;
  }
  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 13px 28px;
    background: #1c2a1e;
    color: rgba(255,255,255,.9);
    border: none;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    font-weight: 500;
    cursor: pointer;
    transition: all .2s;
    letter-spacing: 0.2px;
  }
  .btn-primary:hover { background: #253528; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.15); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
  .btn-secondary {
    padding: 12px 20px;
    background: transparent;
    color: var(--txl);
    border: 1px solid var(--border);
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all .2s;
  }
  .btn-secondary:hover { border-color: var(--tx); color: var(--tx); }

  /* ── SUCCESS STATE ── */
  .success-card {
    background: var(--acl);
    border: 1px solid var(--ac) + '22';
    border-radius: 8px;
    padding: 28px 32px;
    display: none;
    animation: fadeUp .3s ease;
  }
  .success-card.visible { display: block; }
  .success-icon {
    width: 40px; height: 40px;
    border-radius: 50%;
    background: var(--ac);
    color: white;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    margin-bottom: 14px;
  }
  .success-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px; font-weight: 400;
    color: var(--ac);
    margin-bottom: 6px;
  }
  .success-card p {
    font-size: 13px;
    color: var(--ac);
    opacity: 0.8;
    line-height: 1.6;
    margin-bottom: 16px;
  }
  .btn-download {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: var(--ac);
    color: white;
    border: none;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    transition: all .2s;
  }
  .btn-download:hover { background: #154d30; transform: translateY(-1px); }

  /* ── HIGGINS NOTE ── */
  .higgins-note {
    margin-top: 36px;
    padding: 20px 24px;
    border-left: 3px solid var(--border);
    background: var(--white);
    border-radius: 0 6px 6px 0;
  }
  .higgins-note p {
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    font-style: italic;
    color: var(--txl);
    line-height: 1.7;
  }
  .higgins-note cite {
    display: block;
    margin-top: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: var(--txl);
    opacity: 0.7;
    letter-spacing: 0.5px;
    font-style: normal;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(6px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<header>
  <div class="header-monogram">H</div>
  <div class="header-title">LegacyMap Generator</div>
  <div class="header-sub">Higgins Estate Planning System</div>
</header>

<main>

  <div class="intro">
    <h1>Generate your <em>LegacyMap</em></h1>
    <p>Paste the data block from your Higgins conversation below, click Generate, and download your complete interactive estate plan dashboard.</p>
  </div>

  <div class="steps">
    <div class="step step-active">
      <div class="step-num">Step 01</div>
      <div class="step-title">Copy from Higgins</div>
      <div class="step-desc">At the end of your conversation, ask Higgins to "generate my LegacyMap data block."</div>
    </div>
    <div class="step">
      <div class="step-num">Step 02</div>
      <div class="step-title">Paste below</div>
      <div class="step-desc">Paste the JavaScript data block into the field below.</div>
    </div>
    <div class="step">
      <div class="step-num">Step 03</div>
      <div class="step-title">Download & open</div>
      <div class="step-desc">Click Generate. Save the file. Open in any browser.</div>
    </div>
  </div>

  <div class="card">
    <div class="card-label">Your LegacyMap Data</div>
    <h2>Paste the data block here</h2>
    <p>The data block starts with <code>const { useState } = React;</code> and ends with the comment <code>/* DO NOT EDIT BELOW THIS LINE */</code>. Paste everything between those markers.</p>
    <textarea id="dataInput" placeholder="const { useState } = React;&#10;&#10;/* --- WHO --- */&#10;const family = {&#10;  client: { name: &quot;...&quot;, age: 55 },&#10;  ...&#10;}"></textarea>
    <div class="validation" id="validation"></div>
    <div class="actions">
      <button class="btn-primary" id="generateBtn" onclick="generate()">
        <span>&#9654;</span> Generate LegacyMap
      </button>
      <button class="btn-secondary" onclick="loadSample()">Load sample data</button>
    </div>
  </div>

  <div class="success-card" id="successCard">
    <div class="success-icon">&#10003;</div>
    <h3>Your LegacyMap is ready.</h3>
    <p>Save the file to your computer and open it in any browser. You will find seven interactive tabs covering your complete estate plan picture.</p>
    <a class="btn-download" id="downloadLink" href="#" download="LegacyMap.html">
      &#8595; Download LegacyMap.html
    </a>
  </div>

  <div class="higgins-note">
    <p>"The LegacyMap is not the plan itself — it is the clearest possible picture of where things stand and what remains to be done. A document of this quality, walked into an attorney's office, is worth considerably more than an hour of unprepared conversation."</p>
    <cite>— Jonathan Quayle Higgins III</cite>
  </div>

</main>

<script>
const HEAD_B64 = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+TGVnYWN5TWFwIHwgSGlnZ2lucyBFc3RhdGUgUGxhbm5pbmc8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvcmVhY3QvMTguMi4wL3VtZC9yZWFjdC5wcm9kdWN0aW9uLm1pbi5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9yZWFjdC1kb20vMTguMi4wL3VtZC9yZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanMiPjwvc2NyaXB0Pgo8c2NyaXB0PgooZnVuY3Rpb24oKXt2YXIgdz1jb25zb2xlLndhcm47Y29uc29sZS53YXJuPWZ1bmN0aW9uKCl7aWYoYXJndW1lbnRzWzBdJiZ0eXBlb2YgYXJndW1lbnRzWzBdPT09J3N0cmluZycmJmFyZ3VtZW50c1swXS5pbmRleE9mKCdwcmVjb21waWxlJyk+LTEpcmV0dXJuO3cuYXBwbHkoY29uc29sZSxhcmd1bWVudHMpO319KSgpOwo8L3NjcmlwdD4KPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2JhYmVsLXN0YW5kYWxvbmUvNy4yMy45L2JhYmVsLm1pbi5qcyI+PC9zY3JpcHQ+CjxzdHlsZT4KICAqIHsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9CiAgYm9keSB7IGZvbnQtZmFtaWx5OiAnSW93YW4gT2xkIFN0eWxlJywgJ1BhbGF0aW5vIExpbm90eXBlJywgUGFsYXRpbm8sIEdlb3JnaWEsIHNlcmlmOyB9CiAgI3Jvb3QgeyBtaW4taGVpZ2h0OiAxMDB2aDsgfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJyb290Ij48L2Rpdj4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2JhYmVsIj4K';
const COMP_B64 = 'LyogPT09PT09PT09PT0gVVRJTCA9PT09PT09PT09PSAqLwpjb25zdCBmbXQgPSAodikgPT4geyBpZiAodiA+PSAxZTYpIHJldHVybiAiJCIgKyAodiAvIDFlNikudG9GaXhlZCgxKSArICJNIjsgaWYgKHYgPj0gMWUzKSByZXR1cm4gIiQiICsgKHYgLyAxZTMpLnRvRml4ZWQoMCkgKyAiSyI7IHJldHVybiAiJCIgKyB2OyB9Owpjb25zdCBmbXRGID0gKHYpID0+ICIkIiArIHYudG9Mb2NhbGVTdHJpbmcoKTsKY29uc3QgQyA9IHsgYmc6IiNmNmY0ZWYiLCBiTDoiI2U4ZTRkYiIsIGJvcmRlcjoiI2Q4ZDJjNCIsIHR4OiIjMmMyYTI2IiwgdHhNOiIjNWE1NjRlIiwgdHhMOiIjOGE4NDdhIiwgdHhGOiIjYjBhOTllIiwgYWM6IiMxYTVjM2EiLCBhY0w6IiNlOGYyZWMiLCB3YToiI2I4ODYwYiIsIHdhTDoiI2ZlZjhlYyIsIHdhQmc6IiNmZGYzZGEiLCBkYToiI2IwM2EyZSIsIGRhTDoiI2ZiZWFlOCIsIGJsOiIjMmE1YThjIiwgYmxMOiIjZThmMGY4IiwgcHU6IiM2YTRhOGEiLCBwdUw6IiNmMGVjZjQiIH07CmNvbnN0IGNhdE1ldGEgPSB7CiAgImluLXRydXN0IjogeyBsYWJlbDogIlRpdGxlZCBpbiBUcnVzdCIsIHNob3J0OiAiSU4gVFJVU1QiLCBjb2xvcjogQy5hYywgYmc6IEMuYWNMIH0sCiAgInJldGl0bGUiOiB7IGxhYmVsOiAiTmVlZHMgUmUtVGl0bGluZyIsIHNob3J0OiAiUkUtVElUTEUiLCBjb2xvcjogQy53YSwgYmc6IEMud2FCZyB9LAogICJiZW5lZmljaWFyeSI6IHsgbGFiZWw6ICJCZW5lZmljaWFyeSBEZXNpZ25hdGlvbiIsIHNob3J0OiAiQkVORUYuIERFU0lHLiIsIGNvbG9yOiBDLmJsLCBiZzogQy5ibEwgfSwKICAiY3VzdG9kaWFsIjogeyBsYWJlbDogIkN1c3RvZGlhbCBBY2NvdW50Iiwgc2hvcnQ6ICJDVVNUT0RJQUwiLCBjb2xvcjogQy5wdSwgYmc6IEMucHVMIH0sCn07CgovKiA9PT09PT09PT09PSBTSEFSRUQgPT09PT09PT09PT0gKi8KZnVuY3Rpb24gVlQoe3QsIHN9KSB7IHJldHVybiAoPGRpdiBzdHlsZT17e21hcmdpbkJvdHRvbToyMH19PjxoMiBzdHlsZT17e2ZvbnRTaXplOjIyLGZvbnRXZWlnaHQ6NDAwLG1hcmdpbjoiMCAwIDNweCIsbGV0dGVyU3BhY2luZzotMC4zfX0+e3R9PC9oMj48cCBzdHlsZT17e2ZvbnRTaXplOjEzLjUsY29sb3I6Qy50eEwsbWFyZ2luOjB9fT57c308L3A+PC9kaXY+KTsgfQpmdW5jdGlvbiBDZCh7Y2hpbGRyZW4sIHN0eWxlOiBzeH0pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7cGFkZGluZzoiMThweCAyMnB4IixiYWNrZ3JvdW5kOiIjZmZmIixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjFweCBzb2xpZCAiK0MuYkwsYm94U2hhZG93OiIwIDFweCAycHggcmdiYSgwLDAsMCwuMDMpIiwuLi4oc3h8fHt9KX19PntjaGlsZHJlbn08L2Rpdj4pOyB9CmZ1bmN0aW9uIENMKHtjaGlsZHJlbn0pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMudHhMLGxldHRlclNwYWNpbmc6MC45LHRleHRUcmFuc2Zvcm06InVwcGVyY2FzZSIsZm9udEZhbWlseToic2Fucy1zZXJpZiIsZm9udFdlaWdodDo1MDB9fT57Y2hpbGRyZW59PC9kaXY+KTsgfQpmdW5jdGlvbiBNUyh7bCwgdiwgY30pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7ZmxleDoxfX0+PGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEx9fT57bH08L2Rpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTcsZm9udFdlaWdodDo0MDAsY29sb3I6Y319Pnt2fTwvZGl2PjwvZGl2Pik7IH0KZnVuY3Rpb24gU0RvdCh7c30pIHsgY29uc3QgY289e2N1cnJlbnQ6Qy5hYyxvdXRkYXRlZDpDLndhLHByb3Bvc2VkOkMuYmwscGxhbm5lZDpDLmFjLGFuYWx5c2lzOkMucHV9OyByZXR1cm4gKDxkaXYgc3R5bGU9e3t3aWR0aDo2LjUsaGVpZ2h0OjYuNSxib3JkZXJSYWRpdXM6IjUwJSIsYmFja2dyb3VuZDpjb1tzXXx8Qy50eEYsZmxleFNocmluazowfX0gLz4pOyB9CmZ1bmN0aW9uIERSKHtsLCB2LCB2Y30pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6InNwYWNlLWJldHdlZW4iLHBhZGRpbmc6IjNweCAwIixmb250U2l6ZToxMS41fX0+PHNwYW4gc3R5bGU9e3tjb2xvcjpDLnR4TH19PntsfTwvc3Bhbj48c3BhbiBzdHlsZT17e2NvbG9yOnZjfHxDLnR4TSxmb250V2VpZ2h0OjUwMCx0ZXh0QWxpZ246InJpZ2h0IixtYXhXaWR0aDoiNjUlIn19Pnt2fTwvc3Bhbj48L2Rpdj4pOyB9CmZ1bmN0aW9uIFdOKHtsLCB2LCBjbywgc20sIGUsIGNrLCBkfSkgeyByZXR1cm4gKDxkaXYgb25DbGljaz17Y2t9IHN0eWxlPXt7cGFkZGluZzpzbT8iMTBweCAxNnB4IjoiMTFweCAyMnB4Iixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjEuNXB4IHNvbGlkICIrY28rIjQ0IixiYWNrZ3JvdW5kOmU/Y28rIjA4IjoiI2ZmZiIsdGV4dEFsaWduOiJjZW50ZXIiLG1pbldpZHRoOnNtPzE0MDoyMDAsY3Vyc29yOmQ/InBvaW50ZXIiOiJkZWZhdWx0Iix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PjxkaXYgc3R5bGU9e3tmb250U2l6ZTpzbT8xMDoxMSxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206MX19PntsfTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZTpzbT8xNzoyMSxmb250V2VpZ2h0OjMwMCxjb2xvcjpjb319PntmbXQodil9PC9kaXY+e2QmJjxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy50eEYsbWFyZ2luVG9wOjF9fT57ZT8iY29sbGFwc2UiOiJkZXRhaWxzIn08L2Rpdj59e2UmJmQmJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6OCxwYWRkaW5nOiI4cHggMTBweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGZvbnRTaXplOjExLjUsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjUsdGV4dEFsaWduOiJsZWZ0IixhbmltYXRpb246InZmIC4xNXMgZWFzZSJ9fT57ZH08L2Rpdj59PC9kaXY+KTsgfQpmdW5jdGlvbiBGQSh7bCwgY299KSB7IGNvbnN0IGNvbG9yPWNvfHxDLnR4RjsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZmxleERpcmVjdGlvbjoiY29sdW1uIixhbGlnbkl0ZW1zOiJjZW50ZXIiLHBhZGRpbmc6IjNweCAwIn19PjxkaXYgc3R5bGU9e3t3aWR0aDoxLjUsaGVpZ2h0OjE0LGJhY2tncm91bmQ6Y29sb3IrIjQ0In19IC8+e2wmJjxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Y29sb3IscGFkZGluZzoiMnB4IDdweCIsYmFja2dyb3VuZDpjb2xvcisiMDgiLGJvcmRlclJhZGl1czozLG1hcmdpbjoiMS41cHggMCIsbWF4V2lkdGg6NDAwLHRleHRBbGlnbjoiY2VudGVyIixsaW5lSGVpZ2h0OjEuM319PntsfTwvZGl2Pn08ZGl2IHN0eWxlPXt7d2lkdGg6MCxoZWlnaHQ6MCxib3JkZXJMZWZ0OiI0LjVweCBzb2xpZCB0cmFuc3BhcmVudCIsYm9yZGVyUmlnaHQ6IjQuNXB4IHNvbGlkIHRyYW5zcGFyZW50Iixib3JkZXJUb3A6IjUuNXB4IHNvbGlkICIrY29sb3IrIjY2In19IC8+PC9kaXY+KTsgfQpmdW5jdGlvbiBTQmFkZ2Uoe3QsIGNvfSkgeyByZXR1cm4gKDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDotNyxyaWdodDoxMCxwYWRkaW5nOiIxLjVweCA3cHgiLGJhY2tncm91bmQ6Y28sY29sb3I6IiNmZmYiLGZvbnRTaXplOjguNSxib3JkZXJSYWRpdXM6MyxsZXR0ZXJTcGFjaW5nOjAuNyxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixmb250V2VpZ2h0OjYwMCx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UifX0+e3R9PC9kaXY+KTsgfQpmdW5jdGlvbiBHQyh7bCwgcCwgbiwgY299KSB7IHJldHVybiAoPGRpdiBzdHlsZT17e3RleHRBbGlnbjoiY2VudGVyIixtYXhXaWR0aDoyMDB9fT48ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOmNvLGxldHRlclNwYWNpbmc6MC42LGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGZvbnRXZWlnaHQ6NTAwLG1hcmdpbkJvdHRvbTo4fX0+e2x9PC9kaXY+e3AubWFwKCh4LGkpPT4oPGRpdiBrZXk9e2l9IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eE0sbWFyZ2luQm90dG9tOjJ9fT57eH08L2Rpdj4pKX08ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAuNSxjb2xvcjpDLnR4RixtYXJnaW5Ub3A6NixsaW5lSGVpZ2h0OjEuNCxmb250U3R5bGU6Iml0YWxpYyJ9fT57bn08L2Rpdj48L2Rpdj4pOyB9CmZ1bmN0aW9uIFBCKHtuLCBhfSkgeyByZXR1cm4gKDxkaXYgc3R5bGU9e3t0ZXh0QWxpZ246ImNlbnRlciJ9fT48ZGl2IHN0eWxlPXt7d2lkdGg6NDIsaGVpZ2h0OjQyLGJvcmRlclJhZGl1czoiNTAlIixiYWNrZ3JvdW5kOkMuYWNMLGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsbWFyZ2luOiIwIGF1dG8gNHB4Iixmb250U2l6ZToxNCxjb2xvcjpDLmFjLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGZvbnRXZWlnaHQ6NjAwfX0+e24uY2hhckF0KDApfTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxmb250V2VpZ2h0OjUwMH19PntufTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhMfX0+eyJBZ2UgIithfTwvZGl2PjwvZGl2Pik7IH0KCi8qID09PT09PT09PT09IFYxOiBQTEFOIFNOQVBTSE9UID09PT09PT09PT09ICovCmZ1bmN0aW9uIFYxKCkgewogIGNvbnN0IFtleHBQcmksIHNldEV4cFByaV0gPSB1c2VTdGF0ZShudWxsKTsKCiAgcmV0dXJuICg8ZGl2PgogICAgPFZUIHQ9IlBsYW4gU25hcHNob3QiIHM9e3BsYW5Qcm9maWxlICsgIiAtLSAiICsgcmVwb3J0RGF0ZX0gLz4KCiAgICB7LyogSGVhZGxpbmUgKi99CiAgICA8Q2Qgc3R5bGU9e3ttYXJnaW5Cb3R0b206MTYsYm9yZGVyTGVmdDoiM3B4IHNvbGlkICIrQy5hY319PgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiZmxleC1zdGFydCIsZ2FwOjE0fX0+CiAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjM2LGhlaWdodDozNixib3JkZXJSYWRpdXM6IjUwJSIsYmFja2dyb3VuZDpDLmFjTCxkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGp1c3RpZnlDb250ZW50OiJjZW50ZXIiLGZvbnRTaXplOjE2LGNvbG9yOkMuYWMsZmxleFNocmluazowLG1hcmdpblRvcDoyfX0+JiMxMDAwMzs8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjE1LGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMudHgsbGluZUhlaWdodDoxLjN9fT57aGVhZGxpbmUudGl0bGV9PC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6NCxsaW5lSGVpZ2h0OjEuNn19PntoZWFkbGluZS5ib2R5fTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvQ2Q+CgogICAgey8qIEdhdWdlcyArIEZhbWlseSAqL30KICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJncmlkIixncmlkVGVtcGxhdGVDb2x1bW5zOiIyODBweCAxZnIiLGdhcDoxNixtYXJnaW5Cb3R0b206MTZ9fT4KICAgICAgPENkPgogICAgICAgIDxDTD5QbGFuIEhlYWx0aDwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDoxNixtYXJnaW5Ub3A6MTB9fT4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmbGV4OjEsdGV4dEFsaWduOiJjZW50ZXIifX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoicmVsYXRpdmUiLHdpZHRoOjgwLGhlaWdodDo4MCxtYXJnaW46IjAgYXV0byA2cHgifX0+CiAgICAgICAgICAgICAgPHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCI+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzQiIGZpbGw9Im5vbmUiIHN0cm9rZT17Qy5iTH0gc3Ryb2tlV2lkdGg9IjUiLz48Y2lyY2xlIGN4PSI0MCIgY3k9IjQwIiByPSIzNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPXtDLmFjfSBzdHJva2VXaWR0aD0iNSIgc3Ryb2tlRGFzaGFycmF5PXsoc3RyYXRlZ3lTY29yZS8xMDApKjIxMy42KyIgMjEzLjYifSBzdHJva2VMaW5lY2FwPSJyb3VuZCIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwIDQwIDQwKSIvPjwvc3ZnPgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDoiNTAlIixsZWZ0OiI1MCUiLHRyYW5zZm9ybToidHJhbnNsYXRlKC01MCUsLTUwJSkiLHRleHRBbGlnbjoiY2VudGVyIn19PjxkaXYgc3R5bGU9e3tmb250U2l6ZToyMixmb250V2VpZ2h0OjMwMCxjb2xvcjpDLmFjLGxpbmVIZWlnaHQ6MX19PntzdHJhdGVneVNjb3JlfTwvZGl2PjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMuYWN9fT5TdHJhdGVneTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMudHhGLG1hcmdpblRvcDoxfX0+QXJjaGl0ZWN0dXJlIHF1YWxpdHk8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZsZXg6MSx0ZXh0QWxpZ246ImNlbnRlciJ9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e3Bvc2l0aW9uOiJyZWxhdGl2ZSIsd2lkdGg6ODAsaGVpZ2h0OjgwLG1hcmdpbjoiMCBhdXRvIDZweCJ9fT4KICAgICAgICAgICAgICA8c3ZnIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48Y2lyY2xlIGN4PSI0MCIgY3k9IjQwIiByPSIzNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iNSIvPjxjaXJjbGUgY3g9IjQwIiBjeT0iNDAiIHI9IjM0IiBmaWxsPSJub25lIiBzdHJva2U9e0Mud2F9IHN0cm9rZVdpZHRoPSI1IiBzdHJva2VEYXNoYXJyYXk9eyhleGVjdXRpb25TY29yZS8xMDApKjIxMy42KyIgMjEzLjYifSBzdHJva2VMaW5lY2FwPSJyb3VuZCIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwIDQwIDQwKSIvPjwvc3ZnPgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDoiNTAlIixsZWZ0OiI1MCUiLHRyYW5zZm9ybToidHJhbnNsYXRlKC01MCUsLTUwJSkiLHRleHRBbGlnbjoiY2VudGVyIn19PjxkaXYgc3R5bGU9e3tmb250U2l6ZToyMixmb250V2VpZ2h0OjMwMCxjb2xvcjpDLndhLGxpbmVIZWlnaHQ6MX19PntleGVjdXRpb25TY29yZX08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMSxmb250V2VpZ2h0OjYwMCxjb2xvcjpDLndhfX0+RXhlY3V0aW9uPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy50eEYsbWFyZ2luVG9wOjF9fT5JbXBsZW1lbnRhdGlvbiBzdGF0dXM8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTIscGFkZGluZzoiOHB4IDEwcHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NX19PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjUsdGV4dEFsaWduOiJjZW50ZXIifX0+VGhlIGdhcCBiZXR3ZWVuIHRoZXNlIHR3byBudW1iZXJzIGlzIHRoZSBvcHBvcnR1bml0eS48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9DZD4KICAgICAgPENkPgogICAgICAgIDxDTD5QbGFubmluZyBVbml0PC9DTD4KICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiY2VudGVyIixnYXA6MjQsbWFyZ2luVG9wOjYsZmxleFdyYXA6IndyYXAifX0+CiAgICAgICAgICA8UEIgbj17ZmFtaWx5LmNsaWVudC5uYW1lfSBhPXtmYW1pbHkuY2xpZW50LmFnZX0gLz4KICAgICAgICAgIHtmYW1pbHkuc3BvdXNlICYmICg8PjxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTQsY29sb3I6Qy50eEYsZm9udEZhbWlseToic2Fucy1zZXJpZiJ9fT4rPC9zcGFuPjxQQiBuPXtmYW1pbHkuc3BvdXNlLm5hbWV9IGE9e2ZhbWlseS5zcG91c2UuYWdlfSAvPjwvPil9CiAgICAgICAgICB7ZmFtaWx5LmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luTGVmdDo0LGJvcmRlckxlZnQ6IjFweCBzb2xpZCAiK0MuYkwscGFkZGluZ0xlZnQ6MTh9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAsY29sb3I6Qy50eEwsbWFyZ2luQm90dG9tOjQsZm9udEZhbWlseToic2Fucy1zZXJpZiIsdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixsZXR0ZXJTcGFjaW5nOjAuOH19PkNoaWxkcmVuPC9kaXY+CiAgICAgICAgICAgICAge2ZhbWlseS5jaGlsZHJlbi5tYXAoKGMsaSk9Pig8ZGl2IGtleT17aX0gc3R5bGU9e3tmb250U2l6ZToxMi41LG1hcmdpbkJvdHRvbToyLGNvbG9yOkMudHhNfX0+CiAgICAgICAgICAgICAgICB7Yy5uYW1lfXtjLnNwb3VzZSYmPHNwYW4gc3R5bGU9e3tjb2xvcjpDLnR4Rn19PnsiIGFuZCAiK2Muc3BvdXNlfTwvc3Bhbj59CiAgICAgICAgICAgICAgICB7Yy5nYyYmYy5nYy5sZW5ndGg+MCYmPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMuZGEsbWFyZ2luTGVmdDo1fX0+KHtjLmdjLmpvaW4oIiwgIil9KTwvc3Bhbj59CiAgICAgICAgICAgICAgPC9kaXY+KSl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKX0KICAgICAgICA8L2Rpdj4KICAgICAgPC9DZD4KICAgIDwvZGl2PgoKICAgIHsvKiBGb3VuZGF0aW9uIC8gRXhlY3V0aW9uICovfQogICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImdyaWQiLGdyaWRUZW1wbGF0ZUNvbHVtbnM6IjFmciAxZnIiLGdhcDoxNixtYXJnaW5Cb3R0b206MTZ9fT4KICAgICAgPENkIHN0eWxlPXt7Ym9yZGVyVG9wOiIzcHggc29saWQgIitDLmFjfX0+CiAgICAgICAgPENMPldoYXQncyBpbiBQbGFjZTwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4fX0+CiAgICAgICAgICB7Zm91bmRhdGlvbkl0ZW1zLm1hcCgoaXRlbSxpKT0+KAogICAgICAgICAgICA8ZGl2IGtleT17aX0gc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6OCxwYWRkaW5nOiI1cHggMCIsYm9yZGVyQm90dG9tOmk8Zm91bmRhdGlvbkl0ZW1zLmxlbmd0aC0xPyIxcHggc29saWQgIitDLmJMOiJub25lIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tjb2xvcjpDLmFjLGZvbnRTaXplOjExLG1hcmdpblRvcDoxLGZsZXhTaHJpbms6MH19PiYjMTAwMDM7PC9kaXY+CiAgICAgICAgICAgICAgPGRpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eE0sZm9udFdlaWdodDo1MDB9fT57aXRlbS50fTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGLG1hcmdpblRvcDoxfX0+e2l0ZW0ubn08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApKX0KICAgICAgICAgIHtmb3VuZGF0aW9uSXRlbXMubGVuZ3RoPT09MCYmPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMudHhMLGZvbnRTdHlsZToiaXRhbGljIn19Pk5vIGZvdW5kYXRpb24gaXRlbXMgcmVjb3JkZWQgeWV0LjwvZGl2Pn0KICAgICAgICA8L2Rpdj4KICAgICAgPC9DZD4KICAgICAgPENkIHN0eWxlPXt7Ym9yZGVyVG9wOiIzcHggc29saWQgIitDLndhfX0+CiAgICAgICAgPENMPldoYXQgTmVlZHMgV29yazwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4fX0+CiAgICAgICAgICB7ZXhlY3V0aW9uSXRlbXMubWFwKChpdGVtLGkpPT4oCiAgICAgICAgICAgIDxkaXYga2V5PXtpfSBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDo4LHBhZGRpbmc6IjVweCAwIixib3JkZXJCb3R0b206aTxleGVjdXRpb25JdGVtcy5sZW5ndGgtMT8iMXB4IHNvbGlkICIrQy5iTDoibm9uZSJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Y29sb3I6Qy53YSxmb250U2l6ZToxMSxtYXJnaW5Ub3A6MSxmbGV4U2hyaW5rOjB9fT4mIzk2Nzk7PC9kaXY+CiAgICAgICAgICAgICAgPGRpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eE0sZm9udFdlaWdodDo1MDB9fT57aXRlbS50fTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGLG1hcmdpblRvcDoxfX0+e2l0ZW0ubn08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApKX0KICAgICAgICAgIHtleGVjdXRpb25JdGVtcy5sZW5ndGg9PT0wJiY8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMifX0+Tm8gZXhlY3V0aW9uIGl0ZW1zIHJlY29yZGVkIHlldC48L2Rpdj59CiAgICAgICAgPC9kaXY+CiAgICAgIDwvQ2Q+CiAgICA8L2Rpdj4KCiAgICB7LyogRXN0YXRlIGJhciAqL30KICAgIDxDZCBzdHlsZT17e21hcmdpbkJvdHRvbToxNn19PgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6InNwYWNlLWJldHdlZW4iLGFsaWduSXRlbXM6ImJhc2VsaW5lIn19PgogICAgICAgIDxkaXY+PENMPlRvdGFsIEVzdGF0ZTwvQ0w+PGRpdiBzdHlsZT17e2ZvbnRTaXplOjI4LGZvbnRXZWlnaHQ6MzAwLGxldHRlclNwYWNpbmc6LTEsbWFyZ2luVG9wOjJ9fT57Zm10KHRvdGFsRXN0YXRlKX08L2Rpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsY29sb3I6Qy50eEx9fT57ZG9taWNpbGVTdGF0ZSsiIHwgIityZXBvcnREYXRlfTwvZGl2PjwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6MTJ9fT4KICAgICAgICAgIDxNUyBsPSJJbiBUcnVzdCIgIHY9e2ZtdChpblRydXN0VmFsKX0gICAgICBjPXtDLmFjfSAvPgogICAgICAgICAgPE1TIGw9IlJlLVRpdGxlIiAgdj17Zm10KG5lZWRzUmV0aXRsZVZhbCl9ICBjPXtDLndhfSAvPgogICAgICAgICAgPE1TIGw9IkJlbmVmLiIgICAgdj17Zm10KGJlbmVmRGVzaWdWYWwpfSAgICBjPXtDLmJsfSAvPgogICAgICAgICAgPE1TIGw9IkN1c3RvZGlhbCIgdj17Zm10KGN1c3RvZGlhbFZhbCl9ICAgICBjPXtDLnB1fSAvPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAge3RvdGFsRXN0YXRlID4gMCAmJiAoPGRpdiBzdHlsZT17e21hcmdpblRvcDoxMCxoZWlnaHQ6Nyxib3JkZXJSYWRpdXM6NCxiYWNrZ3JvdW5kOkMuYkwsb3ZlcmZsb3c6ImhpZGRlbiIsZGlzcGxheToiZmxleCJ9fT4KICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6KGluVHJ1c3RWYWwvdG90YWxFc3RhdGUqMTAwKSsiJSIsYmFja2dyb3VuZDpDLmFjfX0gLz4KICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6KG5lZWRzUmV0aXRsZVZhbC90b3RhbEVzdGF0ZSoxMDApKyIlIixiYWNrZ3JvdW5kOkMud2F9fSAvPgogICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDooYmVuZWZEZXNpZ1ZhbC90b3RhbEVzdGF0ZSoxMDApKyIlIixiYWNrZ3JvdW5kOkMuYmx9fSAvPgogICAgICAgIDxkaXYgc3R5bGU9e3tmbGV4OjEsYmFja2dyb3VuZDpDLnB1KyI1NSJ9fSAvPgogICAgICA8L2Rpdj4pfQogICAgPC9DZD4KCiAgICB7LyogUHJpb3JpdGl6ZWQgQWN0aW9ucyAqL30KICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Cb3R0b206OH19PjxDTD5Qcmlvcml0aXplZCBBY3Rpb25zPC9DTD48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6Mn19Pk9yZ2FuaXplZCBieSB1cmdlbmN5LjwvZGl2PjwvZGl2PgogICAge3ByaW9yaXRpZXMubWFwKCh0aWVyLHRpKT0+KAogICAgICA8ZGl2IGtleT17dGl9IHN0eWxlPXt7bWFyZ2luQm90dG9tOjEyfX0+CiAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjgsbWFyZ2luQm90dG9tOjZ9fT4KICAgICAgICAgIDxkaXYgc3R5bGU9e3twYWRkaW5nOiIycHggOHB4IixiYWNrZ3JvdW5kOnRpZXIudGllckJnLGJvcmRlcjoiMXB4IHNvbGlkICIrdGllci50aWVyQ29sb3IrIjIyIixib3JkZXJSYWRpdXM6M319PgogICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEwLGZvbnRXZWlnaHQ6NzAwLGNvbG9yOnRpZXIudGllckNvbG9yLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGxldHRlclNwYWNpbmc6MC41fX0+e3RpZXIubGFiZWx9PC9zcGFuPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEZ9fT57dGllci5kZXNjfTwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8Q2Qgc3R5bGU9e3twYWRkaW5nOiIxMnB4IDE2cHgifX0+CiAgICAgICAgICB7dGllci5pdGVtcy5tYXAoKGl0ZW0saWkpPT57CiAgICAgICAgICAgIGNvbnN0IGlzRXhwID0gZXhwUHJpID09PSB0aSsiLSIraWk7CiAgICAgICAgICAgIHJldHVybiAoPGRpdiBrZXk9e2lpfSBvbkNsaWNrPXsoKT0+c2V0RXhwUHJpKGlzRXhwP251bGw6dGkrIi0iK2lpKX0gc3R5bGU9e3twYWRkaW5nOiI4cHggMCIsYm9yZGVyQm90dG9tOmlpPHRpZXIuaXRlbXMubGVuZ3RoLTE/IjFweCBzb2xpZCAiK0MuYkw6Im5vbmUiLGN1cnNvcjoicG9pbnRlciJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6InNwYWNlLWJldHdlZW4iLGFsaWduSXRlbXM6ImNlbnRlciJ9fT4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo4fX0+CiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDo3LGhlaWdodDo3LGJvcmRlclJhZGl1czoiNTAlIixiYWNrZ3JvdW5kOnRpZXIudGllckNvbG9yLGZsZXhTaHJpbms6MH19IC8+CiAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy50eCxmb250V2VpZ2h0OjUwMH19PntpdGVtLnRpdGxlfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAge2l0ZW0udmFsdWUmJjxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTEsY29sb3I6dGllci50aWVyQ29sb3IsZm9udFdlaWdodDo1MDB9fT57Zm10RihpdGVtLnZhbHVlKX08L3NwYW4+fQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEwLGNvbG9yOkMudHhGLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYifX0+e2l0ZW0uZXN0fTwvc3Bhbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICB7aXNFeHAmJig8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjYsbWFyZ2luTGVmdDoxNSxwYWRkaW5nOiI4cHggMTJweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGJvcmRlckxlZnQ6IjJweCBzb2xpZCAiK3RpZXIudGllckNvbG9yKyI0NCJ9fT4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMS41LGNvbG9yOkMudHhNLGxpbmVIZWlnaHQ6MS42fX0+e2l0ZW0ud2h5fTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEYsbWFyZ2luVG9wOjR9fT57IkVmZm9ydDogIitpdGVtLmVmZm9ydH08L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4pfQogICAgICAgICAgICA8L2Rpdj4pOwogICAgICAgICAgfSl9CiAgICAgICAgICB7dGllci5pdGVtcy5sZW5ndGg9PT0wJiY8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMiLHBhZGRpbmc6IjRweCAwIn19Pk5vIGl0ZW1zIGluIHRoaXMgdGllci48L2Rpdj59CiAgICAgICAgPC9DZD4KICAgICAgPC9kaXY+CiAgICApKX0KCiAgICB7LyogSGlnZ2lucyBub3RlICovfQogICAgPENkIHN0eWxlPXt7bWFyZ2luVG9wOjgsYm9yZGVyTGVmdDoiM3B4IHNvbGlkICIrQy5iTCxiYWNrZ3JvdW5kOkMuYmd9fT4KICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEzLGZvbnRTdHlsZToiaXRhbGljIixjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuN319PnsnIicraGlnZ2luc05vdGUrJyInfTwvZGl2PgogICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAuNSxjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6Nn19Pi0tIEpvbmF0aGFuIFF1YXlsZSBIaWdnaW5zIElJSTwvZGl2PgogICAgPC9DZD4KICA8L2Rpdj4pOwp9CgoKLyogPT09PT09PT09PT0gVjI6IEFTU0VUIE1BUCA9PT09PT09PT09PSAqLwpmdW5jdGlvbiBWMigpIHsKICBjb25zdCBbc2VsLCBzZXRTZWxdID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3QgW2ZsdCwgc2V0Rmx0XSA9IHVzZVN0YXRlKCJhbGwiKTsKICBjb25zdCBjYXRLZXlzID0gWyJhbGwiLCJpbi10cnVzdCIsInJldGl0bGUiLCJiZW5lZmljaWFyeSIsImN1c3RvZGlhbCJdOwogIGNvbnN0IGZsID0gZmx0ID09PSAiYWxsIiA/IGFzc2V0cyA6IGFzc2V0cy5maWx0ZXIoYSA9PiBhLmNhdGVnb3J5ID09PSBmbHQpOwogIGNvbnN0IG14ID0gTWF0aC5tYXgoLi4uYXNzZXRzLm1hcChhID0+IGEudmFsdWUpKTsKICByZXR1cm4gKDxkaXY+CiAgICA8VlQgdD0iQXNzZXQgTWFwIiBzPSJBc3NldHMgb3JnYW5pemVkIGJ5IGhvdyB0aGV5IGNvbm5lY3QgdG8gdGhlIHRydXN0LiBHcmVlbiA9IGRvbmUuIEFtYmVyID0gYWN0aW9uIG5lZWRlZC4gQmx1ZSA9IGJlbmVmaWNpYXJ5IGZvcm0uIFB1cnBsZSA9IGN1c3RvZGlhbC4iIC8+CiAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjgsbWFyZ2luQm90dG9tOjE4LGZsZXhXcmFwOiJ3cmFwIn19PgogICAgICB7Y2F0S2V5cy5tYXAoayA9PiB7CiAgICAgICAgY29uc3QgaXNBID0gZmx0ID09PSBrOwogICAgICAgIGNvbnN0IGcgPSBrID09PSAiYWxsIiA/IGFzc2V0cyA6IGFzc2V0cy5maWx0ZXIoYSA9PiBhLmNhdGVnb3J5ID09PSBrKTsKICAgICAgICBjb25zdCBndiA9IGcucmVkdWNlKChzLCBhKSA9PiBzICsgYS52YWx1ZSwgMCk7CiAgICAgICAgY29uc3QgbSA9IGsgPT09ICJhbGwiID8ge2xhYmVsOiJBbGwgQXNzZXRzIixjb2xvcjpDLnR4fSA6IGNhdE1ldGFba107CiAgICAgICAgcmV0dXJuICg8YnV0dG9uIGtleT17a30gb25DbGljaz17KCkgPT4ge3NldEZsdChrKTtzZXRTZWwobnVsbCk7fX0gc3R5bGU9e3tmbGV4OjEsbWluV2lkdGg6MTMwLHBhZGRpbmc6IjEwcHggMTRweCIsYmFja2dyb3VuZDppc0E/IiNmZmYiOkMuYmcrImRkIixib3JkZXI6IjFweCBzb2xpZCAiKyhpc0E/Qy5ib3JkZXI6InRyYW5zcGFyZW50IiksYm9yZGVyUmFkaXVzOjYsY3Vyc29yOiJwb2ludGVyIix0ZXh0QWxpZ246ImxlZnQiLGJveFNoYWRvdzppc0E/IjAgMXB4IDNweCByZ2JhKDAsMCwwLC4wNSkiOiJub25lIix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PgogICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjV9fT4KICAgICAgICAgICAge2shPT0iYWxsIiYmPGRpdiBzdHlsZT17e3dpZHRoOjgsaGVpZ2h0OjgsYm9yZGVyUmFkaXVzOjIsYmFja2dyb3VuZDptLmNvbG9yfX0gLz59CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMCxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIix0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UiLGxldHRlclNwYWNpbmc6MC42fX0+e20ubGFiZWx9PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToyMCxmb250V2VpZ2h0OjMwMCxtYXJnaW5Ub3A6MX19PntmbXQoZ3YpfTwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLGNvbG9yOkMudHhGfX0+e2cubGVuZ3RoKyIgYXNzZXQiKyhnLmxlbmd0aCE9PTE/InMiOiIiKX08L2Rpdj4KICAgICAgICA8L2J1dHRvbj4pOwogICAgICB9KX0KICAgIDwvZGl2PgogICAgPENkPgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZ3JpZCIsZ3JpZFRlbXBsYXRlQ29sdW1uczoicmVwZWF0KGF1dG8tZmlsbCxtaW5tYXgoMjIwcHgsMWZyKSkiLGdhcDo5fX0+CiAgICAgICAge2ZsLm1hcChhID0+IHsKICAgICAgICAgIGNvbnN0IGlzU2VsID0gc2VsID09PSBhLmlkOwogICAgICAgICAgY29uc3QgY20gPSBjYXRNZXRhW2EuY2F0ZWdvcnldOwogICAgICAgICAgcmV0dXJuICg8ZGl2IGtleT17YS5pZH0gb25DbGljaz17KCkgPT4gc2V0U2VsKGlzU2VsID8gbnVsbCA6IGEuaWQpfSBzdHlsZT17e3BhZGRpbmc6IjEycHggMTRweCIsYm9yZGVyUmFkaXVzOjYsYm9yZGVyOiIxcHggc29saWQgIisoaXNTZWw/Y20uY29sb3IrIjU1IjpDLmJMKSxiYWNrZ3JvdW5kOmlzU2VsP2NtLmNvbG9yKyIwOCI6IiNmZGZiZjYiLGN1cnNvcjoicG9pbnRlciIsdHJhbnNpdGlvbjoiYWxsIC4ycyIscG9zaXRpb246InJlbGF0aXZlIixvdmVyZmxvdzoiaGlkZGVuIn19PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7cG9zaXRpb246ImFic29sdXRlIixib3R0b206MCxsZWZ0OjAsaGVpZ2h0OjIuNSx3aWR0aDooYS52YWx1ZS9teCoxMDApKyIlIixiYWNrZ3JvdW5kOmNtLmNvbG9yKyIxOCJ9fSAvPgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6InNwYWNlLWJldHdlZW4iLGFsaWduSXRlbXM6ImZsZXgtc3RhcnQifX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLjUsZm9udFdlaWdodDo1MDAsY29sb3I6Qy50eCxsaW5lSGVpZ2h0OjEuMyxmbGV4OjF9fT57YS5uYW1lfTwvZGl2PgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6NyxwYWRkaW5nOiIycHggNXB4IixiYWNrZ3JvdW5kOmNtLmJnLGNvbG9yOmNtLmNvbG9yLGJvcmRlclJhZGl1czozLGZvbnRXZWlnaHQ6NjAwLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGxldHRlclNwYWNpbmc6MC41LGZsZXhTaHJpbms6MCxtYXJnaW5MZWZ0OjQsd2hpdGVTcGFjZToibm93cmFwIn19PntjbS5zaG9ydH08L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTksZm9udFdlaWdodDozMDAsbWFyZ2luVG9wOjN9fT57Zm10KGEudmFsdWUpfTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAuNSxjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6MX19PnthLnR5cGV9e2EubGlxdWlkPyIgfCBMaXF1aWQiOiIifTwvZGl2PgogICAgICAgICAgICB7YS5jYXRlZ29yeT09PSJiZW5lZmljaWFyeSImJmEuYmVuU3RhdHVzPT09InVwZGF0ZSImJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6NCxmb250U2l6ZToxMCxjb2xvcjpDLmJsLGZvbnRXZWlnaHQ6NTAwfX0+QmVuZWZpY2lhcnkgZGVzaWduYXRpb24gbmVlZHMgdXBkYXRlPC9kaXY+fQogICAgICAgICAgICB7YS5jYXRlZ29yeT09PSJyZXRpdGxlIiYmPGRpdiBzdHlsZT17e21hcmdpblRvcDo0LGZvbnRTaXplOjEwLGNvbG9yOkMud2EsZm9udFdlaWdodDo1MDB9fT5BY3Rpb246IHJlLXRpdGxlIHRvIHRydXN0PC9kaXY+fQogICAgICAgICAgICB7aXNTZWwmJig8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjEwLHBhZGRpbmdUb3A6OCxib3JkZXJUb3A6IjFweCBzb2xpZCAiK0MuYkwsYW5pbWF0aW9uOiJ2ZiAuMTVzIGVhc2UifX0+CiAgICAgICAgICAgICAgPERSIGw9IlZhbHVlIiB2PXtmbXRGKGEudmFsdWUpfSAvPgogICAgICAgICAgICAgIHthLm1vcnRnYWdlJiY8RFIgbD0iTW9ydGdhZ2UiIHY9e2ZtdEYoYS5tb3J0Z2FnZSl9IHZjPXtDLmRhfSAvPn0KICAgICAgICAgICAgICB7YS5tb3J0Z2FnZSYmPERSIGw9Ik5ldCBFcXVpdHkiIHY9e2ZtdEYoYS52YWx1ZS1hLm1vcnRnYWdlKX0gLz59CiAgICAgICAgICAgICAge2EuYmFzaXMhPW51bGwmJjxEUiBsPSJDb3N0IEJhc2lzIiB2PXtmbXRGKGEuYmFzaXMpfSAvPn0KICAgICAgICAgICAgICB7YS5iYXNpcyE9bnVsbCYmPERSIGw9IkJ1aWx0LUluIEdhaW4iIHY9e2ZtdEYoYS52YWx1ZS1hLmJhc2lzKX0gdmM9e0MuYmx9IC8+fQogICAgICAgICAgICAgIHthLmJlbmVmaWNpYXJ5JiY8RFIgbD0iQ3VycmVudCBCZW5lZmljaWFyeSIgdj17YS5iZW5lZmljaWFyeX0gLz59CiAgICAgICAgICAgICAge2EuYmVuU3RhdHVzPT09InVwZGF0ZSImJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6NCxwYWRkaW5nOiI1cHggOXB4IixiYWNrZ3JvdW5kOkMuYmxMLGJvcmRlclJhZGl1czo0LGZvbnRTaXplOjEwLjUsY29sb3I6Qy5ibCxsaW5lSGVpZ2h0OjEuNCxmb250V2VpZ2h0OjUwMH19PnsiQWN0aW9uOiAiK2EuYWN0aW9ufTwvZGl2Pn0KICAgICAgICAgICAgICB7YS5jYXRlZ29yeT09PSJyZXRpdGxlIiYmYS5hY3Rpb24mJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6NCxwYWRkaW5nOiI1cHggOXB4IixiYWNrZ3JvdW5kOkMud2FMLGJvcmRlclJhZGl1czo0LGZvbnRTaXplOjEwLjUsY29sb3I6Qy53YSxsaW5lSGVpZ2h0OjEuNCxmb250V2VpZ2h0OjUwMH19PnsiQWN0aW9uOiAiK2EuYWN0aW9ufTwvZGl2Pn0KICAgICAgICAgICAgICB7YS5ub3RlJiY8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjQscGFkZGluZzoiNXB4IDlweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo0LGZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEwsbGluZUhlaWdodDoxLjR9fT57YS5ub3RlfTwvZGl2Pn0KICAgICAgICAgICAgPC9kaXY+KX0KICAgICAgICAgIDwvZGl2Pik7CiAgICAgICAgfSl9CiAgICAgIDwvZGl2PgogICAgPC9DZD4KICA8L2Rpdj4pOwp9CgovKiA9PT09PT09PT09PSBWMzogV0FURVJGQUxMID09PT09PT09PT09ICovCmZ1bmN0aW9uIFYzKCkgewogIGNvbnN0IFttb2RlLCBzZXRNb2RlXSA9IHVzZVN0YXRlKCJmaXJzdCIpOwogIGNvbnN0IFtlbiwgc2V0RW5dICAgICA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IHsKICAgIGlzTWFycmllZCwgaGFzU3RhdGVUYXgsIHN0YXRlVGF4Tm90ZSwKICAgIGZpcnN0RGVhdGhGbG93LCBwb3J0YWJpbGl0eU5vdGUsIGZ1bmRpbmdHYXBOb3RlLAogICAgc2Vjb25kRGVhdGhEaXN0cmlidXRpb24sIHN1YnRydXN0c05vdGUsIGFkbWluQ29zdHMsCiAgICBiZW5lZmljaWFyeUNvbHVtbnMsCiAgfSA9IHdhdGVyZmFsbENvbmZpZzsKCiAgY29uc3QgbmV0RGlzdHJpYnV0YWJsZSA9IHRvdGFsRXN0YXRlIC0gbW9ydGdhZ2UgLSBhZG1pbkNvc3RzOwoKICAvKiBDb21wdXRlIGVhY2ggY29sdW1uJ3MgZGlzcGxheSB2YWx1ZS4KICAgICBQcmlvcml0eSBvcmRlcjoKICAgICAgIDEuIGZpeGVkQW1vdW50ICAtIGV4cGxpY2l0IGRvbGxhciBhbW91bnQgKHNwZWNpZmljIGdpZnRzLCBjaGFyaXR5KQogICAgICAgMi4gcGVyY2VudGFnZSAgIC0gZnJhY3Rpb24gb2YgbmV0RGlzdHJpYnV0YWJsZSAoZS5nLiAwLjUgZm9yIDUwJSkKICAgICAgIDMuIHJlc2lkdWUgICAgICAtIG5vIGZpeGVkQW1vdW50IG9yIHBlcmNlbnRhZ2U6IHNwbGl0cyB3aGF0J3MgbGVmdCBlcXVhbGx5CgogICAgIEZpeGVkIHRyYW5jaGVzIGFyZSBkZWR1Y3RlZCBmaXJzdCwgdGhlbiBwZXJjZW50YWdlIGNvbHMsIHRoZW4gcmVzaWR1ZSBjb2xzCiAgICAgc3BsaXQgd2hhdGV2ZXIgcmVtYWlucy4KICAqLwogIGNvbnN0IGZpeGVkVG90YWwgPSBiZW5lZmljaWFyeUNvbHVtbnMKICAgIC5maWx0ZXIoYyA9PiBjLmZpeGVkQW1vdW50KQogICAgLnJlZHVjZSgocywgYykgPT4gcyArIGMuZml4ZWRBbW91bnQsIDApOwoKICBjb25zdCBhZnRlckZpeGVkID0gTWF0aC5tYXgoMCwgbmV0RGlzdHJpYnV0YWJsZSAtIGZpeGVkVG90YWwpOwoKICBjb25zdCBwY3RUb3RhbCA9IGJlbmVmaWNpYXJ5Q29sdW1ucwogICAgLmZpbHRlcihjID0+ICFjLmZpeGVkQW1vdW50ICYmIGMucGVyY2VudGFnZSkKICAgIC5yZWR1Y2UoKHMsIGMpID0+IHMgKyBjLnBlcmNlbnRhZ2UsIDApOwogIGNvbnN0IHBjdERvbGxhclRvdGFsID0gTWF0aC5yb3VuZChhZnRlckZpeGVkICogTWF0aC5taW4ocGN0VG90YWwsIDEpKTsKCiAgY29uc3QgcmVzaWR1ZUNvbHMgPSBiZW5lZmljaWFyeUNvbHVtbnMuZmlsdGVyKGMgPT4gIWMuZml4ZWRBbW91bnQgJiYgIWMucGVyY2VudGFnZSk7CiAgY29uc3QgcmVzaWR1ZVBvb2wgPSBNYXRoLm1heCgwLCBhZnRlckZpeGVkIC0gcGN0RG9sbGFyVG90YWwpOwogIGNvbnN0IHBlclJlc2lkdWUgID0gcmVzaWR1ZUNvbHMubGVuZ3RoID4gMAogICAgPyBNYXRoLnJvdW5kKHJlc2lkdWVQb29sIC8gcmVzaWR1ZUNvbHMubGVuZ3RoKSA6IDA7CgogIGZ1bmN0aW9uIGNvbFZhbHVlKGNvbCkgewogICAgaWYgKGNvbC5maXhlZEFtb3VudCkgIHJldHVybiBjb2wuZml4ZWRBbW91bnQ7CiAgICBpZiAoY29sLnBlcmNlbnRhZ2UpICAgcmV0dXJuIE1hdGgucm91bmQoYWZ0ZXJGaXhlZCAqIGNvbC5wZXJjZW50YWdlKTsKICAgIHJldHVybiBwZXJSZXNpZHVlOwogIH0KICBmdW5jdGlvbiBjb2xDb2xvcihjb2wpIHsKICAgIGlmIChjb2wuZml4ZWRBbW91bnQpIHJldHVybiBDLndhOwogICAgcmV0dXJuIEMuYWM7CiAgfQogIGZ1bmN0aW9uIGNvbEVuS2V5KGNvbCwgaSkgewogICAgaWYgKGNvbC5maXhlZEFtb3VudCkgcmV0dXJuICJmIitpOwogICAgcmV0dXJuICJjIitpOwogIH0KCiAgLyogRmlyc3QtZGVhdGggb3V0Y29tZSAqLwogIGNvbnN0IGZpcnN0RGVhdGhPdXRjb21lID0gZmlyc3REZWF0aEZsb3cgPT09ICJ0b19zcG91c2UiCiAgICA/IHsgbGFiZWw6ICJUbyBTdXJ2aXZpbmcgU3BvdXNlIiwgdmFsdWU6IHRvdGFsRXN0YXRlLCBjb2xvcjogQy5hYywKICAgICAgICBkZXRhaWw6ICJFdmVyeXRoaW5nIHBhc3NlcyB0byBzdXJ2aXZpbmcgc3BvdXNlLiAiICsKICAgICAgICAgICAgICAgIChpblRydXN0VmFsID4gMCA/ICJUcnVzdCBhc3NldHMgdHJhbnNmZXIgc2VhbWxlc3NseSB2aWEgc3VjY2Vzc29yIHRydXN0ZWUuICIgOiAiVHJ1c3QgYXNzZXRzIChvbmNlIGZ1bmRlZCkgdHJhbnNmZXIgc2VhbWxlc3NseS4gIikgKwogICAgICAgICAgICAgICAgIlJldGlyZW1lbnQgYW5kIGluc3VyYW5jZSBwYXNzIGJ5IGJlbmVmaWNpYXJ5IGRlc2lnbmF0aW9uLiAiICsKICAgICAgICAgICAgICAgIChwb3J0YWJpbGl0eU5vdGUgfHwgIiIpIH0KICAgIDogZmlyc3REZWF0aEZsb3cgPT09ICJ0b190cnVzdCIKICAgID8geyBsYWJlbDogIlRvIENyZWRpdCBTaGVsdGVyIFRydXN0IiwgdmFsdWU6IE1hdGgubWluKHRvdGFsRXN0YXRlLCAxMzYwMDAwMCksIGNvbG9yOiBDLmJsLAogICAgICAgIGRldGFpbDogIkFzc2V0cyB1cCB0byB0aGUgZXhlbXB0aW9uIGZ1bmQgYSBieXBhc3MgLyBjcmVkaXQgc2hlbHRlciB0cnVzdC4gUmVtYWluaW5nIGFzc2V0cyBwYXNzIHRvIHNwb3VzZSB2aWEgbWFyaXRhbCBzaGFyZS4gIiArIChwb3J0YWJpbGl0eU5vdGUgfHwgIiIpIH0KICAgIDogeyBsYWJlbDogIlRvIEJlbmVmaWNpYXJpZXMiLCB2YWx1ZTogbmV0RGlzdHJpYnV0YWJsZSwgY29sb3I6IEMuYWMsCiAgICAgICAgZGV0YWlsOiAiTm8gc3Vydml2aW5nIHNwb3VzZS4gQXNzZXRzIHBhc3MgcGVyIHRydXN0IHRlcm1zIHRvIG5hbWVkIGJlbmVmaWNpYXJpZXMuIiB9OwoKICByZXR1cm4gKAogICAgPGRpdj4KICAgICAgPFZUIHQ9IldhdGVyZmFsbCIgcz0iSG93IGFzc2V0cyBmbG93IGF0IGRlYXRoLiBTaG93cyBmaXJzdCBhbmQgc2Vjb25kIGRlYXRoIHNjZW5hcmlvcyBiYXNlZCBvbiB5b3VyIHBsYW4uIiAvPgoKICAgICAgey8qIE1vZGUgdG9nZ2xlICovfQogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjAsbWFyZ2luQm90dG9tOjIwLGJhY2tncm91bmQ6Qy5iTCxib3JkZXJSYWRpdXM6NixwYWRkaW5nOjMsd2lkdGg6ImZpdC1jb250ZW50In19PgogICAgICAgIHtbWyJmaXJzdCIsIkZpcnN0IERlYXRoIl0sWyJzZWNvbmQiLCJTZWNvbmQgRGVhdGgiXV0ubWFwKChbayxsYWJdKT0+KAogICAgICAgICAgPGJ1dHRvbiBrZXk9e2t9IG9uQ2xpY2s9eygpPT57c2V0TW9kZShrKTtzZXRFbihudWxsKTt9fQogICAgICAgICAgICBzdHlsZT17e3BhZGRpbmc6IjdweCAxOHB4Iixib3JkZXJSYWRpdXM6NCxib3JkZXI6Im5vbmUiLGN1cnNvcjoicG9pbnRlciIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZDptb2RlPT09az8iI2ZmZiI6InRyYW5zcGFyZW50IiwKICAgICAgICAgICAgICBjb2xvcjptb2RlPT09az9DLnR4OkMudHhMLGZvbnRTaXplOjEyLjUsCiAgICAgICAgICAgICAgZm9udFdlaWdodDptb2RlPT09az82MDA6NDAwLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLAogICAgICAgICAgICAgIGJveFNoYWRvdzptb2RlPT09az8iMCAxcHggM3B4IHJnYmEoMCwwLDAsLjA2KSI6Im5vbmUiLHRyYW5zaXRpb246ImFsbCAuMnMifX0+CiAgICAgICAgICAgIHtsYWJ9CiAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICApKX0KICAgICAgPC9kaXY+CgogICAgICB7LyogPT0gRklSU1QgREVBVEggPT0gKi99CiAgICAgIHttb2RlPT09ImZpcnN0IiAmJiAoCiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixmbGV4RGlyZWN0aW9uOiJjb2x1bW4iLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjAscGFkZGluZzoiMjhweCAzNnB4IixiYWNrZ3JvdW5kOiIjZmZmIixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjFweCBzb2xpZCAiK0MuYkwsYm94U2hhZG93OiIwIDFweCAycHggcmdiYSgwLDAsMCwuMDMpIn19PgogICAgICAgICAgICB7LyogRXN0YXRlIGJveCAqL30KICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+c2V0RW4oZW49PT0iZzEiP251bGw6ImcxIil9CiAgICAgICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiIxNHB4IDIwcHgiLGJvcmRlclJhZGl1czo3LGJvcmRlcjoiMS41cHggc29saWQgIitDLmJsKyI0NCIsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmVuPT09ImcxIj9DLmJsKyIwOCI6IiNmZmYiLHRleHRBbGlnbjoiY2VudGVyIixtaW5XaWR0aDoyMDAsY3Vyc29yOiJwb2ludGVyIix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMSxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206MX19PkNvbWJpbmVkIEVzdGF0ZTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToyMSxmb250V2VpZ2h0OjMwMCxjb2xvcjpDLmJsfX0+e2ZtdCh0b3RhbEVzdGF0ZSl9PC9kaXY+CiAgICAgICAgICAgICAge2VuPT09ImcxIiAmJiAoCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjgscGFkZGluZzoiOHB4IDEwcHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NSxmb250U2l6ZToxMS41LGNvbG9yOkMudHhNLGxpbmVIZWlnaHQ6MS41LHRleHRBbGlnbjoibGVmdCJ9fT4KICAgICAgICAgICAgICAgICAge2luVHJ1c3RWYWwgPiAwCiAgICAgICAgICAgICAgICAgICAgPyAiVHJ1c3QgYXNzZXRzICgiICsgZm10KGluVHJ1c3RWYWwpICsgIikgcGFzcyBwZXIgdHJ1c3QgdGVybXMuICIKICAgICAgICAgICAgICAgICAgICA6ICJUcnVzdCBjdXJyZW50bHkgdW5mdW5kZWQgLSBhc3NldHMgd291bGQgZ28gdGhyb3VnaCBwcm9iYXRlIHVubGVzcyB0cnVzdCBpcyBmdW5kZWQuICJ9CiAgICAgICAgICAgICAgICAgIHsiQmVuZWZpY2lhcnktZGVzaWduYXRlZCBhc3NldHMgKCIgKyBmbXQoYmVuZWZEZXNpZ1ZhbCkgKyAiKSBwYXNzIGRpcmVjdGx5IGJ5IGRlc2lnbmF0aW9uLiJ9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIHsvKiBBcnJvdyAqL30KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGZsZXhEaXJlY3Rpb246ImNvbHVtbiIsYWxpZ25JdGVtczoiY2VudGVyIixwYWRkaW5nOiIzcHggMCJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6MS41LGhlaWdodDoxNCxiYWNrZ3JvdW5kOkMuYWMrIjQ0In19IC8+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpDLmFjLHBhZGRpbmc6IjJweCA3cHgiLGJhY2tncm91bmQ6Qy5hYysiMDgiLGJvcmRlclJhZGl1czozLG1hcmdpbjoiMS41cHggMCIsbGluZUhlaWdodDoxLjN9fT4KICAgICAgICAgICAgICAgIHtpc01hcnJpZWQgPyAiVW5saW1pdGVkIG1hcml0YWwgZGVkdWN0aW9uIC0gJDAgZmVkZXJhbCB0YXgiIDogIkVzdGF0ZSB0YXggYW5hbHlzaXMgYXBwbGllcyJ9CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAge2hhc1N0YXRlVGF4ICYmIHN0YXRlVGF4Tm90ZSAmJiAoCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMud2EscGFkZGluZzoiMnB4IDdweCIsYmFja2dyb3VuZDpDLndhTCxib3JkZXJSYWRpdXM6MyxtYXJnaW46IjEuNXB4IDAiLGxpbmVIZWlnaHQ6MS4zfX0+CiAgICAgICAgICAgICAgICAgIHtzdGF0ZVRheE5vdGV9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApfQogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDowLGhlaWdodDowLGJvcmRlckxlZnQ6IjQuNXB4IHNvbGlkIHRyYW5zcGFyZW50Iixib3JkZXJSaWdodDoiNC41cHggc29saWQgdHJhbnNwYXJlbnQiLGJvcmRlclRvcDoiNS41cHggc29saWQgIitDLmFjKyI2NiJ9fSAvPgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIHsvKiBPdXRjb21lICovfQogICAgICAgICAgICA8ZGl2IG9uQ2xpY2s9eygpPT5zZXRFbihlbj09PSJzMSI/bnVsbDoiczEiKX0KICAgICAgICAgICAgICBzdHlsZT17e3BhZGRpbmc6IjE0cHggMjBweCIsYm9yZGVyUmFkaXVzOjcsYm9yZGVyOiIxLjVweCBzb2xpZCAiK2ZpcnN0RGVhdGhPdXRjb21lLmNvbG9yKyI0NCIsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmVuPT09InMxIj9maXJzdERlYXRoT3V0Y29tZS5jb2xvcisiMDgiOiIjZmZmIix0ZXh0QWxpZ246ImNlbnRlciIsbWluV2lkdGg6MjAwLGN1cnNvcjoicG9pbnRlciIsdHJhbnNpdGlvbjoiYWxsIC4ycyJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsY29sb3I6Qy50eEwsZm9udEZhbWlseToic2Fucy1zZXJpZiIsbWFyZ2luQm90dG9tOjF9fT57Zmlyc3REZWF0aE91dGNvbWUubGFiZWx9PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjIxLGZvbnRXZWlnaHQ6MzAwLGNvbG9yOmZpcnN0RGVhdGhPdXRjb21lLmNvbG9yfX0+e2ZtdChmaXJzdERlYXRoT3V0Y29tZS52YWx1ZSl9PC9kaXY+CiAgICAgICAgICAgICAge2VuPT09InMxIiAmJiAoCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjgscGFkZGluZzoiOHB4IDEwcHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NSxmb250U2l6ZToxMS41LGNvbG9yOkMudHhNLGxpbmVIZWlnaHQ6MS41LHRleHRBbGlnbjoibGVmdCJ9fT4KICAgICAgICAgICAgICAgICAge2ZpcnN0RGVhdGhPdXRjb21lLmRldGFpbH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICl9CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDoxNixwYWRkaW5nOiIxNHB4IDIwcHgiLGJhY2tncm91bmQ6Qy5hY0wsYm9yZGVyUmFkaXVzOjcsbWF4V2lkdGg6NDgwLHRleHRBbGlnbjoiY2VudGVyIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMi41LGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMuYWN9fT5ObyBmZWRlcmFsIGVzdGF0ZSB0YXggYXQgZmlyc3QgZGVhdGguPC9kaXY+CiAgICAgICAgICAgICAge2lzTWFycmllZCAmJiAoCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLmFjKyJjYyIsbWFyZ2luVG9wOjMsbGluZUhlaWdodDoxLjV9fT4KICAgICAgICAgICAgICAgICAge2luVHJ1c3RWYWwgPiAwCiAgICAgICAgICAgICAgICAgICAgPyBmbXQoaW5UcnVzdFZhbCArIG5lZWRzUmV0aXRsZVZhbCkgKyAiIGluIHRydXN0IGFzc2V0cyBhdm9pZHMgcHJvYmF0ZS4iCiAgICAgICAgICAgICAgICAgICAgOiAiT25jZSBmdW5kZWQsICIgKyBmbXQobmVlZHNSZXRpdGxlVmFsKSArICIgd2lsbCBhdm9pZCBwcm9iYXRlLiBSZS10aXRsaW5nIGlzIHRoZSBpbW1lZGlhdGUgcHJpb3JpdHkuIn0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CgogICAgICAgICAge2Z1bmRpbmdHYXBOb3RlICYmICgKICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDoxNCxwYWRkaW5nOiIxMnB4IDE4cHgiLGJhY2tncm91bmQ6Qy53YUwsYm9yZGVyOiIxcHggc29saWQgIitDLndhKyIxOCIsYm9yZGVyUmFkaXVzOjZ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy53YSxsaW5lSGVpZ2h0OjEuNn19PjxzdHJvbmc+Q3VycmVudCBnYXA6IDwvc3Ryb25nPntmdW5kaW5nR2FwTm90ZX08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApfQogICAgICAgIDwvZGl2PgogICAgICApfQoKICAgICAgey8qID09IFNFQ09ORCBERUFUSCA9PSAqL30KICAgICAge21vZGU9PT0ic2Vjb25kIiAmJiAoCiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixmbGV4RGlyZWN0aW9uOiJjb2x1bW4iLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjAscGFkZGluZzoiMjhweCAzNnB4IixiYWNrZ3JvdW5kOiIjZmZmIixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjFweCBzb2xpZCAiK0MuYkwsYm94U2hhZG93OiIwIDFweCAycHggcmdiYSgwLDAsMCwuMDMpIn19PgoKICAgICAgICAgICAgey8qIFN1cnZpdm9yJ3MgZXN0YXRlICovfQogICAgICAgICAgICA8ZGl2IG9uQ2xpY2s9eygpPT5zZXRFbihlbj09PSJnMiI/bnVsbDoiZzIiKX0KICAgICAgICAgICAgICBzdHlsZT17e3BhZGRpbmc6IjE0cHggMjBweCIsYm9yZGVyUmFkaXVzOjcsYm9yZGVyOiIxLjVweCBzb2xpZCAiK0MuYmwrIjQ0IiwKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ZW49PT0iZzIiP0MuYmwrIjA4IjoiI2ZmZiIsdGV4dEFsaWduOiJjZW50ZXIiLG1pbldpZHRoOjIwMCxjdXJzb3I6InBvaW50ZXIiLHRyYW5zaXRpb246ImFsbCAuMnMifX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLGNvbG9yOkMudHhMLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLG1hcmdpbkJvdHRvbToxfX0+CiAgICAgICAgICAgICAgICB7aXNNYXJyaWVkID8gIlN1cnZpdm9yJ3MgRXN0YXRlIiA6ICJFc3RhdGUgYXQgRGVhdGgifQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToyMSxmb250V2VpZ2h0OjMwMCxjb2xvcjpDLmJsfX0+e2ZtdCh0b3RhbEVzdGF0ZSl9PC9kaXY+CiAgICAgICAgICAgICAge2VuPT09ImcyIiAmJiAoCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjgscGFkZGluZzoiOHB4IDEwcHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NSxmb250U2l6ZToxMS41LGNvbG9yOkMudHhNLGxpbmVIZWlnaHQ6MS41LHRleHRBbGlnbjoibGVmdCJ9fT4KICAgICAgICAgICAgICAgICAgeyJGdWxsIGVzdGF0ZSBpbmNsdWRpbmcgdHJ1c3QgYXNzZXRzLCByZXRpcmVtZW50IGFjY291bnRzLCBhbmQgYW55IGluc3VyYW5jZSBwcm9jZWVkcy4gQWRtaW4gY29zdHMgYW5kIGRlYnRzIGRlZHVjdGVkIGJlZm9yZSBkaXN0cmlidXRpb24uIn0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICl9CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgey8qIEFycm93IC0gYWRtaW4vZGVidHMgKi99CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixmbGV4RGlyZWN0aW9uOiJjb2x1bW4iLGFsaWduSXRlbXM6ImNlbnRlciIscGFkZGluZzoiM3B4IDAifX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjEuNSxoZWlnaHQ6MTQsYmFja2dyb3VuZDpDLnR4RisiNDQifX0gLz4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMudHhGLHBhZGRpbmc6IjJweCA3cHgiLGJhY2tncm91bmQ6Qy50eEYrIjA4Iixib3JkZXJSYWRpdXM6MyxtYXJnaW46IjEuNXB4IDAiLGxpbmVIZWlnaHQ6MS4zfX0+CiAgICAgICAgICAgICAgICB7IkFkbWluLCBkZWJ0cywgbW9ydGdhZ2U6IC0iICsgZm10KGFkbWluQ29zdHMgKyBtb3J0Z2FnZSl9CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjAsaGVpZ2h0OjAsYm9yZGVyTGVmdDoiNC41cHggc29saWQgdHJhbnNwYXJlbnQiLGJvcmRlclJpZ2h0OiI0LjVweCBzb2xpZCB0cmFuc3BhcmVudCIsYm9yZGVyVG9wOiI1LjVweCBzb2xpZCAiK0MudHhGKyI2NiJ9fSAvPgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIHsvKiBOZXQgZGlzdHJpYnV0YWJsZSAqL30KICAgICAgICAgICAgPGRpdiBzdHlsZT17e3BhZGRpbmc6IjE0cHggMjBweCIsYm9yZGVyUmFkaXVzOjcsYm9yZGVyOiIxLjVweCBzb2xpZCAiK0MuYmwrIjQ0IixiYWNrZ3JvdW5kOiIjZmZmIix0ZXh0QWxpZ246ImNlbnRlciIsbWluV2lkdGg6MjAwfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLGNvbG9yOkMudHhMLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLG1hcmdpbkJvdHRvbToxfX0+TmV0IERpc3RyaWJ1dGFibGU8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MjEsZm9udFdlaWdodDozMDAsY29sb3I6Qy5ibH19PntmbXQobmV0RGlzdHJpYnV0YWJsZSl9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgey8qIEFycm93IC0gdGF4ICovfQogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZmxleERpcmVjdGlvbjoiY29sdW1uIixhbGlnbkl0ZW1zOiJjZW50ZXIiLHBhZGRpbmc6IjNweCAwIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDoxLjUsaGVpZ2h0OjE0LGJhY2tncm91bmQ6Qy5hYysiNDQifX0gLz4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMuYWMscGFkZGluZzoiMnB4IDdweCIsYmFja2dyb3VuZDpDLmFjTCxib3JkZXJSYWRpdXM6MyxtYXJnaW46IjEuNXB4IDAiLGxpbmVIZWlnaHQ6MS4zfX0+CiAgICAgICAgICAgICAgICB7aXNNYXJyaWVkID8gIkNvbWJpbmVkIGV4ZW1wdGlvbiAoaW5jbC4gcG9ydGFiaWxpdHkpIC0gJDAgZmVkZXJhbCB0YXgiIDogIkZlZGVyYWwgZXhlbXB0aW9uIGFwcGxpZXMgLSB2ZXJpZnkgY3VycmVudCBhbW91bnQifQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIHtoYXNTdGF0ZVRheCAmJiBzdGF0ZVRheE5vdGUgJiYgKAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpDLndhLHBhZGRpbmc6IjJweCA3cHgiLGJhY2tncm91bmQ6Qy53YUwsYm9yZGVyUmFkaXVzOjMsbWFyZ2luOiIxLjVweCAwIixsaW5lSGVpZ2h0OjEuM319PgogICAgICAgICAgICAgICAgICB7c3RhdGVUYXhOb3RlfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6MCxoZWlnaHQ6MCxib3JkZXJMZWZ0OiI0LjVweCBzb2xpZCB0cmFuc3BhcmVudCIsYm9yZGVyUmlnaHQ6IjQuNXB4IHNvbGlkIHRyYW5zcGFyZW50Iixib3JkZXJUb3A6IjUuNXB4IHNvbGlkICIrQy5hYysiNjYifX0gLz4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICB7LyogU3ViLXRydXN0IG5vdGUgKi99CiAgICAgICAgICAgIHtzZWNvbmREZWF0aERpc3RyaWJ1dGlvbiAhPT0gIm91dHJpZ2h0IiAmJiBzdWJ0cnVzdHNOb3RlICYmICgKICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7cGFkZGluZzoiMTBweCAxOHB4IixiYWNrZ3JvdW5kOkMuYWNMLGJvcmRlclJhZGl1czo2LHRleHRBbGlnbjoiY2VudGVyIixtYXJnaW5Ub3A6MixtYXJnaW5Cb3R0b206Mn19PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLjUsZm9udFdlaWdodDo2MDAsY29sb3I6Qy5hY319PlByb3RlY3RpdmUgc3ViLXRydXN0cyBhY3RpdmF0ZTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy5hYysiYmIiLG1hcmdpblRvcDoyfX0+e3N1YnRydXN0c05vdGV9PC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICl9CgogICAgICAgICAgICB7LyogQmVuZWZpY2lhcnkgY29sdW1ucyAtIHVuaWZpZWQgcmVuZGVyZXIgKi99CiAgICAgICAgICAgIHtiZW5lZmljaWFyeUNvbHVtbnMubGVuZ3RoID4gMCAmJiAoCiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOiIxMDAlIixtYXJnaW5Ub3A6OH19PgogICAgICAgICAgICAgICAgey8qIFNlY3Rpb24gaGVhZGVyICovfQogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpDLnR4TCxsZXR0ZXJTcGFjaW5nOjAuOSx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UiLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGZvbnRXZWlnaHQ6NTAwLHRleHRBbGlnbjoiY2VudGVyIixtYXJnaW5Cb3R0b206MTB9fT4KICAgICAgICAgICAgICAgICAgeyJEaXN0cmlidXRpb24gb2YgIiArIGZtdChuZXREaXN0cmlidXRhYmxlKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDoxMCxqdXN0aWZ5Q29udGVudDoiY2VudGVyIixmbGV4V3JhcDoid3JhcCJ9fT4KICAgICAgICAgICAgICAgICAge2JlbmVmaWNpYXJ5Q29sdW1ucy5tYXAoKGNvbCxpKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCAgID0gY29sVmFsdWUoY29sKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGNvbENvbG9yKGNvbCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWtleSAgPSBjb2xFbktleShjb2wsaSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGN0TGFiZWwgPSBjb2wucGVyY2VudGFnZSA/ICIgKCIgKyBNYXRoLnJvdW5kKGNvbC5wZXJjZW50YWdlKjEwMCkgKyAiJSkiIDogIiI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZml4TGFiZWwgPSBjb2wuZml4ZWRBbW91bnQgPyAiIChmaXhlZCkiIDogIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtpfSBvbkNsaWNrPXsoKT0+c2V0RW4oZW49PT1la2V5P251bGw6ZWtleSl9CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7cGFkZGluZzoiMTBweCAxNnB4Iixib3JkZXJSYWRpdXM6NyxjdXJzb3I6InBvaW50ZXIiLHRyYW5zaXRpb246ImFsbCAuMnMiLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjoiMS41cHggc29saWQgIitjb2xvcisiNDQiLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ZW49PT1la2V5P2NvbG9yKyIwOCI6IiNmZmYiLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRBbGlnbjoiY2VudGVyIixtaW5XaWR0aDoxNDB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLGNvbG9yOkMudHhMLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLG1hcmdpbkJvdHRvbToxfX0+e2NvbC5sYWJlbH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjE3LGZvbnRXZWlnaHQ6MzAwLGNvbG9yOmNvbG9yfX0+e2ZtdCh2YWwpfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOmNvbG9yKyI5OSIsbWFyZ2luVG9wOjF9fT57Zml4TGFiZWx8fHBjdExhYmVsfHwicmVzaWR1ZSJ9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIHtlbj09PWVrZXkgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6OCxwYWRkaW5nOiI4cHggMTBweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGZvbnRTaXplOjExLjUsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjUsdGV4dEFsaWduOiJsZWZ0In19PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj57Y29sLnBlb3BsZS5qb2luKCIsICIpfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo0LGNvbG9yOkMudHhMfX0+e2NvbC5ub3RlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKX0KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIHtmdW5kaW5nR2FwTm90ZSAmJiAoCiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTQscGFkZGluZzoiMTJweCAxOHB4IixiYWNrZ3JvdW5kOkMud2FMLGJvcmRlcjoiMXB4IHNvbGlkICIrQy53YSsiMTgiLGJvcmRlclJhZGl1czo2fX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMud2EsbGluZUhlaWdodDoxLjZ9fT48c3Ryb25nPkN1cnJlbnQgZ2FwOiA8L3N0cm9uZz57ZnVuZGluZ0dhcE5vdGV9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKX0KICAgICAgICA8L2Rpdj4KICAgICAgKX0KICAgIDwvZGl2PgogICk7Cn0KCi8qID09PT09PT09PT09IFY0OiBTVFJBVEVHWSA9PT09PT09PT09PSAqLwoKZnVuY3Rpb24gVjQoKSB7CiAgY29uc3QgW3RhYiwgc2V0VGFiXSA9IHVzZVN0YXRlKCJjb21wYXJlIik7CiAgY29uc3QgW2VyLCBzZXRFcl0gICA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IFtlcCwgc2V0RXBdICAgPSB1c2VTdGF0ZShudWxsKTsKCiAgY29uc3QgaGFzSW5zdXJhbmNlID0gYXNzZXRzLnNvbWUoYT0+YS50eXBlPT09Ikluc3VyYW5jZSIpOwogIGNvbnN0IGluc3VyYW5jZVZhbCA9IGFzc2V0cy5maWx0ZXIoYT0+YS50eXBlPT09Ikluc3VyYW5jZSIpLnJlZHVjZSgocyxhKT0+cythLnZhbHVlLDApOwogIGNvbnN0IGlsaXRMYWJlbCAgICA9IGhhc0luc3VyYW5jZSA/ICJJTElUIEFuYWx5c2lzICgiK2ZtdChpbnN1cmFuY2VWYWwpKyIpIiA6ICJJTElUIEFuYWx5c2lzIjsKCiAgcmV0dXJuICg8ZGl2PgogICAgPFZUIHQ9IlN0cmF0ZWd5IiBzPXsiV2hhdCBjaGFuZ2VzLCB3aHksIGFuZCBuZXh0IHN0ZXBzLiAiK2RvbWljaWxlU3RhdGUrIiBwbGFubmluZyBjb250ZXh0LiJ9IC8+CiAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjAsbWFyZ2luQm90dG9tOjIwLGJhY2tncm91bmQ6Qy5iTCxib3JkZXJSYWRpdXM6NixwYWRkaW5nOjMsd2lkdGg6ImZpdC1jb250ZW50In19PgogICAgICB7W1siY29tcGFyZSIsIlBsYW4gQ29tcGFyaXNvbiJdLFsiY29nIiwiU3RhdGUgQ29udGV4dCJdLFsiaWxpdCIsaWxpdExhYmVsXV0ubWFwKChbayxsYWJdKT0+KAogICAgICAgIDxidXR0b24ga2V5PXtrfSBvbkNsaWNrPXsoKT0+e3NldFRhYihrKTtzZXRFcihudWxsKTtzZXRFcChudWxsKTt9fQogICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiI3cHggMThweCIsYm9yZGVyUmFkaXVzOjQsYm9yZGVyOiJub25lIixjdXJzb3I6InBvaW50ZXIiLAogICAgICAgICAgICBiYWNrZ3JvdW5kOnRhYj09PWs/IiNmZmYiOiJ0cmFuc3BhcmVudCIsY29sb3I6dGFiPT09az9DLnR4OkMudHhMLAogICAgICAgICAgICBmb250U2l6ZToxMi41LGZvbnRXZWlnaHQ6dGFiPT09az82MDA6NDAwLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLAogICAgICAgICAgICBib3hTaGFkb3c6dGFiPT09az8iMCAxcHggM3B4IHJnYmEoMCwwLDAsLjA2KSI6Im5vbmUiLHRyYW5zaXRpb246ImFsbCAuMnMifX0+e2xhYn08L2J1dHRvbj4KICAgICAgKSl9CiAgICA8L2Rpdj4KCiAgICB7dGFiPT09ImNvbXBhcmUiICYmICg8ZGl2PgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZ3JpZCIsZ3JpZFRlbXBsYXRlQ29sdW1uczoiMWZyIDYwcHggMWZyIixnYXA6MTYsbWFyZ2luQm90dG9tOjIwLGFsaWduSXRlbXM6ImNlbnRlciJ9fT4KICAgICAgICA8Q2Qgc3R5bGU9e3t0ZXh0QWxpZ246ImNlbnRlciIscGFkZGluZzoiMThweCAyMHB4Iixib3JkZXI6IjFweCBzb2xpZCAiK0MuZGErIjIyIn19PgogICAgICAgICAgPENMPkN1cnJlbnQgU3RhdGU8L0NMPgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjE1LGZvbnRXZWlnaHQ6NTAwLGNvbG9yOkMuZGEsbWFyZ2luVG9wOjZ9fT5OZWVkcyBXb3JrPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eEwsbWFyZ2luVG9wOjQsbGluZUhlaWdodDoxLjV9fT5SZXZpZXcgdGhlIHJvd3MgYmVsb3cgdG8gc2VlIHdoYXQgaXMgaW4gcGxhY2UgYW5kIHdoYXQgbmVlZHMgdG8gY2hhbmdlLjwvZGl2PgogICAgICAgIDwvQ2Q+CiAgICAgICAgPGRpdiBzdHlsZT17e3RleHRBbGlnbjoiY2VudGVyIixmb250U2l6ZToxOCxjb2xvcjpDLmFjLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYifX0+dnM8L2Rpdj4KICAgICAgICA8Q2Qgc3R5bGU9e3t0ZXh0QWxpZ246ImNlbnRlciIscGFkZGluZzoiMThweCAyMHB4Iixib3JkZXI6IjFweCBzb2xpZCAiK0MuYWMrIjMzIn19PgogICAgICAgICAgPENMPlByb3Bvc2VkIFN0YXRlPC9DTD4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxNSxmb250V2VpZ2h0OjUwMCxjb2xvcjpDLmFjLG1hcmdpblRvcDo2fX0+VGFyZ2V0IFBsYW48L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMixjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6NCxsaW5lSGVpZ2h0OjEuNX19PkVhY2ggcm93IHNob3dzIHRoZSByZWNvbW1lbmRlZCBjaGFuZ2UgYW5kIHdoeSBpdCBtYXR0ZXJzLjwvZGl2PgogICAgICAgIDwvQ2Q+CiAgICAgIDwvZGl2PgogICAgICB7c3RyYXRlZ3lSb3dzLmxlbmd0aCA+IDAgPyAoCiAgICAgICAgPENkPntzdHJhdGVneVJvd3MubWFwKChyLGkpPT57Y29uc3QgaXNFPWVyPT09aTtyZXR1cm4oPGRpdiBrZXk9e2l9PgogICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+ci5kJiZzZXRFcihpc0U/bnVsbDppKX0KICAgICAgICAgICAgc3R5bGU9e3tkaXNwbGF5OiJncmlkIixncmlkVGVtcGxhdGVDb2x1bW5zOiIxNzBweCAxZnIgMWZyIixwYWRkaW5nOiIxMHB4IDAiLAogICAgICAgICAgICAgIGJvcmRlckJvdHRvbToiMXB4IHNvbGlkICIrQy5iTCxjdXJzb3I6ci5kPyJwb2ludGVyIjoiZGVmYXVsdCIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZDpyLmhsP0Mud2FMKyI2NiI6InRyYW5zcGFyZW50In19PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLnR4LGZvbnRXZWlnaHQ6ci5obD82MDA6NDAwLGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjR9fT4KICAgICAgICAgICAgICB7ci5kJiY8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjksY29sb3I6Qy50eEYsdHJhbnNpdGlvbjoidHJhbnNmb3JtIC4ycyIsdHJhbnNmb3JtOmlzRT8icm90YXRlKDkwZGVnKSI6Im5vbmUiLGRpc3BsYXk6ImlubGluZS1ibG9jayJ9fT57Ij4ifTwvc3Bhbj59CiAgICAgICAgICAgICAge3IubH0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMi41LGNvbG9yOkMuZGEsdGV4dEFsaWduOiJjZW50ZXIifX0+e3IuY3V9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMi41LGNvbG9yOkMuYWMsZm9udFdlaWdodDo1MDAsdGV4dEFsaWduOiJjZW50ZXIifX0+e3IucHJ9PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIHtpc0UmJnIuZCYmPGRpdiBzdHlsZT17e3BhZGRpbmc6IjhweCAxNHB4IDEycHggMjRweCIsZm9udFNpemU6MTIsY29sb3I6Qy50eEwsbGluZUhlaWdodDoxLjYsYmFja2dyb3VuZDpDLmJnLGJvcmRlckJvdHRvbToiMXB4IHNvbGlkICIrQy5iTCxhbmltYXRpb246InZmIC4xNXMgZWFzZSJ9fT57ci5kfTwvZGl2Pn0KICAgICAgICA8L2Rpdj4pO30pfTwvQ2Q+CiAgICAgICkgOiAoCiAgICAgICAgPENkPjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxjb2xvcjpDLnR4TCxmb250U3R5bGU6Iml0YWxpYyIsdGV4dEFsaWduOiJjZW50ZXIiLHBhZGRpbmc6IjE2cHggMCJ9fT5ObyBzdHJhdGVneSByb3dzIHByb3ZpZGVkLjwvZGl2PjwvQ2Q+CiAgICAgICl9CiAgICA8L2Rpdj4pfQoKICAgIHt0YWI9PT0iY29nIiAmJiAoPGRpdj4KICAgICAgPENkIHN0eWxlPXt7bWFyZ2luQm90dG9tOjE2fX0+CiAgICAgICAgPENMPnsiU3RhdGUgQ29udGV4dCAtICIrZG9taWNpbGVTdGF0ZX08L0NMPgogICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNyxtYXJnaW5Ub3A6OH19Pntjb2dTdW1tYXJ5fTwvZGl2PgogICAgICA8L0NkPgogICAgPC9kaXY+KX0KCiAgICB7dGFiPT09ImlsaXQiICYmICg8ZGl2PgogICAgICA8Q2Qgc3R5bGU9e3ttYXJnaW5Cb3R0b206MTZ9fT48Q0w+Q3VycmVudCBTaXR1YXRpb248L0NMPjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNixtYXJnaW5Ub3A6Nn19PntpbGl0QW5hbHlzaXMuc2l0dWF0aW9ufTwvZGl2PjwvQ2Q+CiAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJncmlkIixncmlkVGVtcGxhdGVDb2x1bW5zOiIxZnIgMWZyIixnYXA6MTYsbWFyZ2luQm90dG9tOjE2fX0+CiAgICAgICAgPENkIHN0eWxlPXt7Ym9yZGVyOiIxcHggc29saWQgIitDLmFjKyIyMiJ9fT48Q0w+QXJndW1lbnRzIEZPUiBhbiBJTElUPC9DTD48ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjh9fT4KICAgICAgICAgIHtpbGl0QW5hbHlzaXMucHJvcy5sZW5ndGggPT09IDAgJiYgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMudHhMLGZvbnRTdHlsZToiaXRhbGljIn19Pk5vbmUgaWRlbnRpZmllZC48L2Rpdj59CiAgICAgICAgICB7aWxpdEFuYWx5c2lzLnByb3MubWFwKChwLGkpPT57Y29uc3QgaXNFPWVwPT09InAiK2k7cmV0dXJuKDxkaXYga2V5PXtpfT4KICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+c2V0RXAoaXNFP251bGw6InAiK2kpfSBzdHlsZT17e3BhZGRpbmc6IjZweCAwIixib3JkZXJCb3R0b206IjFweCBzb2xpZCAiK0MuYkwsY3Vyc29yOiJwb2ludGVyIixkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo1fX0+CiAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZTo5LGNvbG9yOkMudHhGLHRyYW5zZm9ybTppc0U/InJvdGF0ZSg5MGRlZykiOiJub25lIix0cmFuc2l0aW9uOiJ0cmFuc2Zvcm0gLjE1cyIsZGlzcGxheToiaW5saW5lLWJsb2NrIn19PnsiPiJ9PC9zcGFuPgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLmFjLGZvbnRXZWlnaHQ6NTAwfX0+e3AubGFiZWx9PC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAge2lzRSYmPGRpdiBzdHlsZT17e3BhZGRpbmc6IjRweCAwIDhweCAxNnB4Iixmb250U2l6ZToxMS41LGNvbG9yOkMudHhMLGxpbmVIZWlnaHQ6MS41LGFuaW1hdGlvbjoidmYgLjEycyBlYXNlIn19PntwLnRleHR9PC9kaXY+fQogICAgICAgICAgPC9kaXY+KTt9KX0KICAgICAgICA8L2Rpdj48L0NkPgogICAgICAgIDxDZCBzdHlsZT17e2JvcmRlcjoiMXB4IHNvbGlkICIrQy5kYSsiMjIifX0+PENMPkFyZ3VtZW50cyBBR0FJTlNUIGFuIElMSVQ8L0NMPjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6OH19PgogICAgICAgICAge2lsaXRBbmFseXNpcy5jb25zLmxlbmd0aCA9PT0gMCAmJiA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMifX0+Tm9uZSBpZGVudGlmaWVkLjwvZGl2Pn0KICAgICAgICAgIHtpbGl0QW5hbHlzaXMuY29ucy5tYXAoKHAsaSk9Pntjb25zdCBpc0U9ZXA9PT0iYyIraTtyZXR1cm4oPGRpdiBrZXk9e2l9PgogICAgICAgICAgICA8ZGl2IG9uQ2xpY2s9eygpPT5zZXRFcChpc0U/bnVsbDoiYyIraSl9IHN0eWxlPXt7cGFkZGluZzoiNnB4IDAiLGJvcmRlckJvdHRvbToiMXB4IHNvbGlkICIrQy5iTCxjdXJzb3I6InBvaW50ZXIiLGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjV9fT4KICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjksY29sb3I6Qy50eEYsdHJhbnNmb3JtOmlzRT8icm90YXRlKDkwZGVnKSI6Im5vbmUiLHRyYW5zaXRpb246InRyYW5zZm9ybSAuMTVzIixkaXNwbGF5OiJpbmxpbmUtYmxvY2sifX0+eyI+In08L3NwYW4+CiAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMi41LGNvbG9yOkMuZGEsZm9udFdlaWdodDo1MDB9fT57cC5sYWJlbH08L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICB7aXNFJiY8ZGl2IHN0eWxlPXt7cGFkZGluZzoiNHB4IDAgOHB4IDE2cHgiLGZvbnRTaXplOjExLjUsY29sb3I6Qy50eEwsbGluZUhlaWdodDoxLjUsYW5pbWF0aW9uOiJ2ZiAuMTJzIGVhc2UifX0+e3AudGV4dH08L2Rpdj59CiAgICAgICAgICA8L2Rpdj4pO30pfQogICAgICAgIDwvZGl2PjwvQ2Q+CiAgICAgIDwvZGl2PgogICAgICA8Q2Qgc3R5bGU9e3tiYWNrZ3JvdW5kOkMuYmxMLGJvcmRlcjoiMXB4IHNvbGlkICIrQy5ibCsiMjIifX0+CiAgICAgICAgPENMPlJlY29tbWVuZGF0aW9uPC9DTD4KICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy5ibCxsaW5lSGVpZ2h0OjEuNixtYXJnaW5Ub3A6Nixmb250V2VpZ2h0OjUwMH19PntpbGl0QW5hbHlzaXMucmVjb21tZW5kYXRpb259PC9kaXY+CiAgICAgIDwvQ2Q+CiAgICA8L2Rpdj4pfQogIDwvZGl2Pik7Cn0KCmZ1bmN0aW9uIFY1KCkgewogIGNvbnN0IFtzdCwgc2V0U3RdID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3QgW3NwLCBzZXRTcF0gPSB1c2VTdGF0ZShudWxsKTsKICByZXR1cm4gKDxkaXY+CiAgICA8VlQgdD0iVHJ1c3QgQXJjaGl0ZWN0dXJlIiBzPSJDdXJyZW50IHN0cnVjdHVyZSBhbmQgcHJvcG9zZWQgY2hhbmdlcy4gQ2xpY2sgYW55IGVudGl0eSBmb3IgcHJvdmlzaW9ucy4iIC8+CiAgICA8Q2Qgc3R5bGU9e3twYWRkaW5nOiIyOHB4IDMycHgifX0+CiAgICAgIDxkaXYgc3R5bGU9e3t0ZXh0QWxpZ246ImNlbnRlciIsbWFyZ2luQm90dG9tOjI0fX0+CiAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImlubGluZS1mbGV4IixnYXA6MTYsYWxpZ25JdGVtczoiY2VudGVyIixwYWRkaW5nOiIxMHB4IDIycHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6N319PgogICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMyxmb250V2VpZ2h0OjUwMH19PntmYW1pbHkuY2xpZW50Lm5hbWV9PC9zcGFuPgogICAgICAgICAge2ZhbWlseS5zcG91c2UmJjw+PHNwYW4gc3R5bGU9e3tjb2xvcjpDLnR4Rixmb250U2l6ZToxM319PnsiJiJ9PC9zcGFuPjxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTMsZm9udFdlaWdodDo1MDB9fT57ZmFtaWx5LnNwb3VzZS5uYW1lfTwvc3Bhbj48Lz59CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEwsbWFyZ2luVG9wOjR9fT57IkdyYW50b3JzIHwgRXN0YXRlOiAiK2ZtdCh0b3RhbEVzdGF0ZSkrIiAobmV0IGVxdWl0eSAiK2ZtdChncm9zc0VxdWl0eSkrIikifTwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIHt0cnVzdEVudGl0aWVzLmxlbmd0aCA9PT0gMCA/ICgKICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMiLHRleHRBbGlnbjoiY2VudGVyIixwYWRkaW5nOiIyMHB4IDAifX0+Tm8gdHJ1c3QgZW50aXRpZXMgcHJvdmlkZWQuPC9kaXY+CiAgICAgICkgOiAoCiAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImdyaWQiLGdyaWRUZW1wbGF0ZUNvbHVtbnM6InJlcGVhdChhdXRvLWZpbGwsbWlubWF4KDIyMHB4LDFmcikpIixnYXA6MTR9fT4KICAgICAgICAgIHt0cnVzdEVudGl0aWVzLm1hcCgodCx0aSk9Pntjb25zdCBpc1NlbD1zdD09PXRpO3JldHVybigKICAgICAgICAgICAgPGRpdiBrZXk9e3RpfSBvbkNsaWNrPXsoKT0+e3NldFN0KGlzU2VsP251bGw6dGkpO3NldFNwKG51bGwpO319CiAgICAgICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiIxNnB4IDE0cHgiLGJvcmRlclJhZGl1czo3LGN1cnNvcjoicG9pbnRlciIsdHJhbnNpdGlvbjoiYWxsIC4ycyIscG9zaXRpb246InJlbGF0aXZlIiwKICAgICAgICAgICAgICAgIGJvcmRlcjoiMS41cHggc29saWQgIisoaXNTZWw/dC5jb2xvcjp0LmNvbG9yKyIzMyIpLGJhY2tncm91bmQ6aXNTZWw/dC5jb2xvcisiMDYiOiIjZmZmIn19PgogICAgICAgICAgICAgIHt0LnN0YXR1cz09PSJvdXRkYXRlZCImJjxTQmFkZ2UgdD0iTmVlZHMgVXBkYXRlIiBjbz17Qy53YX0gLz59CiAgICAgICAgICAgICAge3Quc3RhdHVzPT09InBsYW5uZWQiJiY8U0JhZGdlIHQ9IlByb3Bvc2VkIiBjbz17Qy5hY30gLz59CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjksY29sb3I6dC5jb2xvcixmb250RmFtaWx5OiJzYW5zLXNlcmlmIixsZXR0ZXJTcGFjaW5nOjEsdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixtYXJnaW5Cb3R0b206M319Pnt0LnR5cGV9PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjE0LGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMudHgsbWFyZ2luQm90dG9tOjF9fT57dC5uYW1lfTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToyMCxmb250V2VpZ2h0OjMwMCxjb2xvcjp0LmNvbG9yfX0+e3QudG90YWxWYWx1ZT4wP2ZtdCh0LnRvdGFsVmFsdWUpOiItLSJ9PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4LGZvbnRTaXplOjExLGNvbG9yOkMudHhMLGxpbmVIZWlnaHQ6MS40fX0+CiAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmcgc3R5bGU9e3tjb2xvcjpDLnR4TX19PlRydXN0ZWU6PC9zdHJvbmc+IHt0LnRydXN0ZWV8fHQuZ3JhbnRvcn08L2Rpdj4KICAgICAgICAgICAgICAgIHt0LnByb3RlY3RvciYmPGRpdiBzdHlsZT17e21hcmdpblRvcDoyfX0+PHN0cm9uZyBzdHlsZT17e2NvbG9yOkMudHhNfX0+UHJvdGVjdG9yOjwvc3Ryb25nPiB7dC5wcm90ZWN0b3J9PC9kaXY+fQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIHtpc1NlbCYmKDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTQscGFkZGluZ1RvcDoxMixib3JkZXJUb3A6IjFweCBzb2xpZCAiK0MuYkwsYW5pbWF0aW9uOiJ2ZiAuMTVzIGVhc2UifX0gb25DbGljaz17ZT0+ZS5zdG9wUHJvcGFnYXRpb24oKX0+CiAgICAgICAgICAgICAgICA8RFIgbD0iRXN0YWJsaXNoZWQiIHY9e3QuZXN0YWJsaXNoZWR9IC8+PERSIGw9IkdyYW50b3IiIHY9e3QuZ3JhbnRvcnx8Ii0tIn0gLz4KICAgICAgICAgICAgICAgIHt0LnN1Y2Nlc3NvciYmPERSIGw9IlN1Y2Nlc3NvciIgdj17dC5zdWNjZXNzb3J9IC8+fQogICAgICAgICAgICAgICAge3QuYmVuZWZpY2lhcmllcyYmPERSIGw9IkJlbmVmaWNpYXJpZXMiIHY9e3QuYmVuZWZpY2lhcmllc30gLz59CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjgsZm9udFNpemU6MTAsY29sb3I6Qy50eEwsdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixsZXR0ZXJTcGFjaW5nOjAuNyxmb250RmFtaWx5OiJzYW5zLXNlcmlmIn19PkFzc2V0czwvZGl2PgogICAgICAgICAgICAgICAge3QuYXNzZXRMaXN0Lm1hcCgoYSxhaSk9Pig8ZGl2IGtleT17YWl9IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxwYWRkaW5nOiIycHggMCJ9fT57Ii0gIithfTwvZGl2PikpfQogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDoxMixmb250U2l6ZToxMCxjb2xvcjpDLnR4TCx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UiLGxldHRlclNwYWNpbmc6MC43LGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLG1hcmdpbkJvdHRvbTo0fX0+CiAgICAgICAgICAgICAgICAgIEtleSBQcm92aXNpb25zIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6OSxjb2xvcjpDLnR4Rn19Pi0tIGNsaWNrIHRvIGV4cGFuZDwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAge3QucHJvdmlzaW9ucy5tYXAoKHAscGkpPT57Y29uc3QgcGs9dGkrIi0iK3BpO3JldHVybig8ZGl2IGtleT17cGl9IHN0eWxlPXt7bWFyZ2luQm90dG9tOjF9fT4KICAgICAgICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+c2V0U3Aoc3A9PT1waz9udWxsOnBrKX0KICAgICAgICAgICAgICAgICAgICBzdHlsZT17e3BhZGRpbmc6IjZweCA4cHgiLGZvbnRTaXplOjEyLGNvbG9yOkMudHgsY3Vyc29yOiJwb2ludGVyIixib3JkZXJSYWRpdXM6MywKICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjUsCiAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOnNwPT09cGs/dC5jb2xvcisiMDgiOiJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0OiIycHggc29saWQgIisoc3A9PT1waz90LmNvbG9yOiJ0cmFuc3BhcmVudCIpfX0+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZTo5LGNvbG9yOkMudHhGLHRyYW5zaXRpb246InRyYW5zZm9ybSAuMTVzIix0cmFuc2Zvcm06c3A9PT1waz8icm90YXRlKDkwZGVnKSI6Im5vbmUiLGRpc3BsYXk6ImlubGluZS1ibG9jayJ9fT57Ij4ifTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRXZWlnaHQ6NTAwfX0+e3AubGFiZWx9PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAge3NwPT09cGsmJjxkaXYgc3R5bGU9e3twYWRkaW5nOiI0cHggOHB4IDhweCAxOHB4Iixmb250U2l6ZToxMS41LGNvbG9yOkMudHhMLGxpbmVIZWlnaHQ6MS41NSxhbmltYXRpb246InZmIC4xMnMgZWFzZSJ9fT57cC50ZXh0fTwvZGl2Pn0KICAgICAgICAgICAgICAgIDwvZGl2Pik7fSl9CiAgICAgICAgICAgICAgPC9kaXY+KX0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApO30pfTwvZGl2PgogICAgICApfQoKICAgICAgey8qIEJlbmVmaWNpYXJ5IGNvbHVtbnMgZnJvbSB3YXRlcmZhbGxDb25maWcgKi99CiAgICAgIHt3YXRlcmZhbGxDb25maWcuYmVuZWZpY2lhcnlDb2x1bW5zLmxlbmd0aCA+IDAgJiYgKAogICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MjQsdGV4dEFsaWduOiJjZW50ZXIifX0+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAsY29sb3I6Qy50eEwsbGV0dGVyU3BhY2luZzoxLHRleHRUcmFuc2Zvcm06InVwcGVyY2FzZSIsZm9udEZhbWlseToic2Fucy1zZXJpZiIsbWFyZ2luQm90dG9tOjEwfX0+QmVuZWZpY2lhcmllcyBhdCBTZWNvbmQgRGVhdGg8L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixqdXN0aWZ5Q29udGVudDoiY2VudGVyIixnYXA6NDAsZmxleFdyYXA6IndyYXAifX0+CiAgICAgICAgICAgIHt3YXRlcmZhbGxDb25maWcuYmVuZWZpY2lhcnlDb2x1bW5zLm1hcCgoY29sLGkpPT4oCiAgICAgICAgICAgICAgPEdDIGtleT17aX0gbD17Y29sLmxhYmVsfSBwPXtjb2wucGVvcGxlfSBuPXtjb2wubm90ZX0gY289e0MuYWN9IC8+CiAgICAgICAgICAgICkpfQogICAgICAgICAgICB7ZmFtaWx5LmNoaWxkcmVuLnNvbWUoYz0+Yy5nYyYmYy5nYy5sZW5ndGg+MCkmJigKICAgICAgICAgICAgICA8R0MgbD0iR2VuIDIgLSBHcmFuZGNoaWxkcmVuIiBwPXtmYW1pbHkuY2hpbGRyZW4uZmxhdE1hcChjPT5jLmdjfHxbXSl9IG49IlNlZSBGYW1pbHkgVHJlZSB0YWIgZm9yIGRldGFpbHMuIiAvPgogICAgICAgICAgICApfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICl9CiAgICA8L0NkPgogIDwvZGl2Pik7Cn0KCmZ1bmN0aW9uIFY2KCkgewogIGNvbnN0IFtlbSwgc2V0RW1dID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3Qgc0NvbmYgPSB7ZG9uZTp7YzpDLmFjLGJnOkMuYWNMLGw6IkRvbmUifSxhY3RpdmU6e2M6Qy5ibCxiZzpDLmJsTCxsOiJBY3RpdmUifSx1cGNvbWluZzp7YzpDLndhLGJnOkMud2FMLGw6IlVwY29taW5nIn0sZnV0dXJlOntjOkMudHhMLGJnOkMuYmcrImVlIixsOiJGdXR1cmUifX07CiAgY29uc3QgY2F0QyA9IHtFbnRpdHk6IiM3YTRhMmEiLERvY3VtZW50czpDLmJsLFBsYW5uaW5nOiIjNWE3YTNhIixMYXc6Qy5hYyxUaXRsaW5nOiIjOGE1YTJhIixHaWZ0aW5nOiIjNmE0YTNhIixTdHJhdGVneTpDLnR4TSxFZHVjYXRpb246Qy5wdSxHb3Zlcm5hbmNlOkMucHV9OwogIHJldHVybiAoPGRpdj4KICAgIDxWVCB0PSJNaWxlc3RvbmVzIGFuZCBBY3Rpb25zIiBzPSJNYWpvciBvdmVyaGF1bCB1bmRlcndheS4gQnVsayBvZiB3b3JrIGluIFExLVEzIDIwMjYuIiAvPgogICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDoxMCxtYXJnaW5Cb3R0b206MjB9fT4KICAgICAge09iamVjdC5lbnRyaWVzKHNDb25mKS5tYXAoKFtrLGNmZ10pPT57Y29uc3QgY3Q9bWlsZXN0b25lcy5maWx0ZXIobT0+bS5zdD09PWspLmxlbmd0aDtyZXR1cm4oCiAgICAgICAgPGRpdiBrZXk9e2t9IHN0eWxlPXt7ZmxleDoxLHBhZGRpbmc6IjEwcHggMTRweCIsYmFja2dyb3VuZDpjZmcuYmcsYm9yZGVyUmFkaXVzOjYsYm9yZGVyOiIxcHggc29saWQgIitjZmcuYysiMTQifX0+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MjIsZm9udFdlaWdodDozMDAsY29sb3I6Y2ZnLmN9fT57Y3R9PC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAuNSxjb2xvcjpjZmcuYyxmb250RmFtaWx5OiJzYW5zLXNlcmlmIn19PntjZmcubH08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgKTt9KX0KICAgIDwvZGl2PgogICAgPENkIHN0eWxlPXt7cGFkZGluZzoiMjBweCAxNnB4In19PgogICAgICA8ZGl2IHN0eWxlPXt7cG9zaXRpb246InJlbGF0aXZlIn19PgogICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLGxlZnQ6MTcsdG9wOjEwLGJvdHRvbToxMCx3aWR0aDoxLjUsYmFja2dyb3VuZDpDLmJMfX0gLz4KICAgICAgICB7bWlsZXN0b25lcy5tYXAoKG0saSk9Pntjb25zdCBjZmc9c0NvbmZbbS5zdF07Y29uc3QgY2M9Y2F0Q1ttLmNhdF18fEMudHhMO2NvbnN0IGlzRT1lbT09PWk7Y29uc3QgaXNOPW0uc3Q9PT0iYWN0aXZlIjsKICAgICAgICAgIHJldHVybig8ZGl2IGtleT17aX0gb25DbGljaz17KCk9Pm0uZGV0YWlsJiZzZXRFbShpc0U/bnVsbDppKX0gc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6MTQscGFkZGluZzoiMTBweCAwIixjdXJzb3I6bS5kZXRhaWw/InBvaW50ZXIiOiJkZWZhdWx0Iixwb3NpdGlvbjoicmVsYXRpdmUifX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDozNixkaXNwbGF5OiJmbGV4IixqdXN0aWZ5Q29udGVudDoiY2VudGVyIixhbGlnbkl0ZW1zOiJmbGV4LXN0YXJ0IixwYWRkaW5nVG9wOjEuNSx6SW5kZXg6MSxmbGV4U2hyaW5rOjB9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6aXNOPzE2OjEwLGhlaWdodDppc04/MTY6MTAsYm9yZGVyUmFkaXVzOiI1MCUiLGJhY2tncm91bmQ6bS5zdD09PSJkb25lIj9jZmcuYzppc04/Y2ZnLmM6IiNmZmYiLGJvcmRlcjoiMnB4IHNvbGlkICIrY2ZnLmMsYW5pbWF0aW9uOmlzTj8icHUgMnMgaW5maW5pdGUiOiJub25lIn19IC8+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZmxleDoxfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjcsZmxleFdyYXA6IndyYXAifX0+CiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEYsbWluV2lkdGg6NTV9fT57bS5kYXRlfTwvc3Bhbj4KICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6bS5zdD09PSJkb25lIj9DLnR4TDpDLnR4LGZvbnRXZWlnaHQ6aXNOPzYwMDo0MDB9fT57bS5sYWJlbH08L3NwYW4+CiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjguNSxwYWRkaW5nOiIxLjVweCA1cHgiLGJhY2tncm91bmQ6Y2MrIjEwIixjb2xvcjpjYyxib3JkZXJSYWRpdXM6Myxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixsZXR0ZXJTcGFjaW5nOjAuNH19PnttLmNhdH08L3NwYW4+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAge2lzRSYmbS5kZXRhaWwmJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6NixwYWRkaW5nOiI5cHggMTJweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGZvbnRTaXplOjExLjUsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjYsYW5pbWF0aW9uOiJ2ZiAuMTVzIGVhc2UiLGJvcmRlckxlZnQ6IjNweCBzb2xpZCAiK2NjKyIzMyJ9fT57bS5kZXRhaWx9PC9kaXY+fQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2Pik7CiAgICAgICAgfSl9CiAgICAgIDwvZGl2PgogICAgPC9DZD4KICA8L2Rpdj4pOwp9CgovKiA9PT09PT09PT09PSBWNzogRkFNSUxZIFRSRUUgPT09PT09PT09PT0gKi8KZnVuY3Rpb24gVjcoKSB7CiAgY29uc3QgW3NlbElkLCBzZXRTZWxJZF0gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBzZWxQID0gdHJlZVBlb3BsZS5maW5kKHA9PnAuaWQ9PT1zZWxJZCk7CgogIGNvbnN0IG5vZGVXID0gMTMwLCBub2RlSCA9IDY0OwogIGNvbnN0IGdlblkgID0geyAwOiAzMCwgMTogMTYwLCAyOiAyOTAgfTsKICBjb25zdCBnZW5QZW9wbGUgPSBbMCwxLDJdLm1hcChnPT50cmVlUGVvcGxlLmZpbHRlcihwPT5wLmdlbj09PWcpKTsKCiAgZnVuY3Rpb24geEZvcihnZW4sIGlkeCkgewogICAgY29uc3QgY291bnQgPSBnZW5QZW9wbGVbZ2VuXS5sZW5ndGg7CiAgICBjb25zdCB0b3RhbFcgPSBjb3VudCAqIG5vZGVXICsgKGNvdW50LTEpICogMjA7CiAgICBjb25zdCBzdGFydFggPSBNYXRoLm1heCgyMCwgNDAwIC0gdG90YWxXLzIpOwogICAgcmV0dXJuIHN0YXJ0WCArIGlkeCAqIChub2RlVyArIDIwKTsKICB9CgogIGNvbnN0IHBvc2l0aW9ucyA9IHt9OwogIFswLDEsMl0uZm9yRWFjaChnZW49PnsKICAgIGdlblBlb3BsZVtnZW5dLmZvckVhY2goKHAsaSk9PnsKICAgICAgcG9zaXRpb25zW3AuaWRdID0geyB4OiB4Rm9yKGdlbixpKSwgeTogZ2VuWVtnZW5dIH07CiAgICB9KTsKICB9KTsKCiAgY29uc3QgY2FudmFzVyA9IE1hdGgubWF4KAogICAgLi4uKFswLDEsMl0uZmxhdE1hcChnPT5nZW5QZW9wbGVbZ10ubWFwKChfLGkpPT54Rm9yKGcsaSkrbm9kZVcrMjApKSksCiAgICA2MDAKICApOwogIGNvbnN0IGNhbnZhc0ggPSB0cmVlUGVvcGxlLnNvbWUocD0+cC5nZW49PT0yKSA/IDM4MCA6ICh0cmVlUGVvcGxlLnNvbWUocD0+cC5nZW49PT0xKSA/IDI1MCA6IDEyMCk7CgogIHJldHVybiAoPGRpdj4KICAgIDxWVCB0PSJGYW1pbHkgVHJlZSIgcz0iRXN0YXRlIHBsYW5uaW5nIHJvbGVzIGFuZCBkb2N1bWVudCBzdGF0dXMuIiAvPgoKICAgIHt0cmVlUGVvcGxlLmxlbmd0aCA9PT0gMCA/ICgKICAgICAgPENkPjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxjb2xvcjpDLnR4TCxmb250U3R5bGU6Iml0YWxpYyIsdGV4dEFsaWduOiJjZW50ZXIiLHBhZGRpbmc6IjIwcHggMCJ9fT5ObyBmYW1pbHkgdHJlZSBkYXRhIHByb3ZpZGVkLjwvZGl2PjwvQ2Q+CiAgICApIDogKAogICAgICA8Q2Qgc3R5bGU9e3twYWRkaW5nOjAsb3ZlcmZsb3c6ImhpZGRlbiJ9fT4KICAgICAgICB7LyogTGVnZW5kICovfQogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6MTYscGFkZGluZzoiMTJweCAxNnB4Iixib3JkZXJCb3R0b206IjFweCBzb2xpZCAiK0MuYkwsZmxleFdyYXA6IndyYXAifX0+CiAgICAgICAgICB7W1siIzJhNWE4YyIsIlByaW1hcnkgQ2xpZW50Il0sWyIjNmE0YThhIiwiU3BvdXNlIC8gUGFydG5lciJdLFsiIzFhNWMzYSIsIkluIERvY3VtZW50cyJdLFsiI2IwM2EyZSIsIk5PVCBJbiBEb2N1bWVudHMiXV0ubWFwKChbYyxsXSk9PigKICAgICAgICAgICAgPGRpdiBrZXk9e2x9IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiY2VudGVyIixnYXA6Nixmb250U2l6ZToxMSxjb2xvcjpDLnR4TX19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDoxMCxoZWlnaHQ6MTAsYm9yZGVyUmFkaXVzOjIsYmFja2dyb3VuZDpjfX0gLz57bH0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApKX0KICAgICAgICA8L2Rpdj4KCiAgICAgICAgey8qIFNWRyBjYW52YXMgKi99CiAgICAgICAgPGRpdiBzdHlsZT17e292ZXJmbG93WDoiYXV0byIscGFkZGluZzoiMTZweCJ9fT4KICAgICAgICAgIDxzdmcgd2lkdGg9e2NhbnZhc1d9IGhlaWdodD17Y2FudmFzSH0gc3R5bGU9e3tkaXNwbGF5OiJibG9jayIsbWluV2lkdGg6IjEwMCUifX0+CiAgICAgICAgICAgIHsvKiBDb25uZWN0b3IgbGluZXM6IGdlbjAgdG8gZ2VuMSAqL30KICAgICAgICAgICAge2dlblBlb3BsZVswXS5sZW5ndGg+MCAmJiBnZW5QZW9wbGVbMV0ubGVuZ3RoPjAgJiYgKCgpID0+IHsKICAgICAgICAgICAgICBjb25zdCBnMCA9IGdlblBlb3BsZVswXTsKICAgICAgICAgICAgICBjb25zdCBnMSA9IGdlblBlb3BsZVsxXTsKICAgICAgICAgICAgICBjb25zdCBwYXJlbnRNaWRYID0gKHhGb3IoMCwwKSArIHhGb3IoMCwgZzAubGVuZ3RoLTEpICsgbm9kZVcpIC8gMjsKICAgICAgICAgICAgICBjb25zdCBwYXJlbnRZICAgID0gZ2VuWVswXSArIG5vZGVIOwogICAgICAgICAgICAgIGNvbnN0IGNoaWxkWSAgICAgPSBnZW5ZWzFdOwogICAgICAgICAgICAgIGNvbnN0IG1pZFkgICAgICAgPSBwYXJlbnRZICsgKGNoaWxkWSAtIHBhcmVudFkpICogMC41OwogICAgICAgICAgICAgIHJldHVybiAoPGc+CiAgICAgICAgICAgICAgICA8bGluZSB4MT17cGFyZW50TWlkWH0geTE9e3BhcmVudFl9IHgyPXtwYXJlbnRNaWRYfSB5Mj17bWlkWX0gc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iMS41Ii8+CiAgICAgICAgICAgICAgICB7ZzEubWFwKChfLGkpPT57CiAgICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0geEZvcigxLGkpICsgbm9kZVcvMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuICg8ZyBrZXk9e2l9PgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtwYXJlbnRNaWRYfSB5MT17bWlkWX0geDI9e2N4fSB5Mj17bWlkWX0gc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iMS41Ii8+CiAgICAgICAgICAgICAgICAgICAgPGxpbmUgeDE9e2N4fSB5MT17bWlkWX0geDI9e2N4fSB5Mj17Y2hpbGRZfSBzdHJva2U9e0MuYkx9IHN0cm9rZVdpZHRoPSIxLjUiLz4KICAgICAgICAgICAgICAgICAgPC9nPik7CiAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICA8L2c+KTsKICAgICAgICAgICAgfSkoKX0KCiAgICAgICAgICAgIHsvKiBDb25uZWN0b3IgbGluZXM6IGdlbjEgdG8gZ2VuMiAqL30KICAgICAgICAgICAge2dlblBlb3BsZVsyXS5tYXAoKGNoaWxkLGkpPT57CiAgICAgICAgICAgICAgaWYgKCFjaGlsZC5wYXJlbnQgfHwgIXBvc2l0aW9uc1tjaGlsZC5wYXJlbnRdKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICBjb25zdCBwcCA9IHBvc2l0aW9uc1tjaGlsZC5wYXJlbnRdOwogICAgICAgICAgICAgIGNvbnN0IGNwID0gcG9zaXRpb25zW2NoaWxkLmlkXTsKICAgICAgICAgICAgICBjb25zdCBweCA9IHBwLnggKyBub2RlVy8yOwogICAgICAgICAgICAgIGNvbnN0IHB5ID0gcHAueSArIG5vZGVIOwogICAgICAgICAgICAgIGNvbnN0IGN4ID0gY3AueCArIG5vZGVXLzI7CiAgICAgICAgICAgICAgY29uc3QgY3kgPSBjcC55OwogICAgICAgICAgICAgIGNvbnN0IG15ID0gcHkgKyAoY3ktcHkpKjAuNTsKICAgICAgICAgICAgICByZXR1cm4gKDxnIGtleT17aX0+CiAgICAgICAgICAgICAgICA8bGluZSB4MT17cHh9IHkxPXtweX0geDI9e3B4fSB5Mj17bXl9IHN0cm9rZT17Qy5iTH0gc3Ryb2tlV2lkdGg9IjEuNSIvPgogICAgICAgICAgICAgICAgPGxpbmUgeDE9e3B4fSB5MT17bXl9IHgyPXtjeH0geTI9e215fSBzdHJva2U9e0MuYkx9IHN0cm9rZVdpZHRoPSIxLjUiLz4KICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtjeH0geTE9e215fSB4Mj17Y3h9IHkyPXtjeX0gc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iMS41Ii8+CiAgICAgICAgICAgICAgPC9nPik7CiAgICAgICAgICAgIH0pfQoKICAgICAgICAgICAgey8qIE5vZGVzICovfQogICAgICAgICAgICB7dHJlZVBlb3BsZS5tYXAocD0+ewogICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBvc2l0aW9uc1twLmlkXTsKICAgICAgICAgICAgICBpZiAoIXBvcykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBzZWxJZCA9PT0gcC5pZDsKICAgICAgICAgICAgICBjb25zdCBpc0dhcCAgICA9IHAucm9sZSAmJiBwLnJvbGUuaW5jbHVkZXMoIk5PVCBJTiBET0NTIik7CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IGtleT17cC5pZH0geD17cG9zLnh9IHk9e3Bvcy55fSB3aWR0aD17bm9kZVd9IGhlaWdodD17bm9kZUh9PgogICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIgogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpPT5zZXRTZWxJZChpc0FjdGl2ZT9udWxsOnAuaWQpfQogICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7d2lkdGg6IjEwMCUiLGhlaWdodDoiMTAwJSIsCiAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiI4cHggMTBweCIsYm9yZGVyUmFkaXVzOjYsY3Vyc29yOiJwb2ludGVyIix0cmFuc2l0aW9uOiJhbGwgLjJzIiwKICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjoiMS41cHggc29saWQgIisoaXNBY3RpdmU/cC5jb2xvcjppc0dhcD9DLmRhKyI0NCI6cC5jb2xvcisiMzMiKSwKICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6aXNBY3RpdmU/cC5jb2xvcisiMGEiOmlzR2FwP0MuZGErIjA2IjoiI2ZmZiIsCiAgICAgICAgICAgICAgICAgICAgICBib3hTaGFkb3c6aXNBY3RpdmU/IjAgMnB4IDhweCByZ2JhKDAsMCwwLC4wOCkiOiJub25lIn19PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMSxmb250V2VpZ2h0OjYwMCxjb2xvcjppc0dhcD9DLmRhOnAuY29sb3IsbGluZUhlaWdodDoxLjIsbWFyZ2luQm90dG9tOjJ9fT57cC5uYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy50eEx9fT57cC5hZ2UgPyBwLmFnZSsiIHlycyIgOiAiIn08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OSxjb2xvcjppc0dhcD9DLmRhOkMudHhGLG1hcmdpblRvcDoxLGxpbmVIZWlnaHQ6MS4yfX0+e3Aucm9sZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSl9CgogICAgICAgICAgICB7LyogU3BvdXNlIGNvbm5lY3RvcnMgKi99CiAgICAgICAgICAgIHt0cmVlU3BvdXNlcy5tYXAoKHNwLGkpPT57CiAgICAgICAgICAgICAgY29uc3QgcmVsID0gdHJlZVBlb3BsZS5maW5kKHA9PnAuaWQ9PT1zcC5yZWx8fHAuaWQ9PT1zcC5pZCk7CiAgICAgICAgICAgICAgaWYgKCFyZWwgfHwgIXBvc2l0aW9uc1tyZWwuaWRdKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICBjb25zdCBycCA9IHBvc2l0aW9uc1tyZWwuaWRdOwogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBrZXk9e2l9IHg9e3JwLngrbm9kZVcrMTB9IHk9e3JwLnl9IHdpZHRoPXtub2RlV30gaGVpZ2h0PXtub2RlSH0+CiAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiCiAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3t3aWR0aDoiMTAwJSIsaGVpZ2h0OiIxMDAlIixwYWRkaW5nOiI4cHggMTBweCIsYm9yZGVyUmFkaXVzOjYsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IjEuNXB4IGRhc2hlZCAiK0MuYkwsYmFja2dyb3VuZDoiI2ZmZiJ9fT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsZm9udFdlaWdodDo2MDAsY29sb3I6Qy50eE19fT57c3AubmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OSxjb2xvcjpDLnR4RixtYXJnaW5Ub3A6Mn19PlNwb3VzZTwvZGl2PgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KX0KICAgICAgICAgIDwvc3ZnPgogICAgICAgIDwvZGl2PgoKICAgICAgICB7LyogU2VsZWN0ZWQgcGVyc29uIGRldGFpbCAqL30KICAgICAgICB7c2VsUCAmJiAoCiAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luOiIwIDE2cHggMTZweCIscGFkZGluZzoiMTRweCAxNnB4IixiYWNrZ3JvdW5kOkMuYmcsYm9yZGVyUmFkaXVzOjYsYm9yZGVyTGVmdDoiM3B4IHNvbGlkICIrc2VsUC5jb2xvcn19PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFdlaWdodDo2MDAsZm9udFNpemU6MTQsY29sb3I6c2VsUC5jb2xvcixtYXJnaW5Cb3R0b206OH19PntzZWxQLm5hbWV9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixmbGV4V3JhcDoid3JhcCIsZ2FwOjQsbWFyZ2luQm90dG9tOjh9fT4KICAgICAgICAgICAgICB7c2VsUC5yb2xlcy5tYXAoKHIsaSk9PnsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQWxlcnQgPSByLnN0YXJ0c1dpdGgoIk5PVCIpOwogICAgICAgICAgICAgICAgcmV0dXJuICg8ZGl2IGtleT17aX0gc3R5bGU9e3twYWRkaW5nOiIzcHggOHB4Iixib3JkZXJSYWRpdXM6Myxmb250U2l6ZToxMC41LAogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmlzQWxlcnQ/Qy5kYUw6c2VsUC5jb2xvcisiMTEiLAogICAgICAgICAgICAgICAgICBjb2xvcjppc0FsZXJ0P0MuZGE6c2VsUC5jb2xvcixib3JkZXI6IjFweCBzb2xpZCAiKyhpc0FsZXJ0P0MuZGE6c2VsUC5jb2xvcikrIjIyIn19PgogICAgICAgICAgICAgICAgICB7cn0KICAgICAgICAgICAgICAgIDwvZGl2Pik7CiAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICB7c2VsUC5ub3RlcyAmJiA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNn19PntzZWxQLm5vdGVzfTwvZGl2Pn0KICAgICAgICAgIDwvZGl2PgogICAgICAgICl9CgogICAgICAgIHsvKiBBZHZpc29ycyAqL30KICAgICAgICB7dHJlZUFkdmlzb3JzLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgPGRpdiBzdHlsZT17e3BhZGRpbmc6IjEycHggMTZweCIsYm9yZGVyVG9wOiIxcHggc29saWQgIitDLmJMfX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMCxjb2xvcjpDLnR4TCx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UiLGxldHRlclNwYWNpbmc6MC44LG1hcmdpbkJvdHRvbTo4fX0+QWR2aXNvcnkgVGVhbTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjEwLGZsZXhXcmFwOiJ3cmFwIn19PgogICAgICAgICAgICAgIHt0cmVlQWR2aXNvcnMubWFwKChhLGkpPT4oCiAgICAgICAgICAgICAgICA8ZGl2IGtleT17aX0gc3R5bGU9e3twYWRkaW5nOiI4cHggMTJweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGJvcmRlcjoiMXB4IHNvbGlkICIrQy5iTH19PgogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsZm9udFdlaWdodDo1MDAsY29sb3I6Qy50eH19PnthLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhMfX0+e2Eucm9sZX08L2Rpdj4KICAgICAgICAgICAgICAgICAge2Eubm90ZSYmPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLGNvbG9yOkMudHhGLG1hcmdpblRvcDoyfX0+e2Eubm90ZX08L2Rpdj59CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICApfQogICAgICA8L0NkPgogICAgKX0KICA8L2Rpdj4pOwp9CgoKLyogPT09PT09PT09PT0gQVBQID09PT09PT09PT09ICovCmZ1bmN0aW9uIEFwcCgpIHsKICBjb25zdCBbdmlldywgc2V0Vmlld10gPSB1c2VTdGF0ZSgwKTsKICBjb25zdCBbYWssIHNldEFrXSA9IHVzZVN0YXRlKDApOwogIGNvbnN0IGdvID0gaSA9PiB7c2V0VmlldyhpKTtzZXRBayhrPT5rKzEpO307CiAgY29uc3QgdGFicyA9IFsiUGxhbiBTbmFwc2hvdCIsIkFzc2V0IE1hcCIsIldhdGVyZmFsbCIsIlN0cmF0ZWd5IiwiVHJ1c3QgQXJjaGl0ZWN0dXJlIiwiTWlsZXN0b25lcyIsIkZhbWlseSBUcmVlIl07CiAgY29uc3QgVmlld3MgPSBbVjEsVjIsVjMsVjQsVjUsVjYsVjddOwogIGNvbnN0IENvbXAgPSBWaWV3c1t2aWV3XTsKICByZXR1cm4gKAogICAgPGRpdiBzdHlsZT17e2ZvbnRGYW1pbHk6Iklvd2FuIE9sZCBTdHlsZSxQYWxhdGlubyBMaW5vdHlwZSxQYWxhdGlubyxHZW9yZ2lhLHNlcmlmIixiYWNrZ3JvdW5kOkMuYmcsbWluSGVpZ2h0OiIxMDB2aCIsY29sb3I6Qy50eH19PgogICAgICA8ZGl2IHN0eWxlPXt7YmFja2dyb3VuZDoiIzFjMmExZSIscGFkZGluZzoiMTNweCAyNHB4IixkaXNwbGF5OiJmbGV4IixqdXN0aWZ5Q29udGVudDoic3BhY2UtYmV0d2VlbiIsYWxpZ25JdGVtczoiY2VudGVyIn19PgogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDoxNH19PgogICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjI2LGhlaWdodDoyNixib3JkZXJSYWRpdXM6IjUwJSIsYm9yZGVyOiIxLjVweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4yNSkiLGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciJ9fT48c3BhbiBzdHlsZT17e2ZvbnRTaXplOjExLGNvbG9yOiJyZ2JhKDI1NSwyNTUsMjU1LC43KSJ9fT5FPC9zcGFuPjwvZGl2PgogICAgICAgICAgPHNwYW4gc3R5bGU9e3tjb2xvcjoicmdiYSgyNTUsMjU1LDI1NSwuODUpIixmb250U2l6ZToxMy41LGZvbnRXZWlnaHQ6NTAwfX0+RXN0YXRlIFBsYW5uZXI8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT17e2NvbG9yOiJyZ2JhKDI1NSwyNTUsMjU1LC40NSkiLGZvbnRTaXplOjExLjUsZm9udEZhbWlseToic2Fucy1zZXJpZiJ9fT57ZmFtaWx5LmNsaWVudC5uYW1lLnNwbGl0KCIgIikucG9wKCkgKyAiIEZhbWlseSB8ICIgKyByZXBvcnREYXRlfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT17e2JhY2tncm91bmQ6IiNmZmYiLGJvcmRlckJvdHRvbToiMXB4IHNvbGlkICIrQy5ib3JkZXIsZGlzcGxheToiZmxleCIscGFkZGluZzoiMCAxMnB4IixvdmVyZmxvd1g6ImF1dG8ifX0+CiAgICAgICAge3RhYnMubWFwKCh0LGkpPT4oCiAgICAgICAgICA8YnV0dG9uIGtleT17aX0gb25DbGljaz17KCk9PmdvKGkpfSBzdHlsZT17e3BhZGRpbmc6IjEzcHggMTZweCIsYmFja2dyb3VuZDoidHJhbnNwYXJlbnQiLGJvcmRlcjoibm9uZSIsYm9yZGVyQm90dG9tOnZpZXc9PT1pPyIycHggc29saWQgIitDLmFjOiIycHggc29saWQgdHJhbnNwYXJlbnQiLGNvbG9yOnZpZXc9PT1pP0MuYWM6Qy50eEwsY3Vyc29yOiJwb2ludGVyIixmb250U2l6ZToxMi41LGZvbnRGYW1pbHk6IkRNIFNhbnMsc2Fucy1zZXJpZiIsZm9udFdlaWdodDp2aWV3PT09aT82MDA6NDAwLHdoaXRlU3BhY2U6Im5vd3JhcCIsdHJhbnNpdGlvbjoiYWxsIC4ycyJ9fT4KICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tvcGFjaXR5OjAuMzUsbWFyZ2luUmlnaHQ6NCxmb250U2l6ZTo5LjV9fT57IjAiKyhpKzEpfTwvc3Bhbj57dH0KICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICkpfQogICAgICA8L2Rpdj4KICAgICAgPGRpdiBrZXk9e2FrfSBzdHlsZT17e2FuaW1hdGlvbjoidmYgLjNzIGVhc2UiLHBhZGRpbmc6IjI0cHggMjRweCA1NnB4IixtYXhXaWR0aDoxMDgwLG1hcmdpbjoiMCBhdXRvIn19PjxDb21wIC8+PC9kaXY+CiAgICAgIDxzdHlsZT57IkBrZXlmcmFtZXMgdmZ7ZnJvbXtvcGFjaXR5OjA7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoNXB4KX10b3tvcGFjaXR5OjE7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoMCl9fSBAa2V5ZnJhbWVzIHB1ezAlLDEwMCV7Ym94LXNoYWRvdzowIDAgMCAwIHJnYmEoMjYsOTIsNTgsLjEyKX01MCV7Ym94LXNoYWRvdzowIDAgMCA2cHggcmdiYSgyNiw5Miw1OCwuMDQpfX0gKntib3gtc2l6aW5nOmJvcmRlci1ib3h9IDo6LXdlYmtpdC1zY3JvbGxiYXJ7d2lkdGg6NXB4O2hlaWdodDo1cHh9IDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWJ7YmFja2dyb3VuZDoiK0MuYm9yZGVyKyI7Ym9yZGVyLXJhZGl1czozcHh9In08L3N0eWxlPgogICAgPC9kaXY+CiAgKTsKfQoKUmVhY3RET00uY3JlYXRlUm9vdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpKS5yZW5kZXIoUmVhY3QuY3JlYXRlRWxlbWVudChBcHApKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=';
const HEAD = atob(HEAD_B64);
const COMP = atob(COMP_B64);

const SAMPLE_DATA = `const { useState } = React;

/* --- WHO --- */
const family = {
  client: { name: "John Smith",  age: 55 },
  spouse: { name: "Jane Smith",  age: 52 },
  children: [
    { name: "Emily Smith", age: 28, relationship: "biological", spouse: null, gc: [] },
  ],
};

const assets = [
  { id:1, name:"Primary Residence",   value:1200000, type:"Real Estate",  owner:"joint",  category:"retitle",     liquid:false, basis:450000, mortgage:300000, note:"Main home.", action:"Record deed into trust." },
  { id:2, name:"Brokerage Account",   value:800000,  type:"Investment",   owner:"joint",  category:"retitle",     liquid:true,  note:"Re-title to trust.", action:"Contact brokerage." },
  { id:3, name:"401(k)",              value:650000,  type:"Retirement",   owner:"client", category:"beneficiary", liquid:false, beneficiary:"Spouse (primary), children (contingent)", benStatus:"update", note:"Update contingent beneficiary.", action:"Change contingent to trust." },
  { id:4, name:"Term Life Insurance", value:1000000, type:"Insurance",    owner:"client", category:"beneficiary", liquid:false, beneficiary:"Spouse (primary), children (contingent)", benStatus:"update", note:"Update contingent beneficiary.", action:"Change contingent to trust." },
  { id:5, name:"Cash / Checking",     value:120000,  type:"Cash",         owner:"joint",  category:"retitle",     liquid:true,  note:"Add trust as POD.", action:"Re-title or add POD." },
];

const totalEstate      = assets.reduce((s,a)=>s+a.value,0);
const mortgage         = assets.reduce((s,a)=>s+(a.mortgage||0),0);
const grossEquity      = totalEstate - mortgage;
const liquidVal        = assets.filter(a=>a.liquid).reduce((s,a)=>s+a.value,0);
const inTrustVal       = assets.filter(a=>a.category==="in-trust").reduce((s,a)=>s+a.value,0);
const needsRetitleVal  = assets.filter(a=>a.category==="retitle").reduce((s,a)=>s+a.value,0);
const benefDesigVal    = assets.filter(a=>a.category==="beneficiary").reduce((s,a)=>s+a.value,0);
const custodialVal     = assets.filter(a=>a.category==="custodial").reduce((s,a)=>s+a.value,0);
const benefNeedsUpdate = assets.filter(a=>a.category==="beneficiary"&&a.benStatus==="update").length;

const strategyScore  = 68;
const executionScore = 32;
const reportDate     = "February 2026";
const domicileState  = "Texas";
const cogSummary     = "Texas has no state estate tax. Planning focus is probate avoidance via a funded revocable trust and careful beneficiary designation alignment.";

const planProfile   = "Comprehensive Family Protection";
const planRationale = "Estate size and family structure point to a trust-centered plan.";

const headline = {
  title: "Your instincts are sound. The execution needs catching up.",
  body:  "You have the right framework in mind. What is missing is mostly paperwork: accounts not yet titled into the trust and beneficiary forms that name children directly instead of the trust.",
};

const foundationItems = [
  { t:"Revocable trust established",       n:"Core structure exists." },
  { t:"Life insurance in force",           n:"Coverage is adequate." },
  { t:"Retirement accounts funded",        n:"Spouse correctly named as primary beneficiary." },
];

const executionItems = [
  { t:"Most assets outside the trust",     n:"Brokerage and cash need re-titling." },
  { t:"Beneficiary designations stale",    n:"Contingent beneficiaries name children directly." },
  { t:"Documents more than 5 years old",   n:"POAs and healthcare directives need refreshing." },
];

const priorities = [
  { tier:"now",   label:"Act Now",       tierColor:"#b03a2e", tierBg:"#fbeae8", desc:"Real risk if delayed. Do this quarter.",
    items:[
      { title:"Re-title brokerage account into trust", value:800000, why:"Without this, the account goes through probate.", effort:"Call brokerage", est:"2 weeks" },
      { title:"Update beneficiary designations",       value:1650000, why:"Children named directly bypasses trust protections.", effort:"One form per account", est:"1-2 weeks" },
    ]},
  { tier:"year",  label:"This Year",     tierColor:"#b8860b", tierBg:"#fef8ec", desc:"Important but not emergency.",
    items:[
      { title:"Update trust provisions", value:null, why:"Trust predates current family picture.", effort:"Attorney engagement", est:"$6K-$12K" },
    ]},
  { tier:"later", label:"Future Review", tierColor:"#8a847a", tierBg:"#f6f4ef", desc:"Monitor and revisit.",
    items:[
      { title:"Annual gifting strategy", value:null, why:"Reduces estate over time.", effort:"Annual review", est:"Each year" },
    ]},
];

const documents = [
  { name:"Revocable Trust",       status:"outdated", year:2018, note:"Does not reflect current family." },
  { name:"Pour-Over Will",        status:"outdated", year:2018, note:null },
  { name:"Financial POA",         status:"outdated", year:2018, note:"Add digital asset provisions." },
  { name:"Healthcare Directive",  status:"outdated", year:2018, note:null },
];

const milestones = [
  { date:"2018",    label:"Estate plan established",          st:"done",     cat:"Documents", detail:"Trust, wills, POAs executed." },
  { date:"Q1 2026", label:"Comprehensive review begins",      st:"active",   cat:"Planning",  detail:"Most assets unfunded, docs aging." },
  { date:"Q1 2026", label:"Re-title accounts into trust",     st:"upcoming", cat:"Titling",   detail:"Brokerage and cash accounts." },
  { date:"Q2 2026", label:"Update trust and documents",       st:"upcoming", cat:"Documents", detail:"Attorney engagement." },
  { date:"Annual",  label:"Review trust and beneficiaries",   st:"future",   cat:"Planning",  detail:null },
];

const strategyRows = [
  { l:"Probate Avoidance",        cu:"Partial",              pr:"Full trust funding",       d:"Brokerage and cash need re-titling.", hl:true  },
  { l:"Beneficiary Designations", cu:"Children named directly", pr:"Trust as contingent",  d:"Change contingent to trust on all accounts.", hl:true  },
  { l:"Document Currency",        cu:"2018 docs",            pr:"Refreshed",                d:"POAs and directives need updating.", hl:false },
];

const waterfallConfig = {
  isMarried: true, hasStateTax: false, stateTaxNote: "",
  firstDeathFlow: "to_spouse",
  portabilityNote: "File Form 706 within 9 months to preserve portability.",
  fundingGapNote: "$1.92M in accounts still need re-titling.",
  secondDeathDistribution: "outright", subtrustsNote: "",
  adminCosts: 150000,
  beneficiaryColumns: [
    { label:"Children", people:["Emily Smith"], note:"Outright distribution per trust terms." },
  ],
};

const trustEntities = [
  { name:"Smith Family Revocable Trust", type:"Revocable Living Trust", established:"2018 (needs update)",
    grantor:"John and Jane Smith", trustee:"John and Jane Smith", successor:"Emily Smith",
    protector:null, beneficiaries:"Children equally",
    assetList:["No assets currently titled in trust"],
    totalValue:0, status:"outdated", color:"#b03a2e",
    provisions:[
      { label:"Current State", text:"Basic trust, no assets funded, needs restatement." },
    ],
  },
];

const treePeople = [
  { id:"client", name:"John Smith",  age:55, gen:0, role:"Grantor / Trustee", color:"#2a5a8c", roles:["Co-Grantor","Co-Trustee"], notes:"POA needs updating." },
  { id:"spouse", name:"Jane Smith",  age:52, gen:0, role:"Grantor / Trustee", color:"#6a4a8a", roles:["Co-Grantor","Primary beneficiary"], notes:"Primary beneficiary on all accounts." },
  { id:"child1", name:"Emily Smith", age:28, gen:1, role:"Beneficiary",        color:"#1a5c3a", roles:["Successor Trustee","Outright beneficiary"], notes:"Named successor trustee." },
];
const treeSpouses  = [];
const treeAdvisors = [];

const ilitAnalysis = {
  situation: "Client holds term life insurance. Estate is under federal exemption.",
  pros: [
    { label:"Removes death benefit from estate", text:"Useful if estate grows beyond exemption." },
  ],
  cons: [
    { label:"Irrevocable", text:"Cannot be modified after creation." },
    { label:"Estate under exemption", text:"No immediate tax benefit." },
  ],
  recommendation: "Lean against an ILIT at this time. Revisit if estate grows significantly.",
};

const higginsNote = "The picture here is an encouraging one. The architecture is sound and what remains is a focused quarter of administrative work.";
`;

function validate(text) {
  const el = document.getElementById('validation');
  const btn = document.getElementById('generateBtn');
  if (!text.trim()) {
    el.textContent = '';
    el.className = 'validation';
    btn.disabled = true;
    return false;
  }
  if (!text.includes('const family')) {
    el.textContent = '⚠ Missing family data — paste the full data block from Higgins.';
    el.className = 'validation error';
    btn.disabled = true;
    return false;
  }
  if (!text.includes('const assets')) {
    el.textContent = '⚠ Missing assets data — paste the full data block from Higgins.';
    el.className = 'validation error';
    btn.disabled = true;
    return false;
  }
  if (!text.includes('waterfallConfig')) {
    el.textContent = '⚠ Missing waterfallConfig — paste the full data block from Higgins.';
    el.className = 'validation warn';
    btn.disabled = false;
    return true;
  }
  el.textContent = '✓ Data block looks good.';
  el.className = 'validation ok';
  btn.disabled = false;
  return true;
}

document.getElementById('dataInput').addEventListener('input', function() {
  validate(this.value);
});

function loadSample() {
  document.getElementById('dataInput').value = SAMPLE_DATA;
  validate(SAMPLE_DATA);
}

function generate() {
  const data = document.getElementById('dataInput').value.trim();
  if (!validate(data)) return;

  // Assemble the full HTML
    const fullHTML = HEAD + data + '\n\n' + COMP;

  // Create blob and download link
  const blob = new Blob([fullHTML], { type: 'text/html' });
  const url  = URL.createObjectURL(blob);

  // Get client name for filename
  const nameMatch = data.match(/client:\s*\{\s*name:\s*"([^"]+)"/);
  const lastName  = nameMatch ? nameMatch[1].split(' ').pop() : 'Client';
  const filename  = lastName + '-LegacyMap.html';

  const link = document.getElementById('downloadLink');
  link.href     = url;
  link.download = filename;

  document.getElementById('successCard').classList.add('visible');
  document.getElementById('successCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}
</script>

</body>
</html>