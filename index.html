<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LegacyMap Generator — Higgins Estate Planning</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #f6f4ef;
    --bg2: #efecea;
    --border: #d8d2c4;
    --tx: #2c2a26;
    --txl: #8a847a;
    --ac: #1a5c3a;
    --acl: #e8f2ec;
    --wa: #b8860b;
    --wal: #fef8ec;
    --da: #b03a2e;
    --dal: #fbeae8;
    --white: #ffffff;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    color: var(--tx);
  }

  /* ── HEADER ── */
  header {
    background: #1c2a1e;
    padding: 18px 40px;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .header-monogram {
    width: 32px; height: 32px;
    border-radius: 50%;
    border: 1.5px solid rgba(255,255,255,.3);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px; color: rgba(255,255,255,.8);
    flex-shrink: 0;
  }
  .header-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 18px; font-weight: 400;
    color: rgba(255,255,255,.85);
    letter-spacing: 0.3px;
  }
  .header-sub {
    font-size: 11px;
    color: rgba(255,255,255,.4);
    margin-left: auto;
    font-weight: 300;
    letter-spacing: 0.5px;
  }

  /* ── MAIN LAYOUT ── */
  main {
    max-width: 860px;
    margin: 0 auto;
    padding: 48px 24px 80px;
  }

  /* ── INTRO ── */
  .intro {
    margin-bottom: 40px;
  }
  .intro h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 34px; font-weight: 300;
    letter-spacing: -0.5px;
    line-height: 1.2;
    margin-bottom: 12px;
    color: var(--tx);
  }
  .intro h1 em {
    font-style: italic;
    color: var(--ac);
  }
  .intro p {
    font-size: 14px;
    color: var(--txl);
    line-height: 1.7;
    max-width: 620px;
  }

  /* ── STEPS ── */
  .steps {
    display: flex;
    gap: 0;
    margin-bottom: 36px;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: var(--white);
  }
  .step {
    flex: 1;
    padding: 18px 20px;
    border-right: 1px solid var(--border);
    position: relative;
  }
  .step:last-child { border-right: none; }
  .step-num {
    font-size: 10px;
    font-weight: 500;
    color: var(--txl);
    letter-spacing: 1.2px;
    text-transform: uppercase;
    margin-bottom: 5px;
  }
  .step-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    font-weight: 500;
    color: var(--tx);
    margin-bottom: 4px;
  }
  .step-desc {
    font-size: 11.5px;
    color: var(--txl);
    line-height: 1.5;
  }
  .step-active .step-num { color: var(--ac); }
  .step-active .step-title { color: var(--ac); }
  .step-active::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--ac);
  }

  /* ── CARD ── */
  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 28px 32px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,.04);
  }
  .card-label {
    font-size: 10px;
    font-weight: 500;
    color: var(--txl);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }
  .card h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px; font-weight: 400;
    margin-bottom: 8px;
  }
  .card p {
    font-size: 13px;
    color: var(--txl);
    line-height: 1.6;
    margin-bottom: 16px;
  }

  /* ── TEXTAREA ── */
  textarea {
    width: 100%;
    height: 320px;
    border: 1.5px solid var(--border);
    border-radius: 6px;
    padding: 16px 18px;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
    font-size: 12px;
    line-height: 1.6;
    color: var(--tx);
    background: #fdfcf8;
    resize: vertical;
    outline: none;
    transition: border-color .2s;
  }
  textarea:focus {
    border-color: var(--ac);
  }
  textarea::placeholder {
    color: var(--txl);
    opacity: 0.6;
  }

  /* ── VALIDATION ── */
  .validation {
    margin-top: 10px;
    font-size: 12px;
    min-height: 20px;
    transition: all .2s;
  }
  .validation.ok    { color: var(--ac); }
  .validation.error { color: var(--da); }
  .validation.warn  { color: var(--wa); }

  /* ── BUTTONS ── */
  .actions {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-top: 20px;
  }
  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 13px 28px;
    background: #1c2a1e;
    color: rgba(255,255,255,.9);
    border: none;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    font-weight: 500;
    cursor: pointer;
    transition: all .2s;
    letter-spacing: 0.2px;
  }
  .btn-primary:hover { background: #253528; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.15); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
  .btn-secondary {
    padding: 12px 20px;
    background: transparent;
    color: var(--txl);
    border: 1px solid var(--border);
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all .2s;
  }
  .btn-secondary:hover { border-color: var(--tx); color: var(--tx); }

  /* ── SUCCESS STATE ── */
  .success-card {
    background: var(--acl);
    border: 1px solid var(--ac) + '22';
    border-radius: 8px;
    padding: 28px 32px;
    display: none;
    animation: fadeUp .3s ease;
  }
  .success-card.visible { display: block; }
  .success-icon {
    width: 40px; height: 40px;
    border-radius: 50%;
    background: var(--ac);
    color: white;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    margin-bottom: 14px;
  }
  .success-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px; font-weight: 400;
    color: var(--ac);
    margin-bottom: 6px;
  }
  .success-card p {
    font-size: 13px;
    color: var(--ac);
    opacity: 0.8;
    line-height: 1.6;
    margin-bottom: 16px;
  }
  .btn-download {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: var(--ac);
    color: white;
    border: none;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    transition: all .2s;
  }
  .btn-download:hover { background: #154d30; transform: translateY(-1px); }

  /* ── HIGGINS NOTE ── */
  .higgins-note {
    margin-top: 36px;
    padding: 20px 24px;
    border-left: 3px solid var(--border);
    background: var(--white);
    border-radius: 0 6px 6px 0;
  }
  .higgins-note p {
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    font-style: italic;
    color: var(--txl);
    line-height: 1.7;
  }
  .higgins-note cite {
    display: block;
    margin-top: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: var(--txl);
    opacity: 0.7;
    letter-spacing: 0.5px;
    font-style: normal;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(6px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<header>
  <div class="header-monogram">H</div>
  <div class="header-title">LegacyMap Generator</div>
  <div class="header-sub">Higgins Estate Planning System</div>
</header>

<main>

  <div class="intro">
    <h1>Generate your <em>LegacyMap</em></h1>
    <p>Paste the data block from your Higgins conversation below, click Generate, and download your complete interactive estate plan dashboard.</p>
  </div>

  <div class="steps">
    <div class="step step-active">
      <div class="step-num">Step 01</div>
      <div class="step-title">Copy from Higgins</div>
      <div class="step-desc">At the end of your conversation, ask Higgins to "generate my LegacyMap data block."</div>
    </div>
    <div class="step">
      <div class="step-num">Step 02</div>
      <div class="step-title">Paste below</div>
      <div class="step-desc">Paste the JavaScript data block into the field below.</div>
    </div>
    <div class="step">
      <div class="step-num">Step 03</div>
      <div class="step-title">Download & open</div>
      <div class="step-desc">Click Generate. Save the file. Open in any browser.</div>
    </div>
  </div>

  <div class="card">
    <div class="card-label">Your LegacyMap Data</div>
    <h2>Paste the data block here</h2>
    <p>The data block starts with <code>const { useState } = React;</code> and ends with the comment <code>/* DO NOT EDIT BELOW THIS LINE */</code>. Paste everything between those markers.</p>
    <textarea id="dataInput" placeholder="const { useState } = React;&#10;&#10;/* --- WHO --- */&#10;const family = {&#10;  client: { name: &quot;...&quot;, age: 55 },&#10;  ...&#10;}"></textarea>
    <div class="validation" id="validation"></div>
    <div class="actions">
      <button class="btn-primary" id="generateBtn" onclick="generate()">
        <span>&#9654;</span> Generate LegacyMap
      </button>
      <button class="btn-secondary" onclick="loadSample()">Load sample data</button>
    </div>
  </div>

  <div class="success-card" id="successCard">
    <div class="success-icon">&#10003;</div>
    <h3>Your LegacyMap is ready.</h3>
    <p>Save the file to your computer and open it in any browser. You will find seven interactive tabs covering your complete estate plan picture.</p>
    <a class="btn-download" id="downloadLink" href="#" download="LegacyMap.html">
      &#8595; Download LegacyMap.html
    </a>
  </div>

  <div class="higgins-note">
    <p>"The LegacyMap is not the plan itself — it is the clearest possible picture of where things stand and what remains to be done. A document of this quality, walked into an attorney's office, is worth considerably more than an hour of unprepared conversation."</p>
    <cite>— Jonathan Quayle Higgins III</cite>
  </div>

</main>

<script>
const HEAD_B64 = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+TGVnYWN5TWFwIHwgSGlnZ2lucyBFc3RhdGUgUGxhbm5pbmc8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvcmVhY3QvMTguMi4wL3VtZC9yZWFjdC5wcm9kdWN0aW9uLm1pbi5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9yZWFjdC1kb20vMTguMi4wL3VtZC9yZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanMiPjwvc2NyaXB0Pgo8c2NyaXB0PgooZnVuY3Rpb24oKXt2YXIgdz1jb25zb2xlLndhcm47Y29uc29sZS53YXJuPWZ1bmN0aW9uKCl7aWYoYXJndW1lbnRzWzBdJiZ0eXBlb2YgYXJndW1lbnRzWzBdPT09J3N0cmluZycmJmFyZ3VtZW50c1swXS5pbmRleE9mKCdwcmVjb21waWxlJyk+LTEpcmV0dXJuO3cuYXBwbHkoY29uc29sZSxhcmd1bWVudHMpO319KSgpOwo8L3NjcmlwdD4KPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2JhYmVsLXN0YW5kYWxvbmUvNy4yMy45L2JhYmVsLm1pbi5qcyI+PC9zY3JpcHQ+CjxzdHlsZT4KICAqIHsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9CiAgYm9keSB7IGZvbnQtZmFtaWx5OiAnSW93YW4gT2xkIFN0eWxlJywgJ1BhbGF0aW5vIExpbm90eXBlJywgUGFsYXRpbm8sIEdlb3JnaWEsIHNlcmlmOyB9CiAgI3Jvb3QgeyBtaW4taGVpZ2h0OiAxMDB2aDsgfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJyb290Ij48L2Rpdj4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2JhYmVsIj4K';
const COMP_B64 = 'LyogPT09PT09PT09PT0gVVRJTCA9PT09PT09PT09PSAqLwpjb25zdCBmbXQgPSAodikgPT4geyBpZiAodiA+PSAxZTYpIHJldHVybiAiJCIgKyAodiAvIDFlNikudG9GaXhlZCgxKSArICJNIjsgaWYgKHYgPj0gMWUzKSByZXR1cm4gIiQiICsgKHYgLyAxZTMpLnRvRml4ZWQoMCkgKyAiSyI7IHJldHVybiAiJCIgKyB2OyB9Owpjb25zdCBmbXRGID0gKHYpID0+ICIkIiArIHYudG9Mb2NhbGVTdHJpbmcoKTsKY29uc3QgQyA9IHsgYmc6IiNmNmY0ZWYiLCBiTDoiI2U4ZTRkYiIsIGJvcmRlcjoiI2Q4ZDJjNCIsIHR4OiIjMmMyYTI2IiwgdHhNOiIjNWE1NjRlIiwgdHhMOiIjOGE4NDdhIiwgdHhGOiIjYjBhOTllIiwgYWM6IiMxYTVjM2EiLCBhY0w6IiNlOGYyZWMiLCB3YToiI2I4ODYwYiIsIHdhTDoiI2ZlZjhlYyIsIHdhQmc6IiNmZGYzZGEiLCBkYToiI2IwM2EyZSIsIGRhTDoiI2ZiZWFlOCIsIGJsOiIjMmE1YThjIiwgYmxMOiIjZThmMGY4IiwgcHU6IiM2YTRhOGEiLCBwdUw6IiNmMGVjZjQiIH07CmNvbnN0IGNhdE1ldGEgPSB7CiAgImluLXRydXN0IjogeyBsYWJlbDogIlRpdGxlZCBpbiBUcnVzdCIsIHNob3J0OiAiSU4gVFJVU1QiLCBjb2xvcjogQy5hYywgYmc6IEMuYWNMIH0sCiAgInJldGl0bGUiOiB7IGxhYmVsOiAiTmVlZHMgUmUtVGl0bGluZyIsIHNob3J0OiAiUkUtVElUTEUiLCBjb2xvcjogQy53YSwgYmc6IEMud2FCZyB9LAogICJiZW5lZmljaWFyeSI6IHsgbGFiZWw6ICJCZW5lZmljaWFyeSBEZXNpZ25hdGlvbiIsIHNob3J0OiAiQkVORUYuIERFU0lHLiIsIGNvbG9yOiBDLmJsLCBiZzogQy5ibEwgfSwKICAiY3VzdG9kaWFsIjogeyBsYWJlbDogIkN1c3RvZGlhbCBBY2NvdW50Iiwgc2hvcnQ6ICJDVVNUT0RJQUwiLCBjb2xvcjogQy5wdSwgYmc6IEMucHVMIH0sCn07CgovKiA9PT09PT09PT09PSBTSEFSRUQgPT09PT09PT09PT0gKi8KZnVuY3Rpb24gVlQoe3QsIHN9KSB7IHJldHVybiAoPGRpdiBzdHlsZT17e21hcmdpbkJvdHRvbToyMH19PjxoMiBzdHlsZT17e2ZvbnRTaXplOjIyLGZvbnRXZWlnaHQ6NDAwLG1hcmdpbjoiMCAwIDNweCIsbGV0dGVyU3BhY2luZzotMC4zfX0+e3R9PC9oMj48cCBzdHlsZT17e2ZvbnRTaXplOjEzLjUsY29sb3I6Qy50eEwsbWFyZ2luOjB9fT57c308L3A+PC9kaXY+KTsgfQpmdW5jdGlvbiBDZCh7Y2hpbGRyZW4sIHN0eWxlOiBzeH0pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7cGFkZGluZzoiMThweCAyMnB4IixiYWNrZ3JvdW5kOiIjZmZmIixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjFweCBzb2xpZCAiK0MuYkwsYm94U2hhZG93OiIwIDFweCAycHggcmdiYSgwLDAsMCwuMDMpIiwuLi4oc3h8fHt9KX19PntjaGlsZHJlbn08L2Rpdj4pOyB9CmZ1bmN0aW9uIENMKHtjaGlsZHJlbn0pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMudHhMLGxldHRlclNwYWNpbmc6MC45LHRleHRUcmFuc2Zvcm06InVwcGVyY2FzZSIsZm9udEZhbWlseToic2Fucy1zZXJpZiIsZm9udFdlaWdodDo1MDB9fT57Y2hpbGRyZW59PC9kaXY+KTsgfQpmdW5jdGlvbiBNUyh7bCwgdiwgY30pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7ZmxleDoxfX0+PGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEx9fT57bH08L2Rpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTcsZm9udFdlaWdodDo0MDAsY29sb3I6Y319Pnt2fTwvZGl2PjwvZGl2Pik7IH0KZnVuY3Rpb24gU0RvdCh7c30pIHsgY29uc3QgY289e2N1cnJlbnQ6Qy5hYyxvdXRkYXRlZDpDLndhLHByb3Bvc2VkOkMuYmwscGxhbm5lZDpDLmFjLGFuYWx5c2lzOkMucHV9OyByZXR1cm4gKDxkaXYgc3R5bGU9e3t3aWR0aDo2LjUsaGVpZ2h0OjYuNSxib3JkZXJSYWRpdXM6IjUwJSIsYmFja2dyb3VuZDpjb1tzXXx8Qy50eEYsZmxleFNocmluazowfX0gLz4pOyB9CmZ1bmN0aW9uIERSKHtsLCB2LCB2Y30pIHsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6InNwYWNlLWJldHdlZW4iLHBhZGRpbmc6IjNweCAwIixmb250U2l6ZToxMS41fX0+PHNwYW4gc3R5bGU9e3tjb2xvcjpDLnR4TH19PntsfTwvc3Bhbj48c3BhbiBzdHlsZT17e2NvbG9yOnZjfHxDLnR4TSxmb250V2VpZ2h0OjUwMCx0ZXh0QWxpZ246InJpZ2h0IixtYXhXaWR0aDoiNjUlIn19Pnt2fTwvc3Bhbj48L2Rpdj4pOyB9CmZ1bmN0aW9uIFdOKHtsLCB2LCBjbywgc20sIGUsIGNrLCBkfSkgeyByZXR1cm4gKDxkaXYgb25DbGljaz17Y2t9IHN0eWxlPXt7cGFkZGluZzpzbT8iMTBweCAxNnB4IjoiMTFweCAyMnB4Iixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjEuNXB4IHNvbGlkICIrY28rIjQ0IixiYWNrZ3JvdW5kOmU/Y28rIjA4IjoiI2ZmZiIsdGV4dEFsaWduOiJjZW50ZXIiLG1pbldpZHRoOnNtPzE0MDoyMDAsY3Vyc29yOmQ/InBvaW50ZXIiOiJkZWZhdWx0Iix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PjxkaXYgc3R5bGU9e3tmb250U2l6ZTpzbT8xMDoxMSxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206MX19PntsfTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZTpzbT8xNzoyMSxmb250V2VpZ2h0OjMwMCxjb2xvcjpjb319PntmbXQodil9PC9kaXY+e2QmJjxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy50eEYsbWFyZ2luVG9wOjF9fT57ZT8iY29sbGFwc2UiOiJkZXRhaWxzIn08L2Rpdj59e2UmJmQmJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6OCxwYWRkaW5nOiI4cHggMTBweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGZvbnRTaXplOjExLjUsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjUsdGV4dEFsaWduOiJsZWZ0IixhbmltYXRpb246InZmIC4xNXMgZWFzZSJ9fT57ZH08L2Rpdj59PC9kaXY+KTsgfQpmdW5jdGlvbiBGQSh7bCwgY299KSB7IGNvbnN0IGNvbG9yPWNvfHxDLnR4RjsgcmV0dXJuICg8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZmxleERpcmVjdGlvbjoiY29sdW1uIixhbGlnbkl0ZW1zOiJjZW50ZXIiLHBhZGRpbmc6IjNweCAwIn19PjxkaXYgc3R5bGU9e3t3aWR0aDoxLjUsaGVpZ2h0OjE0LGJhY2tncm91bmQ6Y29sb3IrIjQ0In19IC8+e2wmJjxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Y29sb3IscGFkZGluZzoiMnB4IDdweCIsYmFja2dyb3VuZDpjb2xvcisiMDgiLGJvcmRlclJhZGl1czozLG1hcmdpbjoiMS41cHggMCIsbWF4V2lkdGg6NDAwLHRleHRBbGlnbjoiY2VudGVyIixsaW5lSGVpZ2h0OjEuM319PntsfTwvZGl2Pn08ZGl2IHN0eWxlPXt7d2lkdGg6MCxoZWlnaHQ6MCxib3JkZXJMZWZ0OiI0LjVweCBzb2xpZCB0cmFuc3BhcmVudCIsYm9yZGVyUmlnaHQ6IjQuNXB4IHNvbGlkIHRyYW5zcGFyZW50Iixib3JkZXJUb3A6IjUuNXB4IHNvbGlkICIrY29sb3IrIjY2In19IC8+PC9kaXY+KTsgfQpmdW5jdGlvbiBTQmFkZ2Uoe3QsIGNvfSkgeyByZXR1cm4gKDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDotNyxyaWdodDoxMCxwYWRkaW5nOiIxLjVweCA3cHgiLGJhY2tncm91bmQ6Y28sY29sb3I6IiNmZmYiLGZvbnRTaXplOjguNSxib3JkZXJSYWRpdXM6MyxsZXR0ZXJTcGFjaW5nOjAuNyxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixmb250V2VpZ2h0OjYwMCx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UifX0+e3R9PC9kaXY+KTsgfQpmdW5jdGlvbiBHQyh7bCwgcCwgbiwgY299KSB7IHJldHVybiAoPGRpdiBzdHlsZT17e3RleHRBbGlnbjoiY2VudGVyIixtYXhXaWR0aDoyMDB9fT48ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOmNvLGxldHRlclNwYWNpbmc6MC42LGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGZvbnRXZWlnaHQ6NTAwLG1hcmdpbkJvdHRvbTo4fX0+e2x9PC9kaXY+e3AubWFwKCh4LGkpPT4oPGRpdiBrZXk9e2l9IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eE0sbWFyZ2luQm90dG9tOjJ9fT57eH08L2Rpdj4pKX08ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAuNSxjb2xvcjpDLnR4RixtYXJnaW5Ub3A6NixsaW5lSGVpZ2h0OjEuNCxmb250U3R5bGU6Iml0YWxpYyJ9fT57bn08L2Rpdj48L2Rpdj4pOyB9CmZ1bmN0aW9uIFBCKHtuLCBhfSkgeyByZXR1cm4gKDxkaXYgc3R5bGU9e3t0ZXh0QWxpZ246ImNlbnRlciJ9fT48ZGl2IHN0eWxlPXt7d2lkdGg6NDIsaGVpZ2h0OjQyLGJvcmRlclJhZGl1czoiNTAlIixiYWNrZ3JvdW5kOkMuYWNMLGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsbWFyZ2luOiIwIGF1dG8gNHB4Iixmb250U2l6ZToxNCxjb2xvcjpDLmFjLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLGZvbnRXZWlnaHQ6NjAwfX0+e24uY2hhckF0KDApfTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxmb250V2VpZ2h0OjUwMH19PntufTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhMfX0+eyJBZ2UgIithfTwvZGl2PjwvZGl2Pik7IH0KCi8qID09PT09PT09PT09IFYxOiBQTEFOIFNOQVBTSE9UID09PT09PT09PT09ICovCmZ1bmN0aW9uIFYxKCkgewogIGNvbnN0IFtleHBQcmksIHNldEV4cFByaV0gPSB1c2VTdGF0ZShudWxsKTsKCiAgcmV0dXJuICg8ZGl2PgogICAgPFZUIHQ9IlBsYW4gU25hcHNob3QiIHM9e3BsYW5Qcm9maWxlICsgIiAtLSAiICsgcmVwb3J0RGF0ZX0gLz4KCiAgICB7LyogSGVhZGxpbmUgKi99CiAgICA8Q2Qgc3R5bGU9e3ttYXJnaW5Cb3R0b206MTYsYm9yZGVyTGVmdDoiM3B4IHNvbGlkICIrQy5hY319PgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiZmxleC1zdGFydCIsZ2FwOjE0fX0+CiAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjM2LGhlaWdodDozNixib3JkZXJSYWRpdXM6IjUwJSIsYmFja2dyb3VuZDpDLmFjTCxkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGp1c3RpZnlDb250ZW50OiJjZW50ZXIiLGZvbnRTaXplOjE2LGNvbG9yOkMuYWMsZmxleFNocmluazowLG1hcmdpblRvcDoyfX0+JiMxMDAwMzs8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjE1LGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMudHgsbGluZUhlaWdodDoxLjN9fT57aGVhZGxpbmUudGl0bGV9PC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6NCxsaW5lSGVpZ2h0OjEuNn19PntoZWFkbGluZS5ib2R5fTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvQ2Q+CgogICAgey8qIEdhdWdlcyArIEZhbWlseSAqL30KICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJncmlkIixncmlkVGVtcGxhdGVDb2x1bW5zOiIyODBweCAxZnIiLGdhcDoxNixtYXJnaW5Cb3R0b206MTZ9fT4KICAgICAgPENkPgogICAgICAgIDxDTD5QbGFuIEhlYWx0aDwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDoxNixtYXJnaW5Ub3A6MTB9fT4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmbGV4OjEsdGV4dEFsaWduOiJjZW50ZXIifX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoicmVsYXRpdmUiLHdpZHRoOjgwLGhlaWdodDo4MCxtYXJnaW46IjAgYXV0byA2cHgifX0+CiAgICAgICAgICAgICAgPHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCI+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzQiIGZpbGw9Im5vbmUiIHN0cm9rZT17Qy5iTH0gc3Ryb2tlV2lkdGg9IjUiLz48Y2lyY2xlIGN4PSI0MCIgY3k9IjQwIiByPSIzNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPXtDLmFjfSBzdHJva2VXaWR0aD0iNSIgc3Ryb2tlRGFzaGFycmF5PXsoc3RyYXRlZ3lTY29yZS8xMDApKjIxMy42KyIgMjEzLjYifSBzdHJva2VMaW5lY2FwPSJyb3VuZCIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwIDQwIDQwKSIvPjwvc3ZnPgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDoiNTAlIixsZWZ0OiI1MCUiLHRyYW5zZm9ybToidHJhbnNsYXRlKC01MCUsLTUwJSkiLHRleHRBbGlnbjoiY2VudGVyIn19PjxkaXYgc3R5bGU9e3tmb250U2l6ZToyMixmb250V2VpZ2h0OjMwMCxjb2xvcjpDLmFjLGxpbmVIZWlnaHQ6MX19PntzdHJhdGVneVNjb3JlfTwvZGl2PjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMuYWN9fT5TdHJhdGVneTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMudHhGLG1hcmdpblRvcDoxfX0+QXJjaGl0ZWN0dXJlIHF1YWxpdHk8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZsZXg6MSx0ZXh0QWxpZ246ImNlbnRlciJ9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e3Bvc2l0aW9uOiJyZWxhdGl2ZSIsd2lkdGg6ODAsaGVpZ2h0OjgwLG1hcmdpbjoiMCBhdXRvIDZweCJ9fT4KICAgICAgICAgICAgICA8c3ZnIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48Y2lyY2xlIGN4PSI0MCIgY3k9IjQwIiByPSIzNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iNSIvPjxjaXJjbGUgY3g9IjQwIiBjeT0iNDAiIHI9IjM0IiBmaWxsPSJub25lIiBzdHJva2U9e0Mud2F9IHN0cm9rZVdpZHRoPSI1IiBzdHJva2VEYXNoYXJyYXk9eyhleGVjdXRpb25TY29yZS8xMDApKjIxMy42KyIgMjEzLjYifSBzdHJva2VMaW5lY2FwPSJyb3VuZCIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwIDQwIDQwKSIvPjwvc3ZnPgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDoiNTAlIixsZWZ0OiI1MCUiLHRyYW5zZm9ybToidHJhbnNsYXRlKC01MCUsLTUwJSkiLHRleHRBbGlnbjoiY2VudGVyIn19PjxkaXYgc3R5bGU9e3tmb250U2l6ZToyMixmb250V2VpZ2h0OjMwMCxjb2xvcjpDLndhLGxpbmVIZWlnaHQ6MX19PntleGVjdXRpb25TY29yZX08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMSxmb250V2VpZ2h0OjYwMCxjb2xvcjpDLndhfX0+RXhlY3V0aW9uPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy50eEYsbWFyZ2luVG9wOjF9fT5JbXBsZW1lbnRhdGlvbiBzdGF0dXM8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTIscGFkZGluZzoiOHB4IDEwcHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NX19PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjUsdGV4dEFsaWduOiJjZW50ZXIifX0+VGhlIGdhcCBiZXR3ZWVuIHRoZXNlIHR3byBudW1iZXJzIGlzIHRoZSBvcHBvcnR1bml0eS48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9DZD4KICAgICAgPENkPgogICAgICAgIDxDTD5QbGFubmluZyBVbml0PC9DTD4KICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiY2VudGVyIixnYXA6MjQsbWFyZ2luVG9wOjYsZmxleFdyYXA6IndyYXAifX0+CiAgICAgICAgICA8UEIgbj17ZmFtaWx5LmNsaWVudC5uYW1lfSBhPXtmYW1pbHkuY2xpZW50LmFnZX0gLz4KICAgICAgICAgIHtmYW1pbHkuc3BvdXNlICYmICg8PjxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTQsY29sb3I6Qy50eEYsZm9udEZhbWlseToic2Fucy1zZXJpZiJ9fT4rPC9zcGFuPjxQQiBuPXtmYW1pbHkuc3BvdXNlLm5hbWV9IGE9e2ZhbWlseS5zcG91c2UuYWdlfSAvPjwvPil9CiAgICAgICAgICB7ZmFtaWx5LmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luTGVmdDo0LGJvcmRlckxlZnQ6IjFweCBzb2xpZCAiK0MuYkwscGFkZGluZ0xlZnQ6MTh9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAsY29sb3I6Qy50eEwsbWFyZ2luQm90dG9tOjQsZm9udEZhbWlseToic2Fucy1zZXJpZiIsdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixsZXR0ZXJTcGFjaW5nOjAuOH19PkNoaWxkcmVuPC9kaXY+CiAgICAgICAgICAgICAge2ZhbWlseS5jaGlsZHJlbi5tYXAoKGMsaSk9Pig8ZGl2IGtleT17aX0gc3R5bGU9e3tmb250U2l6ZToxMi41LG1hcmdpbkJvdHRvbToyLGNvbG9yOkMudHhNfX0+CiAgICAgICAgICAgICAgICB7Yy5uYW1lfXtjLnNwb3VzZSYmPHNwYW4gc3R5bGU9e3tjb2xvcjpDLnR4Rn19PnsiIGFuZCAiK2Muc3BvdXNlfTwvc3Bhbj59CiAgICAgICAgICAgICAgICB7Yy5nYyYmYy5nYy5sZW5ndGg+MCYmPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMuZGEsbWFyZ2luTGVmdDo1fX0+KHtjLmdjLmpvaW4oIiwgIil9KTwvc3Bhbj59CiAgICAgICAgICAgICAgPC9kaXY+KSl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKX0KICAgICAgICA8L2Rpdj4KICAgICAgPC9DZD4KICAgIDwvZGl2PgoKICAgIHsvKiBGb3VuZGF0aW9uIC8gRXhlY3V0aW9uICovfQogICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImdyaWQiLGdyaWRUZW1wbGF0ZUNvbHVtbnM6IjFmciAxZnIiLGdhcDoxNixtYXJnaW5Cb3R0b206MTZ9fT4KICAgICAgPENkIHN0eWxlPXt7Ym9yZGVyVG9wOiIzcHggc29saWQgIitDLmFjfX0+CiAgICAgICAgPENMPldoYXQncyBpbiBQbGFjZTwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4fX0+CiAgICAgICAgICB7Zm91bmRhdGlvbkl0ZW1zLm1hcCgoaXRlbSxpKT0+KAogICAgICAgICAgICA8ZGl2IGtleT17aX0gc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6OCxwYWRkaW5nOiI1cHggMCIsYm9yZGVyQm90dG9tOmk8Zm91bmRhdGlvbkl0ZW1zLmxlbmd0aC0xPyIxcHggc29saWQgIitDLmJMOiJub25lIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tjb2xvcjpDLmFjLGZvbnRTaXplOjExLG1hcmdpblRvcDoxLGZsZXhTaHJpbms6MH19PiYjMTAwMDM7PC9kaXY+CiAgICAgICAgICAgICAgPGRpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eE0sZm9udFdlaWdodDo1MDB9fT57aXRlbS50fTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGLG1hcmdpblRvcDoxfX0+e2l0ZW0ubn08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApKX0KICAgICAgICAgIHtmb3VuZGF0aW9uSXRlbXMubGVuZ3RoPT09MCYmPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMudHhMLGZvbnRTdHlsZToiaXRhbGljIn19Pk5vIGZvdW5kYXRpb24gaXRlbXMgcmVjb3JkZWQgeWV0LjwvZGl2Pn0KICAgICAgICA8L2Rpdj4KICAgICAgPC9DZD4KICAgICAgPENkIHN0eWxlPXt7Ym9yZGVyVG9wOiIzcHggc29saWQgIitDLndhfX0+CiAgICAgICAgPENMPldoYXQgTmVlZHMgV29yazwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4fX0+CiAgICAgICAgICB7ZXhlY3V0aW9uSXRlbXMubWFwKChpdGVtLGkpPT4oCiAgICAgICAgICAgIDxkaXYga2V5PXtpfSBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDo4LHBhZGRpbmc6IjVweCAwIixib3JkZXJCb3R0b206aTxleGVjdXRpb25JdGVtcy5sZW5ndGgtMT8iMXB4IHNvbGlkICIrQy5iTDoibm9uZSJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Y29sb3I6Qy53YSxmb250U2l6ZToxMSxtYXJnaW5Ub3A6MSxmbGV4U2hyaW5rOjB9fT4mIzk2Nzk7PC9kaXY+CiAgICAgICAgICAgICAgPGRpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eE0sZm9udFdlaWdodDo1MDB9fT57aXRlbS50fTwvZGl2PjxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGLG1hcmdpblRvcDoxfX0+e2l0ZW0ubn08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApKX0KICAgICAgICAgIHtleGVjdXRpb25JdGVtcy5sZW5ndGg9PT0wJiY8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMifX0+Tm8gZXhlY3V0aW9uIGl0ZW1zIHJlY29yZGVkIHlldC48L2Rpdj59CiAgICAgICAgPC9kaXY+CiAgICAgIDwvQ2Q+CiAgICA8L2Rpdj4KCiAgICB7LyogRXN0YXRlIGJhciAqL30KICAgIDxDZCBzdHlsZT17e21hcmdpbkJvdHRvbToxNn19PgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6InNwYWNlLWJldHdlZW4iLGFsaWduSXRlbXM6ImJhc2VsaW5lIn19PgogICAgICAgIDxkaXY+PENMPlRvdGFsIEVzdGF0ZTwvQ0w+PGRpdiBzdHlsZT17e2ZvbnRTaXplOjI4LGZvbnRXZWlnaHQ6MzAwLGxldHRlclNwYWNpbmc6LTEsbWFyZ2luVG9wOjJ9fT57Zm10KHRvdGFsRXN0YXRlKX08L2Rpdj48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsY29sb3I6Qy50eEx9fT57ZG9taWNpbGVTdGF0ZSsiIHwgIityZXBvcnREYXRlfTwvZGl2PjwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6MTJ9fT4KICAgICAgICAgIDxNUyBsPSJJbiBUcnVzdCIgIHY9e2ZtdChpblRydXN0VmFsKX0gICAgICBjPXtDLmFjfSAvPgogICAgICAgICAgPE1TIGw9IlJlLVRpdGxlIiAgdj17Zm10KG5lZWRzUmV0aXRsZVZhbCl9ICBjPXtDLndhfSAvPgogICAgICAgICAgPE1TIGw9IkJlbmVmLiIgICAgdj17Zm10KGJlbmVmRGVzaWdWYWwpfSAgICBjPXtDLmJsfSAvPgogICAgICAgICAgPE1TIGw9IkN1c3RvZGlhbCIgdj17Zm10KGN1c3RvZGlhbFZhbCl9ICAgICBjPXtDLnB1fSAvPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAge3RvdGFsRXN0YXRlID4gMCAmJiAoPGRpdiBzdHlsZT17e21hcmdpblRvcDoxMCxoZWlnaHQ6Nyxib3JkZXJSYWRpdXM6NCxiYWNrZ3JvdW5kOkMuYkwsb3ZlcmZsb3c6ImhpZGRlbiIsZGlzcGxheToiZmxleCJ9fT4KICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6KGluVHJ1c3RWYWwvdG90YWxFc3RhdGUqMTAwKSsiJSIsYmFja2dyb3VuZDpDLmFjfX0gLz4KICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6KG5lZWRzUmV0aXRsZVZhbC90b3RhbEVzdGF0ZSoxMDApKyIlIixiYWNrZ3JvdW5kOkMud2F9fSAvPgogICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDooYmVuZWZEZXNpZ1ZhbC90b3RhbEVzdGF0ZSoxMDApKyIlIixiYWNrZ3JvdW5kOkMuYmx9fSAvPgogICAgICAgIDxkaXYgc3R5bGU9e3tmbGV4OjEsYmFja2dyb3VuZDpDLnB1KyI1NSJ9fSAvPgogICAgICA8L2Rpdj4pfQogICAgPC9DZD4KCiAgICB7LyogUHJpb3JpdGl6ZWQgQWN0aW9ucyAqL30KICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Cb3R0b206OH19PjxDTD5Qcmlvcml0aXplZCBBY3Rpb25zPC9DTD48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TCxtYXJnaW5Ub3A6Mn19Pk9yZ2FuaXplZCBieSB1cmdlbmN5LjwvZGl2PjwvZGl2PgogICAgeyhBcnJheS5pc0FycmF5KHByaW9yaXRpZXMpID8gcHJpb3JpdGllcyA6IE9iamVjdC52YWx1ZXMocHJpb3JpdGllcykpLm1hcCgodGllcix0aSk9PigKICAgICAgPGRpdiBrZXk9e3RpfSBzdHlsZT17e21hcmdpbkJvdHRvbToxMn19PgogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo4LG1hcmdpbkJvdHRvbTo2fX0+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7cGFkZGluZzoiMnB4IDhweCIsYmFja2dyb3VuZDp0aWVyLnRpZXJCZyxib3JkZXI6IjFweCBzb2xpZCAiK3RpZXIudGllckNvbG9yKyIyMiIsYm9yZGVyUmFkaXVzOjN9fT4KICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMCxmb250V2VpZ2h0OjcwMCxjb2xvcjp0aWVyLnRpZXJDb2xvcixmb250RmFtaWx5OiJzYW5zLXNlcmlmIixsZXR0ZXJTcGFjaW5nOjAuNX19Pnt0aWVyLmxhYmVsfTwvc3Bhbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGfX0+e3RpZXIuZGVzY308L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPENkIHN0eWxlPXt7cGFkZGluZzoiMTJweCAxNnB4In19PgogICAgICAgICAge3RpZXIuaXRlbXMubWFwKChpdGVtLGlpKT0+ewogICAgICAgICAgICBjb25zdCBpc0V4cCA9IGV4cFByaSA9PT0gdGkrIi0iK2lpOwogICAgICAgICAgICByZXR1cm4gKDxkaXYga2V5PXtpaX0gb25DbGljaz17KCk9PnNldEV4cFByaShpc0V4cD9udWxsOnRpKyItIitpaSl9IHN0eWxlPXt7cGFkZGluZzoiOHB4IDAiLGJvcmRlckJvdHRvbTppaTx0aWVyLml0ZW1zLmxlbmd0aC0xPyIxcHggc29saWQgIitDLmJMOiJub25lIixjdXJzb3I6InBvaW50ZXIifX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGp1c3RpZnlDb250ZW50OiJzcGFjZS1iZXR3ZWVuIixhbGlnbkl0ZW1zOiJjZW50ZXIifX0+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiY2VudGVyIixnYXA6OH19PgogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6NyxoZWlnaHQ6Nyxib3JkZXJSYWRpdXM6IjUwJSIsYmFja2dyb3VuZDp0aWVyLnRpZXJDb2xvcixmbGV4U2hyaW5rOjB9fSAvPgogICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEzLGNvbG9yOkMudHgsZm9udFdlaWdodDo1MDB9fT57aXRlbS50aXRsZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgIHtpdGVtLnZhbHVlJiY8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjExLGNvbG9yOnRpZXIudGllckNvbG9yLGZvbnRXZWlnaHQ6NTAwfX0+e2ZtdEYoaXRlbS52YWx1ZSl9PC9zcGFuPn0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMCxjb2xvcjpDLnR4Rixmb250RmFtaWx5OiJzYW5zLXNlcmlmIn19PntpdGVtLmVzdH08L3NwYW4+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAge2lzRXhwJiYoPGRpdiBzdHlsZT17e21hcmdpblRvcDo2LG1hcmdpbkxlZnQ6MTUscGFkZGluZzoiOHB4IDEycHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NSxib3JkZXJMZWZ0OiIycHggc29saWQgIit0aWVyLnRpZXJDb2xvcisiNDQifX0+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNn19PntpdGVtLndoeX08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGLG1hcmdpblRvcDo0fX0+eyJFZmZvcnQ6ICIraXRlbS5lZmZvcnR9PC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+KX0KICAgICAgICAgICAgPC9kaXY+KTsKICAgICAgICAgIH0pfQogICAgICAgICAge3RpZXIuaXRlbXMubGVuZ3RoPT09MCYmPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMudHhMLGZvbnRTdHlsZToiaXRhbGljIixwYWRkaW5nOiI0cHggMCJ9fT5ObyBpdGVtcyBpbiB0aGlzIHRpZXIuPC9kaXY+fQogICAgICAgIDwvQ2Q+CiAgICAgIDwvZGl2PgogICAgKSl9CgogICAgey8qIEhpZ2dpbnMgbm90ZSAqL30KICAgIDxDZCBzdHlsZT17e21hcmdpblRvcDo4LGJvcmRlckxlZnQ6IjNweCBzb2xpZCAiK0MuYkwsYmFja2dyb3VuZDpDLmJnfX0+CiAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMyxmb250U3R5bGU6Iml0YWxpYyIsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjd9fT57JyInK2hpZ2dpbnNOb3RlKyciJ308L2Rpdj4KICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEwsbWFyZ2luVG9wOjZ9fT4tLSBKb25hdGhhbiBRdWF5bGUgSGlnZ2lucyBJSUk8L2Rpdj4KICAgIDwvQ2Q+CiAgPC9kaXY+KTsKfQoKCi8qID09PT09PT09PT09IFYyOiBBU1NFVCBNQVAgPT09PT09PT09PT0gKi8KZnVuY3Rpb24gVjIoKSB7CiAgY29uc3QgW3NlbCwgc2V0U2VsXSA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IFtmbHQsIHNldEZsdF0gPSB1c2VTdGF0ZSgiYWxsIik7CiAgY29uc3QgY2F0S2V5cyA9IFsiYWxsIiwiaW4tdHJ1c3QiLCJyZXRpdGxlIiwiYmVuZWZpY2lhcnkiLCJjdXN0b2RpYWwiXTsKICBjb25zdCBmbCA9IGZsdCA9PT0gImFsbCIgPyBhc3NldHMgOiBhc3NldHMuZmlsdGVyKGEgPT4gYS5jYXRlZ29yeSA9PT0gZmx0KTsKICBjb25zdCBteCA9IE1hdGgubWF4KC4uLmFzc2V0cy5tYXAoYSA9PiBhLnZhbHVlKSk7CiAgcmV0dXJuICg8ZGl2PgogICAgPFZUIHQ9IkFzc2V0IE1hcCIgcz0iQXNzZXRzIG9yZ2FuaXplZCBieSBob3cgdGhleSBjb25uZWN0IHRvIHRoZSB0cnVzdC4gR3JlZW4gPSBkb25lLiBBbWJlciA9IGFjdGlvbiBuZWVkZWQuIEJsdWUgPSBiZW5lZmljaWFyeSBmb3JtLiBQdXJwbGUgPSBjdXN0b2RpYWwuIiAvPgogICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDo4LG1hcmdpbkJvdHRvbToxOCxmbGV4V3JhcDoid3JhcCJ9fT4KICAgICAge2NhdEtleXMubWFwKGsgPT4gewogICAgICAgIGNvbnN0IGlzQSA9IGZsdCA9PT0gazsKICAgICAgICBjb25zdCBnID0gayA9PT0gImFsbCIgPyBhc3NldHMgOiBhc3NldHMuZmlsdGVyKGEgPT4gYS5jYXRlZ29yeSA9PT0gayk7CiAgICAgICAgY29uc3QgZ3YgPSBnLnJlZHVjZSgocywgYSkgPT4gcyArIGEudmFsdWUsIDApOwogICAgICAgIGNvbnN0IG0gPSBrID09PSAiYWxsIiA/IHtsYWJlbDoiQWxsIEFzc2V0cyIsY29sb3I6Qy50eH0gOiBjYXRNZXRhW2tdOwogICAgICAgIHJldHVybiAoPGJ1dHRvbiBrZXk9e2t9IG9uQ2xpY2s9eygpID0+IHtzZXRGbHQoayk7c2V0U2VsKG51bGwpO319IHN0eWxlPXt7ZmxleDoxLG1pbldpZHRoOjEzMCxwYWRkaW5nOiIxMHB4IDE0cHgiLGJhY2tncm91bmQ6aXNBPyIjZmZmIjpDLmJnKyJkZCIsYm9yZGVyOiIxcHggc29saWQgIisoaXNBP0MuYm9yZGVyOiJ0cmFuc3BhcmVudCIpLGJvcmRlclJhZGl1czo2LGN1cnNvcjoicG9pbnRlciIsdGV4dEFsaWduOiJsZWZ0Iixib3hTaGFkb3c6aXNBPyIwIDFweCAzcHggcmdiYSgwLDAsMCwuMDUpIjoibm9uZSIsdHJhbnNpdGlvbjoiYWxsIC4ycyJ9fT4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo1fX0+CiAgICAgICAgICAgIHtrIT09ImFsbCImJjxkaXYgc3R5bGU9e3t3aWR0aDo4LGhlaWdodDo4LGJvcmRlclJhZGl1czoyLGJhY2tncm91bmQ6bS5jb2xvcn19IC8+fQogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTAsY29sb3I6Qy50eEwsZm9udEZhbWlseToic2Fucy1zZXJpZiIsdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixsZXR0ZXJTcGFjaW5nOjAuNn19PnttLmxhYmVsfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MjAsZm9udFdlaWdodDozMDAsbWFyZ2luVG9wOjF9fT57Zm10KGd2KX08L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMCxjb2xvcjpDLnR4Rn19PntnLmxlbmd0aCsiIGFzc2V0IisoZy5sZW5ndGghPT0xPyJzIjoiIil9PC9kaXY+CiAgICAgICAgPC9idXR0b24+KTsKICAgICAgfSl9CiAgICA8L2Rpdj4KICAgIDxDZD4KICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImdyaWQiLGdyaWRUZW1wbGF0ZUNvbHVtbnM6InJlcGVhdChhdXRvLWZpbGwsbWlubWF4KDIyMHB4LDFmcikpIixnYXA6OX19PgogICAgICAgIHtmbC5tYXAoYSA9PiB7CiAgICAgICAgICBjb25zdCBpc1NlbCA9IHNlbCA9PT0gYS5pZDsKICAgICAgICAgIGNvbnN0IGNtID0gY2F0TWV0YVthLmNhdGVnb3J5XTsKICAgICAgICAgIHJldHVybiAoPGRpdiBrZXk9e2EuaWR9IG9uQ2xpY2s9eygpID0+IHNldFNlbChpc1NlbCA/IG51bGwgOiBhLmlkKX0gc3R5bGU9e3twYWRkaW5nOiIxMnB4IDE0cHgiLGJvcmRlclJhZGl1czo2LGJvcmRlcjoiMXB4IHNvbGlkICIrKGlzU2VsP2NtLmNvbG9yKyI1NSI6Qy5iTCksYmFja2dyb3VuZDppc1NlbD9jbS5jb2xvcisiMDgiOiIjZmRmYmY2IixjdXJzb3I6InBvaW50ZXIiLHRyYW5zaXRpb246ImFsbCAuMnMiLHBvc2l0aW9uOiJyZWxhdGl2ZSIsb3ZlcmZsb3c6ImhpZGRlbiJ9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsYm90dG9tOjAsbGVmdDowLGhlaWdodDoyLjUsd2lkdGg6KGEudmFsdWUvbXgqMTAwKSsiJSIsYmFja2dyb3VuZDpjbS5jb2xvcisiMTgifX0gLz4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGp1c3RpZnlDb250ZW50OiJzcGFjZS1iZXR3ZWVuIixhbGlnbkl0ZW1zOiJmbGV4LXN0YXJ0In19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMi41LGZvbnRXZWlnaHQ6NTAwLGNvbG9yOkMudHgsbGluZUhlaWdodDoxLjMsZmxleDoxfX0+e2EubmFtZX08L2Rpdj4KICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjcscGFkZGluZzoiMnB4IDVweCIsYmFja2dyb3VuZDpjbS5iZyxjb2xvcjpjbS5jb2xvcixib3JkZXJSYWRpdXM6Myxmb250V2VpZ2h0OjYwMCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixsZXR0ZXJTcGFjaW5nOjAuNSxmbGV4U2hyaW5rOjAsbWFyZ2luTGVmdDo0LHdoaXRlU3BhY2U6Im5vd3JhcCJ9fT57Y20uc2hvcnR9PC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjE5LGZvbnRXZWlnaHQ6MzAwLG1hcmdpblRvcDozfX0+e2ZtdChhLnZhbHVlKX08L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Qy50eEwsbWFyZ2luVG9wOjF9fT57YS50eXBlfXthLmxpcXVpZD8iIHwgTGlxdWlkIjoiIn08L2Rpdj4KICAgICAgICAgICAge2EuY2F0ZWdvcnk9PT0iYmVuZWZpY2lhcnkiJiZhLmJlblN0YXR1cz09PSJ1cGRhdGUiJiY8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjQsZm9udFNpemU6MTAsY29sb3I6Qy5ibCxmb250V2VpZ2h0OjUwMH19PkJlbmVmaWNpYXJ5IGRlc2lnbmF0aW9uIG5lZWRzIHVwZGF0ZTwvZGl2Pn0KICAgICAgICAgICAge2EuY2F0ZWdvcnk9PT0icmV0aXRsZSImJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6NCxmb250U2l6ZToxMCxjb2xvcjpDLndhLGZvbnRXZWlnaHQ6NTAwfX0+QWN0aW9uOiByZS10aXRsZSB0byB0cnVzdDwvZGl2Pn0KICAgICAgICAgICAge2lzU2VsJiYoPGRpdiBzdHlsZT17e21hcmdpblRvcDoxMCxwYWRkaW5nVG9wOjgsYm9yZGVyVG9wOiIxcHggc29saWQgIitDLmJMLGFuaW1hdGlvbjoidmYgLjE1cyBlYXNlIn19PgogICAgICAgICAgICAgIDxEUiBsPSJWYWx1ZSIgdj17Zm10RihhLnZhbHVlKX0gLz4KICAgICAgICAgICAgICB7YS5tb3J0Z2FnZSYmPERSIGw9Ik1vcnRnYWdlIiB2PXtmbXRGKGEubW9ydGdhZ2UpfSB2Yz17Qy5kYX0gLz59CiAgICAgICAgICAgICAge2EubW9ydGdhZ2UmJjxEUiBsPSJOZXQgRXF1aXR5IiB2PXtmbXRGKGEudmFsdWUtYS5tb3J0Z2FnZSl9IC8+fQogICAgICAgICAgICAgIHthLmJhc2lzIT1udWxsJiY8RFIgbD0iQ29zdCBCYXNpcyIgdj17Zm10RihhLmJhc2lzKX0gLz59CiAgICAgICAgICAgICAge2EuYmFzaXMhPW51bGwmJjxEUiBsPSJCdWlsdC1JbiBHYWluIiB2PXtmbXRGKGEudmFsdWUtYS5iYXNpcyl9IHZjPXtDLmJsfSAvPn0KICAgICAgICAgICAgICB7YS5iZW5lZmljaWFyeSYmPERSIGw9IkN1cnJlbnQgQmVuZWZpY2lhcnkiIHY9e2EuYmVuZWZpY2lhcnl9IC8+fQogICAgICAgICAgICAgIHthLmJlblN0YXR1cz09PSJ1cGRhdGUiJiY8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjQscGFkZGluZzoiNXB4IDlweCIsYmFja2dyb3VuZDpDLmJsTCxib3JkZXJSYWRpdXM6NCxmb250U2l6ZToxMC41LGNvbG9yOkMuYmwsbGluZUhlaWdodDoxLjQsZm9udFdlaWdodDo1MDB9fT57IkFjdGlvbjogIithLmFjdGlvbn08L2Rpdj59CiAgICAgICAgICAgICAge2EuY2F0ZWdvcnk9PT0icmV0aXRsZSImJmEuYWN0aW9uJiY8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjQscGFkZGluZzoiNXB4IDlweCIsYmFja2dyb3VuZDpDLndhTCxib3JkZXJSYWRpdXM6NCxmb250U2l6ZToxMC41LGNvbG9yOkMud2EsbGluZUhlaWdodDoxLjQsZm9udFdlaWdodDo1MDB9fT57IkFjdGlvbjogIithLmFjdGlvbn08L2Rpdj59CiAgICAgICAgICAgICAge2Eubm90ZSYmPGRpdiBzdHlsZT17e21hcmdpblRvcDo0LHBhZGRpbmc6IjVweCA5cHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NCxmb250U2l6ZToxMC41LGNvbG9yOkMudHhMLGxpbmVIZWlnaHQ6MS40fX0+e2Eubm90ZX08L2Rpdj59CiAgICAgICAgICAgIDwvZGl2Pil9CiAgICAgICAgICA8L2Rpdj4pOwogICAgICAgIH0pfQogICAgICA8L2Rpdj4KICAgIDwvQ2Q+CiAgPC9kaXY+KTsKfQoKLyogPT09PT09PT09PT0gVjM6IFdBVEVSRkFMTCA9PT09PT09PT09PSAqLwpmdW5jdGlvbiBWMygpIHsKICBjb25zdCBbbW9kZSwgc2V0TW9kZV0gPSB1c2VTdGF0ZSgiZmlyc3QiKTsKICBjb25zdCBbZW4sIHNldEVuXSAgICAgPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCB7CiAgICBpc01hcnJpZWQsIGhhc1N0YXRlVGF4LCBzdGF0ZVRheE5vdGUsCiAgICBmaXJzdERlYXRoRmxvdywgcG9ydGFiaWxpdHlOb3RlLCBmdW5kaW5nR2FwTm90ZSwKICAgIHNlY29uZERlYXRoRGlzdHJpYnV0aW9uLCBzdWJ0cnVzdHNOb3RlLCBhZG1pbkNvc3RzLAogICAgYmVuZWZpY2lhcnlDb2x1bW5zLAogIH0gPSB3YXRlcmZhbGxDb25maWc7CgogIGNvbnN0IG5ldERpc3RyaWJ1dGFibGUgPSB0b3RhbEVzdGF0ZSAtIG1vcnRnYWdlIC0gYWRtaW5Db3N0czsKCiAgLyogQ29tcHV0ZSBlYWNoIGNvbHVtbidzIGRpc3BsYXkgdmFsdWUuCiAgICAgUHJpb3JpdHkgb3JkZXI6CiAgICAgICAxLiBmaXhlZEFtb3VudCAgLSBleHBsaWNpdCBkb2xsYXIgYW1vdW50IChzcGVjaWZpYyBnaWZ0cywgY2hhcml0eSkKICAgICAgIDIuIHBlcmNlbnRhZ2UgICAtIGZyYWN0aW9uIG9mIG5ldERpc3RyaWJ1dGFibGUgKGUuZy4gMC41IGZvciA1MCUpCiAgICAgICAzLiByZXNpZHVlICAgICAgLSBubyBmaXhlZEFtb3VudCBvciBwZXJjZW50YWdlOiBzcGxpdHMgd2hhdCdzIGxlZnQgZXF1YWxseQoKICAgICBGaXhlZCB0cmFuY2hlcyBhcmUgZGVkdWN0ZWQgZmlyc3QsIHRoZW4gcGVyY2VudGFnZSBjb2xzLCB0aGVuIHJlc2lkdWUgY29scwogICAgIHNwbGl0IHdoYXRldmVyIHJlbWFpbnMuCiAgKi8KICBjb25zdCBmaXhlZFRvdGFsID0gYmVuZWZpY2lhcnlDb2x1bW5zCiAgICAuZmlsdGVyKGMgPT4gYy5maXhlZEFtb3VudCkKICAgIC5yZWR1Y2UoKHMsIGMpID0+IHMgKyBjLmZpeGVkQW1vdW50LCAwKTsKCiAgY29uc3QgYWZ0ZXJGaXhlZCA9IE1hdGgubWF4KDAsIG5ldERpc3RyaWJ1dGFibGUgLSBmaXhlZFRvdGFsKTsKCiAgY29uc3QgcGN0VG90YWwgPSBiZW5lZmljaWFyeUNvbHVtbnMKICAgIC5maWx0ZXIoYyA9PiAhYy5maXhlZEFtb3VudCAmJiBjLnBlcmNlbnRhZ2UpCiAgICAucmVkdWNlKChzLCBjKSA9PiBzICsgYy5wZXJjZW50YWdlLCAwKTsKICBjb25zdCBwY3REb2xsYXJUb3RhbCA9IE1hdGgucm91bmQoYWZ0ZXJGaXhlZCAqIE1hdGgubWluKHBjdFRvdGFsLCAxKSk7CgogIGNvbnN0IHJlc2lkdWVDb2xzID0gYmVuZWZpY2lhcnlDb2x1bW5zLmZpbHRlcihjID0+ICFjLmZpeGVkQW1vdW50ICYmICFjLnBlcmNlbnRhZ2UpOwogIGNvbnN0IHJlc2lkdWVQb29sID0gTWF0aC5tYXgoMCwgYWZ0ZXJGaXhlZCAtIHBjdERvbGxhclRvdGFsKTsKICBjb25zdCBwZXJSZXNpZHVlICA9IHJlc2lkdWVDb2xzLmxlbmd0aCA+IDAKICAgID8gTWF0aC5yb3VuZChyZXNpZHVlUG9vbCAvIHJlc2lkdWVDb2xzLmxlbmd0aCkgOiAwOwoKICBmdW5jdGlvbiBjb2xWYWx1ZShjb2wpIHsKICAgIGlmIChjb2wuZml4ZWRBbW91bnQpICByZXR1cm4gY29sLmZpeGVkQW1vdW50OwogICAgaWYgKGNvbC5wZXJjZW50YWdlKSAgIHJldHVybiBNYXRoLnJvdW5kKGFmdGVyRml4ZWQgKiBjb2wucGVyY2VudGFnZSk7CiAgICByZXR1cm4gcGVyUmVzaWR1ZTsKICB9CiAgZnVuY3Rpb24gY29sQ29sb3IoY29sKSB7CiAgICBpZiAoY29sLmZpeGVkQW1vdW50KSByZXR1cm4gQy53YTsKICAgIHJldHVybiBDLmFjOwogIH0KICBmdW5jdGlvbiBjb2xFbktleShjb2wsIGkpIHsKICAgIGlmIChjb2wuZml4ZWRBbW91bnQpIHJldHVybiAiZiIraTsKICAgIHJldHVybiAiYyIraTsKICB9CgogIC8qIEZpcnN0LWRlYXRoIG91dGNvbWUgKi8KICBjb25zdCBmaXJzdERlYXRoT3V0Y29tZSA9IGZpcnN0RGVhdGhGbG93ID09PSAidG9fc3BvdXNlIgogICAgPyB7IGxhYmVsOiAiVG8gU3Vydml2aW5nIFNwb3VzZSIsIHZhbHVlOiB0b3RhbEVzdGF0ZSwgY29sb3I6IEMuYWMsCiAgICAgICAgZGV0YWlsOiAiRXZlcnl0aGluZyBwYXNzZXMgdG8gc3Vydml2aW5nIHNwb3VzZS4gIiArCiAgICAgICAgICAgICAgICAoaW5UcnVzdFZhbCA+IDAgPyAiVHJ1c3QgYXNzZXRzIHRyYW5zZmVyIHNlYW1sZXNzbHkgdmlhIHN1Y2Nlc3NvciB0cnVzdGVlLiAiIDogIlRydXN0IGFzc2V0cyAob25jZSBmdW5kZWQpIHRyYW5zZmVyIHNlYW1sZXNzbHkuICIpICsKICAgICAgICAgICAgICAgICJSZXRpcmVtZW50IGFuZCBpbnN1cmFuY2UgcGFzcyBieSBiZW5lZmljaWFyeSBkZXNpZ25hdGlvbi4gIiArCiAgICAgICAgICAgICAgICAocG9ydGFiaWxpdHlOb3RlIHx8ICIiKSB9CiAgICA6IGZpcnN0RGVhdGhGbG93ID09PSAidG9fdHJ1c3QiCiAgICA/IHsgbGFiZWw6ICJUbyBDcmVkaXQgU2hlbHRlciBUcnVzdCIsIHZhbHVlOiBNYXRoLm1pbih0b3RhbEVzdGF0ZSwgMTM2MDAwMDApLCBjb2xvcjogQy5ibCwKICAgICAgICBkZXRhaWw6ICJBc3NldHMgdXAgdG8gdGhlIGV4ZW1wdGlvbiBmdW5kIGEgYnlwYXNzIC8gY3JlZGl0IHNoZWx0ZXIgdHJ1c3QuIFJlbWFpbmluZyBhc3NldHMgcGFzcyB0byBzcG91c2UgdmlhIG1hcml0YWwgc2hhcmUuICIgKyAocG9ydGFiaWxpdHlOb3RlIHx8ICIiKSB9CiAgICA6IHsgbGFiZWw6ICJUbyBCZW5lZmljaWFyaWVzIiwgdmFsdWU6IG5ldERpc3RyaWJ1dGFibGUsIGNvbG9yOiBDLmFjLAogICAgICAgIGRldGFpbDogIk5vIHN1cnZpdmluZyBzcG91c2UuIEFzc2V0cyBwYXNzIHBlciB0cnVzdCB0ZXJtcyB0byBuYW1lZCBiZW5lZmljaWFyaWVzLiIgfTsKCiAgcmV0dXJuICgKICAgIDxkaXY+CiAgICAgIDxWVCB0PSJXYXRlcmZhbGwiIHM9IkhvdyBhc3NldHMgZmxvdyBhdCBkZWF0aC4gU2hvd3MgZmlyc3QgYW5kIHNlY29uZCBkZWF0aCBzY2VuYXJpb3MgYmFzZWQgb24geW91ciBwbGFuLiIgLz4KCiAgICAgIHsvKiBNb2RlIHRvZ2dsZSAqL30KICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDowLG1hcmdpbkJvdHRvbToyMCxiYWNrZ3JvdW5kOkMuYkwsYm9yZGVyUmFkaXVzOjYscGFkZGluZzozLHdpZHRoOiJmaXQtY29udGVudCJ9fT4KICAgICAgICB7W1siZmlyc3QiLCJGaXJzdCBEZWF0aCJdLFsic2Vjb25kIiwiU2Vjb25kIERlYXRoIl1dLm1hcCgoW2ssbGFiXSk9PigKICAgICAgICAgIDxidXR0b24ga2V5PXtrfSBvbkNsaWNrPXsoKT0+e3NldE1vZGUoayk7c2V0RW4obnVsbCk7fX0KICAgICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiI3cHggMThweCIsYm9yZGVyUmFkaXVzOjQsYm9yZGVyOiJub25lIixjdXJzb3I6InBvaW50ZXIiLAogICAgICAgICAgICAgIGJhY2tncm91bmQ6bW9kZT09PWs/IiNmZmYiOiJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgICAgY29sb3I6bW9kZT09PWs/Qy50eDpDLnR4TCxmb250U2l6ZToxMi41LAogICAgICAgICAgICAgIGZvbnRXZWlnaHQ6bW9kZT09PWs/NjAwOjQwMCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIiwKICAgICAgICAgICAgICBib3hTaGFkb3c6bW9kZT09PWs/IjAgMXB4IDNweCByZ2JhKDAsMCwwLC4wNikiOiJub25lIix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PgogICAgICAgICAgICB7bGFifQogICAgICAgICAgPC9idXR0b24+CiAgICAgICAgKSl9CiAgICAgIDwvZGl2PgoKICAgICAgey8qID09IEZJUlNUIERFQVRIID09ICovfQogICAgICB7bW9kZT09PSJmaXJzdCIgJiYgKAogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZmxleERpcmVjdGlvbjoiY29sdW1uIixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDowLHBhZGRpbmc6IjI4cHggMzZweCIsYmFja2dyb3VuZDoiI2ZmZiIsYm9yZGVyUmFkaXVzOjcsYm9yZGVyOiIxcHggc29saWQgIitDLmJMLGJveFNoYWRvdzoiMCAxcHggMnB4IHJnYmEoMCwwLDAsLjAzKSJ9fT4KICAgICAgICAgICAgey8qIEVzdGF0ZSBib3ggKi99CiAgICAgICAgICAgIDxkaXYgb25DbGljaz17KCk9PnNldEVuKGVuPT09ImcxIj9udWxsOiJnMSIpfQogICAgICAgICAgICAgIHN0eWxlPXt7cGFkZGluZzoiMTRweCAyMHB4Iixib3JkZXJSYWRpdXM6Nyxib3JkZXI6IjEuNXB4IHNvbGlkICIrQy5ibCsiNDQiLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZDplbj09PSJnMSI/Qy5ibCsiMDgiOiIjZmZmIix0ZXh0QWxpZ246ImNlbnRlciIsbWluV2lkdGg6MjAwLGN1cnNvcjoicG9pbnRlciIsdHJhbnNpdGlvbjoiYWxsIC4ycyJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsY29sb3I6Qy50eEwsZm9udEZhbWlseToic2Fucy1zZXJpZiIsbWFyZ2luQm90dG9tOjF9fT5Db21iaW5lZCBFc3RhdGU8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MjEsZm9udFdlaWdodDozMDAsY29sb3I6Qy5ibH19PntmbXQodG90YWxFc3RhdGUpfTwvZGl2PgogICAgICAgICAgICAgIHtlbj09PSJnMSIgJiYgKAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4LHBhZGRpbmc6IjhweCAxMHB4IixiYWNrZ3JvdW5kOkMuYmcsYm9yZGVyUmFkaXVzOjUsZm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNSx0ZXh0QWxpZ246ImxlZnQifX0+CiAgICAgICAgICAgICAgICAgIHtpblRydXN0VmFsID4gMAogICAgICAgICAgICAgICAgICAgID8gIlRydXN0IGFzc2V0cyAoIiArIGZtdChpblRydXN0VmFsKSArICIpIHBhc3MgcGVyIHRydXN0IHRlcm1zLiAiCiAgICAgICAgICAgICAgICAgICAgOiAiVHJ1c3QgY3VycmVudGx5IHVuZnVuZGVkIC0gYXNzZXRzIHdvdWxkIGdvIHRocm91Z2ggcHJvYmF0ZSB1bmxlc3MgdHJ1c3QgaXMgZnVuZGVkLiAifQogICAgICAgICAgICAgICAgICB7IkJlbmVmaWNpYXJ5LWRlc2lnbmF0ZWQgYXNzZXRzICgiICsgZm10KGJlbmVmRGVzaWdWYWwpICsgIikgcGFzcyBkaXJlY3RseSBieSBkZXNpZ25hdGlvbi4ifQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICB7LyogQXJyb3cgKi99CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixmbGV4RGlyZWN0aW9uOiJjb2x1bW4iLGFsaWduSXRlbXM6ImNlbnRlciIscGFkZGluZzoiM3B4IDAifX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjEuNSxoZWlnaHQ6MTQsYmFja2dyb3VuZDpDLmFjKyI0NCJ9fSAvPgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy5hYyxwYWRkaW5nOiIycHggN3B4IixiYWNrZ3JvdW5kOkMuYWMrIjA4Iixib3JkZXJSYWRpdXM6MyxtYXJnaW46IjEuNXB4IDAiLGxpbmVIZWlnaHQ6MS4zfX0+CiAgICAgICAgICAgICAgICB7aXNNYXJyaWVkID8gIlVubGltaXRlZCBtYXJpdGFsIGRlZHVjdGlvbiAtICQwIGZlZGVyYWwgdGF4IiA6ICJFc3RhdGUgdGF4IGFuYWx5c2lzIGFwcGxpZXMifQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIHtoYXNTdGF0ZVRheCAmJiBzdGF0ZVRheE5vdGUgJiYgKAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpDLndhLHBhZGRpbmc6IjJweCA3cHgiLGJhY2tncm91bmQ6Qy53YUwsYm9yZGVyUmFkaXVzOjMsbWFyZ2luOiIxLjVweCAwIixsaW5lSGVpZ2h0OjEuM319PgogICAgICAgICAgICAgICAgICB7c3RhdGVUYXhOb3RlfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6MCxoZWlnaHQ6MCxib3JkZXJMZWZ0OiI0LjVweCBzb2xpZCB0cmFuc3BhcmVudCIsYm9yZGVyUmlnaHQ6IjQuNXB4IHNvbGlkIHRyYW5zcGFyZW50Iixib3JkZXJUb3A6IjUuNXB4IHNvbGlkICIrQy5hYysiNjYifX0gLz4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICB7LyogT3V0Y29tZSAqL30KICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+c2V0RW4oZW49PT0iczEiP251bGw6InMxIil9CiAgICAgICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiIxNHB4IDIwcHgiLGJvcmRlclJhZGl1czo3LGJvcmRlcjoiMS41cHggc29saWQgIitmaXJzdERlYXRoT3V0Y29tZS5jb2xvcisiNDQiLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZDplbj09PSJzMSI/Zmlyc3REZWF0aE91dGNvbWUuY29sb3IrIjA4IjoiI2ZmZiIsdGV4dEFsaWduOiJjZW50ZXIiLG1pbldpZHRoOjIwMCxjdXJzb3I6InBvaW50ZXIiLHRyYW5zaXRpb246ImFsbCAuMnMifX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLGNvbG9yOkMudHhMLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLG1hcmdpbkJvdHRvbToxfX0+e2ZpcnN0RGVhdGhPdXRjb21lLmxhYmVsfTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToyMSxmb250V2VpZ2h0OjMwMCxjb2xvcjpmaXJzdERlYXRoT3V0Y29tZS5jb2xvcn19PntmbXQoZmlyc3REZWF0aE91dGNvbWUudmFsdWUpfTwvZGl2PgogICAgICAgICAgICAgIHtlbj09PSJzMSIgJiYgKAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4LHBhZGRpbmc6IjhweCAxMHB4IixiYWNrZ3JvdW5kOkMuYmcsYm9yZGVyUmFkaXVzOjUsZm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNSx0ZXh0QWxpZ246ImxlZnQifX0+CiAgICAgICAgICAgICAgICAgIHtmaXJzdERlYXRoT3V0Y29tZS5kZXRhaWx9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTYscGFkZGluZzoiMTRweCAyMHB4IixiYWNrZ3JvdW5kOkMuYWNMLGJvcmRlclJhZGl1czo3LG1heFdpZHRoOjQ4MCx0ZXh0QWxpZ246ImNlbnRlciJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIuNSxmb250V2VpZ2h0OjYwMCxjb2xvcjpDLmFjfX0+Tm8gZmVkZXJhbCBlc3RhdGUgdGF4IGF0IGZpcnN0IGRlYXRoLjwvZGl2PgogICAgICAgICAgICAgIHtpc01hcnJpZWQgJiYgKAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjExLjUsY29sb3I6Qy5hYysiY2MiLG1hcmdpblRvcDozLGxpbmVIZWlnaHQ6MS41fX0+CiAgICAgICAgICAgICAgICAgIHtpblRydXN0VmFsID4gMAogICAgICAgICAgICAgICAgICAgID8gZm10KGluVHJ1c3RWYWwgKyBuZWVkc1JldGl0bGVWYWwpICsgIiBpbiB0cnVzdCBhc3NldHMgYXZvaWRzIHByb2JhdGUuIgogICAgICAgICAgICAgICAgICAgIDogIk9uY2UgZnVuZGVkLCAiICsgZm10KG5lZWRzUmV0aXRsZVZhbCkgKyAiIHdpbGwgYXZvaWQgcHJvYmF0ZS4gUmUtdGl0bGluZyBpcyB0aGUgaW1tZWRpYXRlIHByaW9yaXR5LiJ9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIHtmdW5kaW5nR2FwTm90ZSAmJiAoCiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTQscGFkZGluZzoiMTJweCAxOHB4IixiYWNrZ3JvdW5kOkMud2FMLGJvcmRlcjoiMXB4IHNvbGlkICIrQy53YSsiMTgiLGJvcmRlclJhZGl1czo2fX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMud2EsbGluZUhlaWdodDoxLjZ9fT48c3Ryb25nPkN1cnJlbnQgZ2FwOiA8L3N0cm9uZz57ZnVuZGluZ0dhcE5vdGV9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKX0KICAgICAgICA8L2Rpdj4KICAgICAgKX0KCiAgICAgIHsvKiA9PSBTRUNPTkQgREVBVEggPT0gKi99CiAgICAgIHttb2RlPT09InNlY29uZCIgJiYgKAogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZmxleERpcmVjdGlvbjoiY29sdW1uIixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDowLHBhZGRpbmc6IjI4cHggMzZweCIsYmFja2dyb3VuZDoiI2ZmZiIsYm9yZGVyUmFkaXVzOjcsYm9yZGVyOiIxcHggc29saWQgIitDLmJMLGJveFNoYWRvdzoiMCAxcHggMnB4IHJnYmEoMCwwLDAsLjAzKSJ9fT4KCiAgICAgICAgICAgIHsvKiBTdXJ2aXZvcidzIGVzdGF0ZSAqL30KICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+c2V0RW4oZW49PT0iZzIiP251bGw6ImcyIil9CiAgICAgICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiIxNHB4IDIwcHgiLGJvcmRlclJhZGl1czo3LGJvcmRlcjoiMS41cHggc29saWQgIitDLmJsKyI0NCIsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmVuPT09ImcyIj9DLmJsKyIwOCI6IiNmZmYiLHRleHRBbGlnbjoiY2VudGVyIixtaW5XaWR0aDoyMDAsY3Vyc29yOiJwb2ludGVyIix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMSxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206MX19PgogICAgICAgICAgICAgICAge2lzTWFycmllZCA/ICJTdXJ2aXZvcidzIEVzdGF0ZSIgOiAiRXN0YXRlIGF0IERlYXRoIn0KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MjEsZm9udFdlaWdodDozMDAsY29sb3I6Qy5ibH19PntmbXQodG90YWxFc3RhdGUpfTwvZGl2PgogICAgICAgICAgICAgIHtlbj09PSJnMiIgJiYgKAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4LHBhZGRpbmc6IjhweCAxMHB4IixiYWNrZ3JvdW5kOkMuYmcsYm9yZGVyUmFkaXVzOjUsZm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNSx0ZXh0QWxpZ246ImxlZnQifX0+CiAgICAgICAgICAgICAgICAgIHsiRnVsbCBlc3RhdGUgaW5jbHVkaW5nIHRydXN0IGFzc2V0cywgcmV0aXJlbWVudCBhY2NvdW50cywgYW5kIGFueSBpbnN1cmFuY2UgcHJvY2VlZHMuIEFkbWluIGNvc3RzIGFuZCBkZWJ0cyBkZWR1Y3RlZCBiZWZvcmUgZGlzdHJpYnV0aW9uLiJ9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIHsvKiBBcnJvdyAtIGFkbWluL2RlYnRzICovfQogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZmxleERpcmVjdGlvbjoiY29sdW1uIixhbGlnbkl0ZW1zOiJjZW50ZXIiLHBhZGRpbmc6IjNweCAwIn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDoxLjUsaGVpZ2h0OjE0LGJhY2tncm91bmQ6Qy50eEYrIjQ0In19IC8+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpDLnR4RixwYWRkaW5nOiIycHggN3B4IixiYWNrZ3JvdW5kOkMudHhGKyIwOCIsYm9yZGVyUmFkaXVzOjMsbWFyZ2luOiIxLjVweCAwIixsaW5lSGVpZ2h0OjEuM319PgogICAgICAgICAgICAgICAgeyJBZG1pbiwgZGVidHMsIG1vcnRnYWdlOiAtIiArIGZtdChhZG1pbkNvc3RzICsgbW9ydGdhZ2UpfQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDowLGhlaWdodDowLGJvcmRlckxlZnQ6IjQuNXB4IHNvbGlkIHRyYW5zcGFyZW50Iixib3JkZXJSaWdodDoiNC41cHggc29saWQgdHJhbnNwYXJlbnQiLGJvcmRlclRvcDoiNS41cHggc29saWQgIitDLnR4RisiNjYifX0gLz4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICB7LyogTmV0IGRpc3RyaWJ1dGFibGUgKi99CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3twYWRkaW5nOiIxNHB4IDIwcHgiLGJvcmRlclJhZGl1czo3LGJvcmRlcjoiMS41cHggc29saWQgIitDLmJsKyI0NCIsYmFja2dyb3VuZDoiI2ZmZiIsdGV4dEFsaWduOiJjZW50ZXIiLG1pbldpZHRoOjIwMH19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMSxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206MX19Pk5ldCBEaXN0cmlidXRhYmxlPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjIxLGZvbnRXZWlnaHQ6MzAwLGNvbG9yOkMuYmx9fT57Zm10KG5ldERpc3RyaWJ1dGFibGUpfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIHsvKiBBcnJvdyAtIHRheCAqL30KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGZsZXhEaXJlY3Rpb246ImNvbHVtbiIsYWxpZ25JdGVtczoiY2VudGVyIixwYWRkaW5nOiIzcHggMCJ9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6MS41LGhlaWdodDoxNCxiYWNrZ3JvdW5kOkMuYWMrIjQ0In19IC8+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpDLmFjLHBhZGRpbmc6IjJweCA3cHgiLGJhY2tncm91bmQ6Qy5hY0wsYm9yZGVyUmFkaXVzOjMsbWFyZ2luOiIxLjVweCAwIixsaW5lSGVpZ2h0OjEuM319PgogICAgICAgICAgICAgICAge2lzTWFycmllZCA/ICJDb21iaW5lZCBleGVtcHRpb24gKGluY2wuIHBvcnRhYmlsaXR5KSAtICQwIGZlZGVyYWwgdGF4IiA6ICJGZWRlcmFsIGV4ZW1wdGlvbiBhcHBsaWVzIC0gdmVyaWZ5IGN1cnJlbnQgYW1vdW50In0KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICB7aGFzU3RhdGVUYXggJiYgc3RhdGVUYXhOb3RlICYmICgKICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy53YSxwYWRkaW5nOiIycHggN3B4IixiYWNrZ3JvdW5kOkMud2FMLGJvcmRlclJhZGl1czozLG1hcmdpbjoiMS41cHggMCIsbGluZUhlaWdodDoxLjN9fT4KICAgICAgICAgICAgICAgICAge3N0YXRlVGF4Tm90ZX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjAsaGVpZ2h0OjAsYm9yZGVyTGVmdDoiNC41cHggc29saWQgdHJhbnNwYXJlbnQiLGJvcmRlclJpZ2h0OiI0LjVweCBzb2xpZCB0cmFuc3BhcmVudCIsYm9yZGVyVG9wOiI1LjVweCBzb2xpZCAiK0MuYWMrIjY2In19IC8+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgey8qIFN1Yi10cnVzdCBub3RlICovfQogICAgICAgICAgICB7c2Vjb25kRGVhdGhEaXN0cmlidXRpb24gIT09ICJvdXRyaWdodCIgJiYgc3VidHJ1c3RzTm90ZSAmJiAoCiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3BhZGRpbmc6IjEwcHggMThweCIsYmFja2dyb3VuZDpDLmFjTCxib3JkZXJSYWRpdXM6Nix0ZXh0QWxpZ246ImNlbnRlciIsbWFyZ2luVG9wOjIsbWFyZ2luQm90dG9tOjJ9fT4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMS41LGZvbnRXZWlnaHQ6NjAwLGNvbG9yOkMuYWN9fT5Qcm90ZWN0aXZlIHN1Yi10cnVzdHMgYWN0aXZhdGU8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMuYWMrImJiIixtYXJnaW5Ub3A6Mn19PntzdWJ0cnVzdHNOb3RlfTwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApfQoKICAgICAgICAgICAgey8qIEJlbmVmaWNpYXJ5IGNvbHVtbnMgLSB1bmlmaWVkIHJlbmRlcmVyICovfQogICAgICAgICAgICB7YmVuZWZpY2lhcnlDb2x1bW5zLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3t3aWR0aDoiMTAwJSIsbWFyZ2luVG9wOjh9fT4KICAgICAgICAgICAgICAgIHsvKiBTZWN0aW9uIGhlYWRlciAqL30KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LjUsY29sb3I6Qy50eEwsbGV0dGVyU3BhY2luZzowLjksdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixmb250RmFtaWx5OiJzYW5zLXNlcmlmIixmb250V2VpZ2h0OjUwMCx0ZXh0QWxpZ246ImNlbnRlciIsbWFyZ2luQm90dG9tOjEwfX0+CiAgICAgICAgICAgICAgICAgIHsiRGlzdHJpYnV0aW9uIG9mICIgKyBmbXQobmV0RGlzdHJpYnV0YWJsZSl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6MTAsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsZmxleFdyYXA6IndyYXAifX0+CiAgICAgICAgICAgICAgICAgIHtiZW5lZmljaWFyeUNvbHVtbnMubWFwKChjb2wsaSk9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgICA9IGNvbFZhbHVlKGNvbCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBjb2xDb2xvcihjb2wpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVrZXkgID0gY29sRW5LZXkoY29sLGkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBjdExhYmVsID0gY29sLnBlcmNlbnRhZ2UgPyAiICgiICsgTWF0aC5yb3VuZChjb2wucGVyY2VudGFnZSoxMDApICsgIiUpIiA6ICIiOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpeExhYmVsID0gY29sLmZpeGVkQW1vdW50ID8gIiAoZml4ZWQpIiA6ICIiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGtleT17aX0gb25DbGljaz17KCk9PnNldEVuKGVuPT09ZWtleT9udWxsOmVrZXkpfQogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e3BhZGRpbmc6IjEwcHggMTZweCIsYm9yZGVyUmFkaXVzOjcsY3Vyc29yOiJwb2ludGVyIix0cmFuc2l0aW9uOiJhbGwgLjJzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IjEuNXB4IHNvbGlkICIrY29sb3IrIjQ0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmVuPT09ZWtleT9jb2xvcisiMDgiOiIjZmZmIiwKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ImNlbnRlciIsbWluV2lkdGg6MTQwfX0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMCxjb2xvcjpDLnR4TCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206MX19Pntjb2wubGFiZWx9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxNyxmb250V2VpZ2h0OjMwMCxjb2xvcjpjb2xvcn19PntmbXQodmFsKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjkuNSxjb2xvcjpjb2xvcisiOTkiLG1hcmdpblRvcDoxfX0+e2ZpeExhYmVsfHxwY3RMYWJlbHx8InJlc2lkdWUifTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICB7ZW49PT1la2V5ICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjgscGFkZGluZzoiOHB4IDEwcHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NSxmb250U2l6ZToxMS41LGNvbG9yOkMudHhNLGxpbmVIZWlnaHQ6MS41LHRleHRBbGlnbjoibGVmdCJ9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+e2NvbC5wZW9wbGUuam9pbigiLCAiKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6NCxjb2xvcjpDLnR4TH19Pntjb2wubm90ZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICl9CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICB7ZnVuZGluZ0dhcE5vdGUgJiYgKAogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjE0LHBhZGRpbmc6IjEycHggMThweCIsYmFja2dyb3VuZDpDLndhTCxib3JkZXI6IjFweCBzb2xpZCAiK0Mud2ErIjE4Iixib3JkZXJSYWRpdXM6Nn19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMixjb2xvcjpDLndhLGxpbmVIZWlnaHQ6MS42fX0+PHN0cm9uZz5DdXJyZW50IGdhcDogPC9zdHJvbmc+e2Z1bmRpbmdHYXBOb3RlfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICl9CiAgICAgICAgPC9kaXY+CiAgICAgICl9CiAgICA8L2Rpdj4KICApOwp9CgovKiA9PT09PT09PT09PSBWNDogU1RSQVRFR1kgPT09PT09PT09PT0gKi8KCmZ1bmN0aW9uIFY0KCkgewogIGNvbnN0IFt0YWIsIHNldFRhYl0gPSB1c2VTdGF0ZSgiY29tcGFyZSIpOwogIGNvbnN0IFtlciwgc2V0RXJdICAgPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbZXAsIHNldEVwXSAgID0gdXNlU3RhdGUobnVsbCk7CgogIGNvbnN0IGhhc0luc3VyYW5jZSA9IGFzc2V0cy5zb21lKGE9PmEudHlwZT09PSJJbnN1cmFuY2UiKTsKICBjb25zdCBpbnN1cmFuY2VWYWwgPSBhc3NldHMuZmlsdGVyKGE9PmEudHlwZT09PSJJbnN1cmFuY2UiKS5yZWR1Y2UoKHMsYSk9PnMrYS52YWx1ZSwwKTsKICBjb25zdCBpbGl0TGFiZWwgICAgPSBoYXNJbnN1cmFuY2UgPyAiSUxJVCBBbmFseXNpcyAoIitmbXQoaW5zdXJhbmNlVmFsKSsiKSIgOiAiSUxJVCBBbmFseXNpcyI7CgogIHJldHVybiAoPGRpdj4KICAgIDxWVCB0PSJTdHJhdGVneSIgcz17IldoYXQgY2hhbmdlcywgd2h5LCBhbmQgbmV4dCBzdGVwcy4gIitkb21pY2lsZVN0YXRlKyIgcGxhbm5pbmcgY29udGV4dC4ifSAvPgogICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGdhcDowLG1hcmdpbkJvdHRvbToyMCxiYWNrZ3JvdW5kOkMuYkwsYm9yZGVyUmFkaXVzOjYscGFkZGluZzozLHdpZHRoOiJmaXQtY29udGVudCJ9fT4KICAgICAge1tbImNvbXBhcmUiLCJQbGFuIENvbXBhcmlzb24iXSxbImNvZyIsIlN0YXRlIENvbnRleHQiXSxbImlsaXQiLGlsaXRMYWJlbF1dLm1hcCgoW2ssbGFiXSk9PigKICAgICAgICA8YnV0dG9uIGtleT17a30gb25DbGljaz17KCk9PntzZXRUYWIoayk7c2V0RXIobnVsbCk7c2V0RXAobnVsbCk7fX0KICAgICAgICAgIHN0eWxlPXt7cGFkZGluZzoiN3B4IDE4cHgiLGJvcmRlclJhZGl1czo0LGJvcmRlcjoibm9uZSIsY3Vyc29yOiJwb2ludGVyIiwKICAgICAgICAgICAgYmFja2dyb3VuZDp0YWI9PT1rPyIjZmZmIjoidHJhbnNwYXJlbnQiLGNvbG9yOnRhYj09PWs/Qy50eDpDLnR4TCwKICAgICAgICAgICAgZm9udFNpemU6MTIuNSxmb250V2VpZ2h0OnRhYj09PWs/NjAwOjQwMCxmb250RmFtaWx5OiJzYW5zLXNlcmlmIiwKICAgICAgICAgICAgYm94U2hhZG93OnRhYj09PWs/IjAgMXB4IDNweCByZ2JhKDAsMCwwLC4wNikiOiJub25lIix0cmFuc2l0aW9uOiJhbGwgLjJzIn19PntsYWJ9PC9idXR0b24+CiAgICAgICkpfQogICAgPC9kaXY+CgogICAge3RhYj09PSJjb21wYXJlIiAmJiAoPGRpdj4KICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ImdyaWQiLGdyaWRUZW1wbGF0ZUNvbHVtbnM6IjFmciA2MHB4IDFmciIsZ2FwOjE2LG1hcmdpbkJvdHRvbToyMCxhbGlnbkl0ZW1zOiJjZW50ZXIifX0+CiAgICAgICAgPENkIHN0eWxlPXt7dGV4dEFsaWduOiJjZW50ZXIiLHBhZGRpbmc6IjE4cHggMjBweCIsYm9yZGVyOiIxcHggc29saWQgIitDLmRhKyIyMiJ9fT4KICAgICAgICAgIDxDTD5DdXJyZW50IFN0YXRlPC9DTD4KICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxNSxmb250V2VpZ2h0OjUwMCxjb2xvcjpDLmRhLG1hcmdpblRvcDo2fX0+TmVlZHMgV29yazwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMudHhMLG1hcmdpblRvcDo0LGxpbmVIZWlnaHQ6MS41fX0+UmV2aWV3IHRoZSByb3dzIGJlbG93IHRvIHNlZSB3aGF0IGlzIGluIHBsYWNlIGFuZCB3aGF0IG5lZWRzIHRvIGNoYW5nZS48L2Rpdj4KICAgICAgICA8L0NkPgogICAgICAgIDxkaXYgc3R5bGU9e3t0ZXh0QWxpZ246ImNlbnRlciIsZm9udFNpemU6MTgsY29sb3I6Qy5hYyxmb250RmFtaWx5OiJzYW5zLXNlcmlmIn19PnZzPC9kaXY+CiAgICAgICAgPENkIHN0eWxlPXt7dGV4dEFsaWduOiJjZW50ZXIiLHBhZGRpbmc6IjE4cHggMjBweCIsYm9yZGVyOiIxcHggc29saWQgIitDLmFjKyIzMyJ9fT4KICAgICAgICAgIDxDTD5Qcm9wb3NlZCBTdGF0ZTwvQ0w+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTUsZm9udFdlaWdodDo1MDAsY29sb3I6Qy5hYyxtYXJnaW5Ub3A6Nn19PlRhcmdldCBQbGFuPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsY29sb3I6Qy50eEwsbWFyZ2luVG9wOjQsbGluZUhlaWdodDoxLjV9fT5FYWNoIHJvdyBzaG93cyB0aGUgcmVjb21tZW5kZWQgY2hhbmdlIGFuZCB3aHkgaXQgbWF0dGVycy48L2Rpdj4KICAgICAgICA8L0NkPgogICAgICA8L2Rpdj4KICAgICAge3N0cmF0ZWd5Um93cy5sZW5ndGggPiAwID8gKAogICAgICAgIDxDZD57c3RyYXRlZ3lSb3dzLm1hcCgocixpKT0+e2NvbnN0IGlzRT1lcj09PWk7cmV0dXJuKDxkaXYga2V5PXtpfT4KICAgICAgICAgIDxkaXYgb25DbGljaz17KCk9PnIuZCYmc2V0RXIoaXNFP251bGw6aSl9CiAgICAgICAgICAgIHN0eWxlPXt7ZGlzcGxheToiZ3JpZCIsZ3JpZFRlbXBsYXRlQ29sdW1uczoiMTcwcHggMWZyIDFmciIscGFkZGluZzoiMTBweCAwIiwKICAgICAgICAgICAgICBib3JkZXJCb3R0b206IjFweCBzb2xpZCAiK0MuYkwsY3Vyc29yOnIuZD8icG9pbnRlciI6ImRlZmF1bHQiLAogICAgICAgICAgICAgIGJhY2tncm91bmQ6ci5obD9DLndhTCsiNjYiOiJ0cmFuc3BhcmVudCJ9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLjUsY29sb3I6Qy50eCxmb250V2VpZ2h0OnIuaGw/NjAwOjQwMCxkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo0fX0+CiAgICAgICAgICAgICAge3IuZCYmPHNwYW4gc3R5bGU9e3tmb250U2l6ZTo5LGNvbG9yOkMudHhGLHRyYW5zaXRpb246InRyYW5zZm9ybSAuMnMiLHRyYW5zZm9ybTppc0U/InJvdGF0ZSg5MGRlZykiOiJub25lIixkaXNwbGF5OiJpbmxpbmUtYmxvY2sifX0+eyI+In08L3NwYW4+fQogICAgICAgICAgICAgIHtyLmx9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLmRhLHRleHRBbGlnbjoiY2VudGVyIn19PntyLmN1fTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLmFjLGZvbnRXZWlnaHQ6NTAwLHRleHRBbGlnbjoiY2VudGVyIn19PntyLnByfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICB7aXNFJiZyLmQmJjxkaXYgc3R5bGU9e3twYWRkaW5nOiI4cHggMTRweCAxMnB4IDI0cHgiLGZvbnRTaXplOjEyLGNvbG9yOkMudHhMLGxpbmVIZWlnaHQ6MS42LGJhY2tncm91bmQ6Qy5iZyxib3JkZXJCb3R0b206IjFweCBzb2xpZCAiK0MuYkwsYW5pbWF0aW9uOiJ2ZiAuMTVzIGVhc2UifX0+e3IuZH08L2Rpdj59CiAgICAgICAgPC9kaXY+KTt9KX08L0NkPgogICAgICApIDogKAogICAgICAgIDxDZD48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMiLHRleHRBbGlnbjoiY2VudGVyIixwYWRkaW5nOiIxNnB4IDAifX0+Tm8gc3RyYXRlZ3kgcm93cyBwcm92aWRlZC48L2Rpdj48L0NkPgogICAgICApfQogICAgPC9kaXY+KX0KCiAgICB7dGFiPT09ImNvZyIgJiYgKDxkaXY+CiAgICAgIDxDZCBzdHlsZT17e21hcmdpbkJvdHRvbToxNn19PgogICAgICAgIDxDTD57IlN0YXRlIENvbnRleHQgLSAiK2RvbWljaWxlU3RhdGV9PC9DTD4KICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjcsbWFyZ2luVG9wOjh9fT57Y29nU3VtbWFyeX08L2Rpdj4KICAgICAgPC9DZD4KICAgIDwvZGl2Pil9CgogICAge3RhYj09PSJpbGl0IiAmJiAoPGRpdj4KICAgICAgPENkIHN0eWxlPXt7bWFyZ2luQm90dG9tOjE2fX0+PENMPkN1cnJlbnQgU2l0dWF0aW9uPC9DTD48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy50eE0sbGluZUhlaWdodDoxLjYsbWFyZ2luVG9wOjZ9fT57aWxpdEFuYWx5c2lzLnNpdHVhdGlvbn08L2Rpdj48L0NkPgogICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZ3JpZCIsZ3JpZFRlbXBsYXRlQ29sdW1uczoiMWZyIDFmciIsZ2FwOjE2LG1hcmdpbkJvdHRvbToxNn19PgogICAgICAgIDxDZCBzdHlsZT17e2JvcmRlcjoiMXB4IHNvbGlkICIrQy5hYysiMjIifX0+PENMPkFyZ3VtZW50cyBGT1IgYW4gSUxJVDwvQ0w+PGRpdiBzdHlsZT17e21hcmdpblRvcDo4fX0+CiAgICAgICAgICB7aWxpdEFuYWx5c2lzLnByb3MubGVuZ3RoID09PSAwICYmIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMixjb2xvcjpDLnR4TCxmb250U3R5bGU6Iml0YWxpYyJ9fT5Ob25lIGlkZW50aWZpZWQuPC9kaXY+fQogICAgICAgICAge2lsaXRBbmFseXNpcy5wcm9zLm1hcCgocCxpKT0+e2NvbnN0IGlzRT1lcD09PSJwIitpO3JldHVybig8ZGl2IGtleT17aX0+CiAgICAgICAgICAgIDxkaXYgb25DbGljaz17KCk9PnNldEVwKGlzRT9udWxsOiJwIitpKX0gc3R5bGU9e3twYWRkaW5nOiI2cHggMCIsYm9yZGVyQm90dG9tOiIxcHggc29saWQgIitDLmJMLGN1cnNvcjoicG9pbnRlciIsZGlzcGxheToiZmxleCIsYWxpZ25JdGVtczoiY2VudGVyIixnYXA6NX19PgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6OSxjb2xvcjpDLnR4Rix0cmFuc2Zvcm06aXNFPyJyb3RhdGUoOTBkZWcpIjoibm9uZSIsdHJhbnNpdGlvbjoidHJhbnNmb3JtIC4xNXMiLGRpc3BsYXk6ImlubGluZS1ibG9jayJ9fT57Ij4ifTwvc3Bhbj4KICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEyLjUsY29sb3I6Qy5hYyxmb250V2VpZ2h0OjUwMH19PntwLmxhYmVsfTwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIHtpc0UmJjxkaXYgc3R5bGU9e3twYWRkaW5nOiI0cHggMCA4cHggMTZweCIsZm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TCxsaW5lSGVpZ2h0OjEuNSxhbmltYXRpb246InZmIC4xMnMgZWFzZSJ9fT57cC50ZXh0fTwvZGl2Pn0KICAgICAgICAgIDwvZGl2Pik7fSl9CiAgICAgICAgPC9kaXY+PC9DZD4KICAgICAgICA8Q2Qgc3R5bGU9e3tib3JkZXI6IjFweCBzb2xpZCAiK0MuZGErIjIyIn19PjxDTD5Bcmd1bWVudHMgQUdBSU5TVCBhbiBJTElUPC9DTD48ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjh9fT4KICAgICAgICAgIHtpbGl0QW5hbHlzaXMuY29ucy5sZW5ndGggPT09IDAgJiYgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEyLGNvbG9yOkMudHhMLGZvbnRTdHlsZToiaXRhbGljIn19Pk5vbmUgaWRlbnRpZmllZC48L2Rpdj59CiAgICAgICAgICB7aWxpdEFuYWx5c2lzLmNvbnMubWFwKChwLGkpPT57Y29uc3QgaXNFPWVwPT09ImMiK2k7cmV0dXJuKDxkaXYga2V5PXtpfT4KICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXsoKT0+c2V0RXAoaXNFP251bGw6ImMiK2kpfSBzdHlsZT17e3BhZGRpbmc6IjZweCAwIixib3JkZXJCb3R0b206IjFweCBzb2xpZCAiK0MuYkwsY3Vyc29yOiJwb2ludGVyIixkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo1fX0+CiAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZTo5LGNvbG9yOkMudHhGLHRyYW5zZm9ybTppc0U/InJvdGF0ZSg5MGRlZykiOiJub25lIix0cmFuc2l0aW9uOiJ0cmFuc2Zvcm0gLjE1cyIsZGlzcGxheToiaW5saW5lLWJsb2NrIn19PnsiPiJ9PC9zcGFuPgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTIuNSxjb2xvcjpDLmRhLGZvbnRXZWlnaHQ6NTAwfX0+e3AubGFiZWx9PC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAge2lzRSYmPGRpdiBzdHlsZT17e3BhZGRpbmc6IjRweCAwIDhweCAxNnB4Iixmb250U2l6ZToxMS41LGNvbG9yOkMudHhMLGxpbmVIZWlnaHQ6MS41LGFuaW1hdGlvbjoidmYgLjEycyBlYXNlIn19PntwLnRleHR9PC9kaXY+fQogICAgICAgICAgPC9kaXY+KTt9KX0KICAgICAgICA8L2Rpdj48L0NkPgogICAgICA8L2Rpdj4KICAgICAgPENkIHN0eWxlPXt7YmFja2dyb3VuZDpDLmJsTCxib3JkZXI6IjFweCBzb2xpZCAiK0MuYmwrIjIyIn19PgogICAgICAgIDxDTD5SZWNvbW1lbmRhdGlvbjwvQ0w+CiAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEzLGNvbG9yOkMuYmwsbGluZUhlaWdodDoxLjYsbWFyZ2luVG9wOjYsZm9udFdlaWdodDo1MDB9fT57aWxpdEFuYWx5c2lzLnJlY29tbWVuZGF0aW9ufTwvZGl2PgogICAgICA8L0NkPgogICAgPC9kaXY+KX0KICA8L2Rpdj4pOwp9CgpmdW5jdGlvbiBWNSgpIHsKICBjb25zdCBbc3QsIHNldFN0XSA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IFtzcCwgc2V0U3BdID0gdXNlU3RhdGUobnVsbCk7CiAgcmV0dXJuICg8ZGl2PgogICAgPFZUIHQ9IlRydXN0IEFyY2hpdGVjdHVyZSIgcz0iQ3VycmVudCBzdHJ1Y3R1cmUgYW5kIHByb3Bvc2VkIGNoYW5nZXMuIENsaWNrIGFueSBlbnRpdHkgZm9yIHByb3Zpc2lvbnMuIiAvPgogICAgPENkIHN0eWxlPXt7cGFkZGluZzoiMjhweCAzMnB4In19PgogICAgICA8ZGl2IHN0eWxlPXt7dGV4dEFsaWduOiJjZW50ZXIiLG1hcmdpbkJvdHRvbToyNH19PgogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJpbmxpbmUtZmxleCIsZ2FwOjE2LGFsaWduSXRlbXM6ImNlbnRlciIscGFkZGluZzoiMTBweCAyMnB4IixiYWNrZ3JvdW5kOkMuYmcsYm9yZGVyUmFkaXVzOjd9fT4KICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6MTMsZm9udFdlaWdodDo1MDB9fT57ZmFtaWx5LmNsaWVudC5uYW1lfTwvc3Bhbj4KICAgICAgICAgIHtmYW1pbHkuc3BvdXNlJiY8PjxzcGFuIHN0eWxlPXt7Y29sb3I6Qy50eEYsZm9udFNpemU6MTN9fT57IiYifTwvc3Bhbj48c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEzLGZvbnRXZWlnaHQ6NTAwfX0+e2ZhbWlseS5zcG91c2UubmFtZX08L3NwYW4+PC8+fQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhMLG1hcmdpblRvcDo0fX0+eyJHcmFudG9ycyB8IEVzdGF0ZTogIitmbXQodG90YWxFc3RhdGUpKyIgKG5ldCBlcXVpdHkgIitmbXQoZ3Jvc3NFcXVpdHkpKyIpIn08L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICB7dHJ1c3RFbnRpdGllcy5sZW5ndGggPT09IDAgPyAoCiAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEzLGNvbG9yOkMudHhMLGZvbnRTdHlsZToiaXRhbGljIix0ZXh0QWxpZ246ImNlbnRlciIscGFkZGluZzoiMjBweCAwIn19Pk5vIHRydXN0IGVudGl0aWVzIHByb3ZpZGVkLjwvZGl2PgogICAgICApIDogKAogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJncmlkIixncmlkVGVtcGxhdGVDb2x1bW5zOiJyZXBlYXQoYXV0by1maWxsLG1pbm1heCgyMjBweCwxZnIpKSIsZ2FwOjE0fX0+CiAgICAgICAgICB7dHJ1c3RFbnRpdGllcy5tYXAoKHQsdGkpPT57Y29uc3QgaXNTZWw9c3Q9PT10aTtyZXR1cm4oCiAgICAgICAgICAgIDxkaXYga2V5PXt0aX0gb25DbGljaz17KCk9PntzZXRTdChpc1NlbD9udWxsOnRpKTtzZXRTcChudWxsKTt9fQogICAgICAgICAgICAgIHN0eWxlPXt7cGFkZGluZzoiMTZweCAxNHB4Iixib3JkZXJSYWRpdXM6NyxjdXJzb3I6InBvaW50ZXIiLHRyYW5zaXRpb246ImFsbCAuMnMiLHBvc2l0aW9uOiJyZWxhdGl2ZSIsCiAgICAgICAgICAgICAgICBib3JkZXI6IjEuNXB4IHNvbGlkICIrKGlzU2VsP3QuY29sb3I6dC5jb2xvcisiMzMiKSxiYWNrZ3JvdW5kOmlzU2VsP3QuY29sb3IrIjA2IjoiI2ZmZiJ9fT4KICAgICAgICAgICAgICB7dC5zdGF0dXM9PT0ib3V0ZGF0ZWQiJiY8U0JhZGdlIHQ9Ik5lZWRzIFVwZGF0ZSIgY289e0Mud2F9IC8+fQogICAgICAgICAgICAgIHt0LnN0YXR1cz09PSJwbGFubmVkIiYmPFNCYWRnZSB0PSJQcm9wb3NlZCIgY289e0MuYWN9IC8+fQogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZTo5LGNvbG9yOnQuY29sb3IsZm9udEZhbWlseToic2Fucy1zZXJpZiIsbGV0dGVyU3BhY2luZzoxLHRleHRUcmFuc2Zvcm06InVwcGVyY2FzZSIsbWFyZ2luQm90dG9tOjN9fT57dC50eXBlfTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxNCxmb250V2VpZ2h0OjYwMCxjb2xvcjpDLnR4LG1hcmdpbkJvdHRvbToxfX0+e3QubmFtZX08L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MjAsZm9udFdlaWdodDozMDAsY29sb3I6dC5jb2xvcn19Pnt0LnRvdGFsVmFsdWU+MD9mbXQodC50b3RhbFZhbHVlKToiLS0ifTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6OCxmb250U2l6ZToxMSxjb2xvcjpDLnR4TCxsaW5lSGVpZ2h0OjEuNH19PgogICAgICAgICAgICAgICAgPGRpdj48c3Ryb25nIHN0eWxlPXt7Y29sb3I6Qy50eE19fT5UcnVzdGVlOjwvc3Ryb25nPiB7dC50cnVzdGVlfHx0LmdyYW50b3J9PC9kaXY+CiAgICAgICAgICAgICAgICB7dC5wcm90ZWN0b3ImJjxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6Mn19PjxzdHJvbmcgc3R5bGU9e3tjb2xvcjpDLnR4TX19PlByb3RlY3Rvcjo8L3N0cm9uZz4ge3QucHJvdGVjdG9yfTwvZGl2Pn0KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICB7aXNTZWwmJig8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjE0LHBhZGRpbmdUb3A6MTIsYm9yZGVyVG9wOiIxcHggc29saWQgIitDLmJMLGFuaW1hdGlvbjoidmYgLjE1cyBlYXNlIn19IG9uQ2xpY2s9e2U9PmUuc3RvcFByb3BhZ2F0aW9uKCl9PgogICAgICAgICAgICAgICAgPERSIGw9IkVzdGFibGlzaGVkIiB2PXt0LmVzdGFibGlzaGVkfSAvPjxEUiBsPSJHcmFudG9yIiB2PXt0LmdyYW50b3J8fCItLSJ9IC8+CiAgICAgICAgICAgICAgICB7dC5zdWNjZXNzb3ImJjxEUiBsPSJTdWNjZXNzb3IiIHY9e3Quc3VjY2Vzc29yfSAvPn0KICAgICAgICAgICAgICAgIHt0LmJlbmVmaWNpYXJpZXMmJjxEUiBsPSJCZW5lZmljaWFyaWVzIiB2PXt0LmJlbmVmaWNpYXJpZXN9IC8+fQogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e21hcmdpblRvcDo4LGZvbnRTaXplOjEwLGNvbG9yOkMudHhMLHRleHRUcmFuc2Zvcm06InVwcGVyY2FzZSIsbGV0dGVyU3BhY2luZzowLjcsZm9udEZhbWlseToic2Fucy1zZXJpZiJ9fT5Bc3NldHM8L2Rpdj4KICAgICAgICAgICAgICAgIHt0LmFzc2V0TGlzdC5tYXAoKGEsYWkpPT4oPGRpdiBrZXk9e2FpfSBzdHlsZT17e2ZvbnRTaXplOjExLjUsY29sb3I6Qy50eE0scGFkZGluZzoiMnB4IDAifX0+eyItICIrYX08L2Rpdj4pKX0KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5Ub3A6MTIsZm9udFNpemU6MTAsY29sb3I6Qy50eEwsdGV4dFRyYW5zZm9ybToidXBwZXJjYXNlIixsZXR0ZXJTcGFjaW5nOjAuNyxmb250RmFtaWx5OiJzYW5zLXNlcmlmIixtYXJnaW5Cb3R0b206NH19PgogICAgICAgICAgICAgICAgICBLZXkgUHJvdmlzaW9ucyA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjksY29sb3I6Qy50eEZ9fT4tLSBjbGljayB0byBleHBhbmQ8L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIHt0LnByb3Zpc2lvbnMubWFwKChwLHBpKT0+e2NvbnN0IHBrPXRpKyItIitwaTtyZXR1cm4oPGRpdiBrZXk9e3BpfSBzdHlsZT17e21hcmdpbkJvdHRvbToxfX0+CiAgICAgICAgICAgICAgICAgIDxkaXYgb25DbGljaz17KCk9PnNldFNwKHNwPT09cGs/bnVsbDpwayl9CiAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3twYWRkaW5nOiI2cHggOHB4Iixmb250U2l6ZToxMixjb2xvcjpDLnR4LGN1cnNvcjoicG9pbnRlciIsYm9yZGVyUmFkaXVzOjMsCiAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo1LAogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDpzcD09PXBrP3QuY29sb3IrIjA4IjoidHJhbnNwYXJlbnQiLAogICAgICAgICAgICAgICAgICAgICAgYm9yZGVyTGVmdDoiMnB4IHNvbGlkICIrKHNwPT09cGs/dC5jb2xvcjoidHJhbnNwYXJlbnQiKX19PgogICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7Zm9udFNpemU6OSxjb2xvcjpDLnR4Rix0cmFuc2l0aW9uOiJ0cmFuc2Zvcm0gLjE1cyIsdHJhbnNmb3JtOnNwPT09cGs/InJvdGF0ZSg5MGRlZykiOiJub25lIixkaXNwbGF5OiJpbmxpbmUtYmxvY2sifX0+eyI+In08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250V2VpZ2h0OjUwMH19PntwLmxhYmVsfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgIHtzcD09PXBrJiY8ZGl2IHN0eWxlPXt7cGFkZGluZzoiNHB4IDhweCA4cHggMThweCIsZm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TCxsaW5lSGVpZ2h0OjEuNTUsYW5pbWF0aW9uOiJ2ZiAuMTJzIGVhc2UifX0+e3AudGV4dH08L2Rpdj59CiAgICAgICAgICAgICAgICA8L2Rpdj4pO30pfQogICAgICAgICAgICAgIDwvZGl2Pil9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKTt9KX08L2Rpdj4KICAgICAgKX0KCiAgICAgIHsvKiBCZW5lZmljaWFyeSBjb2x1bW5zIGZyb20gd2F0ZXJmYWxsQ29uZmlnICovfQogICAgICB7d2F0ZXJmYWxsQ29uZmlnLmJlbmVmaWNpYXJ5Q29sdW1ucy5sZW5ndGggPiAwICYmICgKICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjI0LHRleHRBbGlnbjoiY2VudGVyIn19PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLGNvbG9yOkMudHhMLGxldHRlclNwYWNpbmc6MSx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UiLGZvbnRGYW1pbHk6InNhbnMtc2VyaWYiLG1hcmdpbkJvdHRvbToxMH19PkJlbmVmaWNpYXJpZXMgYXQgU2Vjb25kIERlYXRoPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsZ2FwOjQwLGZsZXhXcmFwOiJ3cmFwIn19PgogICAgICAgICAgICB7d2F0ZXJmYWxsQ29uZmlnLmJlbmVmaWNpYXJ5Q29sdW1ucy5tYXAoKGNvbCxpKT0+KAogICAgICAgICAgICAgIDxHQyBrZXk9e2l9IGw9e2NvbC5sYWJlbH0gcD17Y29sLnBlb3BsZX0gbj17Y29sLm5vdGV9IGNvPXtDLmFjfSAvPgogICAgICAgICAgICApKX0KICAgICAgICAgICAge2ZhbWlseS5jaGlsZHJlbi5zb21lKGM9PmMuZ2MmJmMuZ2MubGVuZ3RoPjApJiYoCiAgICAgICAgICAgICAgPEdDIGw9IkdlbiAyIC0gR3JhbmRjaGlsZHJlbiIgcD17ZmFtaWx5LmNoaWxkcmVuLmZsYXRNYXAoYz0+Yy5nY3x8W10pfSBuPSJTZWUgRmFtaWx5IFRyZWUgdGFiIGZvciBkZXRhaWxzLiIgLz4KICAgICAgICAgICAgKX0KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICApfQogICAgPC9DZD4KICA8L2Rpdj4pOwp9CgpmdW5jdGlvbiBWNigpIHsKICBjb25zdCBbZW0sIHNldEVtXSA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IHNDb25mID0ge2RvbmU6e2M6Qy5hYyxiZzpDLmFjTCxsOiJEb25lIn0sYWN0aXZlOntjOkMuYmwsYmc6Qy5ibEwsbDoiQWN0aXZlIn0sdXBjb21pbmc6e2M6Qy53YSxiZzpDLndhTCxsOiJVcGNvbWluZyJ9LGZ1dHVyZTp7YzpDLnR4TCxiZzpDLmJnKyJlZSIsbDoiRnV0dXJlIn19OwogIGNvbnN0IGNhdEMgPSB7RW50aXR5OiIjN2E0YTJhIixEb2N1bWVudHM6Qy5ibCxQbGFubmluZzoiIzVhN2EzYSIsTGF3OkMuYWMsVGl0bGluZzoiIzhhNWEyYSIsR2lmdGluZzoiIzZhNGEzYSIsU3RyYXRlZ3k6Qy50eE0sRWR1Y2F0aW9uOkMucHUsR292ZXJuYW5jZTpDLnB1fTsKICByZXR1cm4gKDxkaXY+CiAgICA8VlQgdD0iTWlsZXN0b25lcyBhbmQgQWN0aW9ucyIgcz0iTWFqb3Igb3ZlcmhhdWwgdW5kZXJ3YXkuIEJ1bGsgb2Ygd29yayBpbiBRMS1RMyAyMDI2LiIgLz4KICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixnYXA6MTAsbWFyZ2luQm90dG9tOjIwfX0+CiAgICAgIHtPYmplY3QuZW50cmllcyhzQ29uZikubWFwKChbayxjZmddKT0+e2NvbnN0IGN0PW1pbGVzdG9uZXMuZmlsdGVyKG09Pm0uc3Q9PT1rKS5sZW5ndGg7cmV0dXJuKAogICAgICAgIDxkaXYga2V5PXtrfSBzdHlsZT17e2ZsZXg6MSxwYWRkaW5nOiIxMHB4IDE0cHgiLGJhY2tncm91bmQ6Y2ZnLmJnLGJvcmRlclJhZGl1czo2LGJvcmRlcjoiMXB4IHNvbGlkICIrY2ZnLmMrIjE0In19PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjIyLGZvbnRXZWlnaHQ6MzAwLGNvbG9yOmNmZy5jfX0+e2N0fTwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLjUsY29sb3I6Y2ZnLmMsZm9udEZhbWlseToic2Fucy1zZXJpZiJ9fT57Y2ZnLmx9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICk7fSl9CiAgICA8L2Rpdj4KICAgIDxDZCBzdHlsZT17e3BhZGRpbmc6IjIwcHggMTZweCJ9fT4KICAgICAgPGRpdiBzdHlsZT17e3Bvc2l0aW9uOiJyZWxhdGl2ZSJ9fT4KICAgICAgICA8ZGl2IHN0eWxlPXt7cG9zaXRpb246ImFic29sdXRlIixsZWZ0OjE3LHRvcDoxMCxib3R0b206MTAsd2lkdGg6MS41LGJhY2tncm91bmQ6Qy5iTH19IC8+CiAgICAgICAge21pbGVzdG9uZXMubWFwKChtLGkpPT57Y29uc3QgY2ZnPXNDb25mW20uc3RdO2NvbnN0IGNjPWNhdENbbS5jYXRdfHxDLnR4TDtjb25zdCBpc0U9ZW09PT1pO2NvbnN0IGlzTj1tLnN0PT09ImFjdGl2ZSI7CiAgICAgICAgICByZXR1cm4oPGRpdiBrZXk9e2l9IG9uQ2xpY2s9eygpPT5tLmRldGFpbCYmc2V0RW0oaXNFP251bGw6aSl9IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjE0LHBhZGRpbmc6IjEwcHggMCIsY3Vyc29yOm0uZGV0YWlsPyJwb2ludGVyIjoiZGVmYXVsdCIscG9zaXRpb246InJlbGF0aXZlIn19PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6MzYsZGlzcGxheToiZmxleCIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsYWxpZ25JdGVtczoiZmxleC1zdGFydCIscGFkZGluZ1RvcDoxLjUsekluZGV4OjEsZmxleFNocmluazowfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOmlzTj8xNjoxMCxoZWlnaHQ6aXNOPzE2OjEwLGJvcmRlclJhZGl1czoiNTAlIixiYWNrZ3JvdW5kOm0uc3Q9PT0iZG9uZSI/Y2ZnLmM6aXNOP2NmZy5jOiIjZmZmIixib3JkZXI6IjJweCBzb2xpZCAiK2NmZy5jLGFuaW1hdGlvbjppc04/InB1IDJzIGluZmluaXRlIjoibm9uZSJ9fSAvPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZsZXg6MX19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDo3LGZsZXhXcmFwOiJ3cmFwIn19PgogICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhGLG1pbldpZHRoOjU1fX0+e20uZGF0ZX08L3NwYW4+CiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17e2ZvbnRTaXplOjEzLGNvbG9yOm0uc3Q9PT0iZG9uZSI/Qy50eEw6Qy50eCxmb250V2VpZ2h0OmlzTj82MDA6NDAwfX0+e20ubGFiZWx9PC9zcGFuPgogICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tmb250U2l6ZTo4LjUscGFkZGluZzoiMS41cHggNXB4IixiYWNrZ3JvdW5kOmNjKyIxMCIsY29sb3I6Y2MsYm9yZGVyUmFkaXVzOjMsZm9udEZhbWlseToic2Fucy1zZXJpZiIsbGV0dGVyU3BhY2luZzowLjR9fT57bS5jYXR9PC9zcGFuPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIHtpc0UmJm0uZGV0YWlsJiY8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjYscGFkZGluZzoiOXB4IDEycHgiLGJhY2tncm91bmQ6Qy5iZyxib3JkZXJSYWRpdXM6NSxmb250U2l6ZToxMS41LGNvbG9yOkMudHhNLGxpbmVIZWlnaHQ6MS42LGFuaW1hdGlvbjoidmYgLjE1cyBlYXNlIixib3JkZXJMZWZ0OiIzcHggc29saWQgIitjYysiMzMifX0+e20uZGV0YWlsfTwvZGl2Pn0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4pOwogICAgICAgIH0pfQogICAgICA8L2Rpdj4KICAgIDwvQ2Q+CiAgPC9kaXY+KTsKfQoKLyogPT09PT09PT09PT0gVjc6IEZBTUlMWSBUUkVFID09PT09PT09PT09ICovCmZ1bmN0aW9uIFY3KCkgewogIGNvbnN0IFtzZWxJZCwgc2V0U2VsSWRdID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3Qgc2VsUCA9IHRyZWVQZW9wbGUuZmluZChwPT5wLmlkPT09c2VsSWQpOwoKICBjb25zdCBub2RlVyA9IDEzMCwgbm9kZUggPSA2NDsKICBjb25zdCBnZW5ZICA9IHsgMDogMzAsIDE6IDE2MCwgMjogMjkwIH07CiAgY29uc3QgZ2VuUGVvcGxlID0gWzAsMSwyXS5tYXAoZz0+dHJlZVBlb3BsZS5maWx0ZXIocD0+cC5nZW49PT1nKSk7CgogIGZ1bmN0aW9uIHhGb3IoZ2VuLCBpZHgpIHsKICAgIGNvbnN0IGNvdW50ID0gZ2VuUGVvcGxlW2dlbl0ubGVuZ3RoOwogICAgY29uc3QgdG90YWxXID0gY291bnQgKiBub2RlVyArIChjb3VudC0xKSAqIDIwOwogICAgY29uc3Qgc3RhcnRYID0gTWF0aC5tYXgoMjAsIDQwMCAtIHRvdGFsVy8yKTsKICAgIHJldHVybiBzdGFydFggKyBpZHggKiAobm9kZVcgKyAyMCk7CiAgfQoKICBjb25zdCBwb3NpdGlvbnMgPSB7fTsKICBbMCwxLDJdLmZvckVhY2goZ2VuPT57CiAgICBnZW5QZW9wbGVbZ2VuXS5mb3JFYWNoKChwLGkpPT57CiAgICAgIHBvc2l0aW9uc1twLmlkXSA9IHsgeDogeEZvcihnZW4saSksIHk6IGdlbllbZ2VuXSB9OwogICAgfSk7CiAgfSk7CgogIGNvbnN0IGNhbnZhc1cgPSBNYXRoLm1heCgKICAgIC4uLihbMCwxLDJdLmZsYXRNYXAoZz0+Z2VuUGVvcGxlW2ddLm1hcCgoXyxpKT0+eEZvcihnLGkpK25vZGVXKzIwKSkpLAogICAgNjAwCiAgKTsKICBjb25zdCBjYW52YXNIID0gdHJlZVBlb3BsZS5zb21lKHA9PnAuZ2VuPT09MikgPyAzODAgOiAodHJlZVBlb3BsZS5zb21lKHA9PnAuZ2VuPT09MSkgPyAyNTAgOiAxMjApOwoKICByZXR1cm4gKDxkaXY+CiAgICA8VlQgdD0iRmFtaWx5IFRyZWUiIHM9IkVzdGF0ZSBwbGFubmluZyByb2xlcyBhbmQgZG9jdW1lbnQgc3RhdHVzLiIgLz4KCiAgICB7dHJlZVBlb3BsZS5sZW5ndGggPT09IDAgPyAoCiAgICAgIDxDZD48ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTMsY29sb3I6Qy50eEwsZm9udFN0eWxlOiJpdGFsaWMiLHRleHRBbGlnbjoiY2VudGVyIixwYWRkaW5nOiIyMHB4IDAifX0+Tm8gZmFtaWx5IHRyZWUgZGF0YSBwcm92aWRlZC48L2Rpdj48L0NkPgogICAgKSA6ICgKICAgICAgPENkIHN0eWxlPXt7cGFkZGluZzowLG92ZXJmbG93OiJoaWRkZW4ifX0+CiAgICAgICAgey8qIExlZ2VuZCAqL30KICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjE2LHBhZGRpbmc6IjEycHggMTZweCIsYm9yZGVyQm90dG9tOiIxcHggc29saWQgIitDLmJMLGZsZXhXcmFwOiJ3cmFwIn19PgogICAgICAgICAge1tbIiMyYTVhOGMiLCJQcmltYXJ5IENsaWVudCJdLFsiIzZhNGE4YSIsIlNwb3VzZSAvIFBhcnRuZXIiXSxbIiMxYTVjM2EiLCJJbiBEb2N1bWVudHMiXSxbIiNiMDNhMmUiLCJOT1QgSW4gRG9jdW1lbnRzIl1dLm1hcCgoW2MsbF0pPT4oCiAgICAgICAgICAgIDxkaXYga2V5PXtsfSBzdHlsZT17e2Rpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsZ2FwOjYsZm9udFNpemU6MTEsY29sb3I6Qy50eE19fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7d2lkdGg6MTAsaGVpZ2h0OjEwLGJvcmRlclJhZGl1czoyLGJhY2tncm91bmQ6Y319IC8+e2x9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKSl9CiAgICAgICAgPC9kaXY+CgogICAgICAgIHsvKiBTVkcgY2FudmFzICovfQogICAgICAgIDxkaXYgc3R5bGU9e3tvdmVyZmxvd1g6ImF1dG8iLHBhZGRpbmc6IjE2cHgifX0+CiAgICAgICAgICA8c3ZnIHdpZHRoPXtjYW52YXNXfSBoZWlnaHQ9e2NhbnZhc0h9IHN0eWxlPXt7ZGlzcGxheToiYmxvY2siLG1pbldpZHRoOiIxMDAlIn19PgogICAgICAgICAgICB7LyogQ29ubmVjdG9yIGxpbmVzOiBnZW4wIHRvIGdlbjEgKi99CiAgICAgICAgICAgIHtnZW5QZW9wbGVbMF0ubGVuZ3RoPjAgJiYgZ2VuUGVvcGxlWzFdLmxlbmd0aD4wICYmICgoKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgZzAgPSBnZW5QZW9wbGVbMF07CiAgICAgICAgICAgICAgY29uc3QgZzEgPSBnZW5QZW9wbGVbMV07CiAgICAgICAgICAgICAgY29uc3QgcGFyZW50TWlkWCA9ICh4Rm9yKDAsMCkgKyB4Rm9yKDAsIGcwLmxlbmd0aC0xKSArIG5vZGVXKSAvIDI7CiAgICAgICAgICAgICAgY29uc3QgcGFyZW50WSAgICA9IGdlbllbMF0gKyBub2RlSDsKICAgICAgICAgICAgICBjb25zdCBjaGlsZFkgICAgID0gZ2VuWVsxXTsKICAgICAgICAgICAgICBjb25zdCBtaWRZICAgICAgID0gcGFyZW50WSArIChjaGlsZFkgLSBwYXJlbnRZKSAqIDAuNTsKICAgICAgICAgICAgICByZXR1cm4gKDxnPgogICAgICAgICAgICAgICAgPGxpbmUgeDE9e3BhcmVudE1pZFh9IHkxPXtwYXJlbnRZfSB4Mj17cGFyZW50TWlkWH0geTI9e21pZFl9IHN0cm9rZT17Qy5iTH0gc3Ryb2tlV2lkdGg9IjEuNSIvPgogICAgICAgICAgICAgICAge2cxLm1hcCgoXyxpKT0+ewogICAgICAgICAgICAgICAgICBjb25zdCBjeCA9IHhGb3IoMSxpKSArIG5vZGVXLzI7CiAgICAgICAgICAgICAgICAgIHJldHVybiAoPGcga2V5PXtpfT4KICAgICAgICAgICAgICAgICAgICA8bGluZSB4MT17cGFyZW50TWlkWH0geTE9e21pZFl9IHgyPXtjeH0geTI9e21pZFl9IHN0cm9rZT17Qy5iTH0gc3Ryb2tlV2lkdGg9IjEuNSIvPgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtjeH0geTE9e21pZFl9IHgyPXtjeH0geTI9e2NoaWxkWX0gc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iMS41Ii8+CiAgICAgICAgICAgICAgICAgIDwvZz4pOwogICAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgICAgPC9nPik7CiAgICAgICAgICAgIH0pKCl9CgogICAgICAgICAgICB7LyogQ29ubmVjdG9yIGxpbmVzOiBnZW4xIHRvIGdlbjIgKi99CiAgICAgICAgICAgIHtnZW5QZW9wbGVbMl0ubWFwKChjaGlsZCxpKT0+ewogICAgICAgICAgICAgIGlmICghY2hpbGQucGFyZW50IHx8ICFwb3NpdGlvbnNbY2hpbGQucGFyZW50XSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgY29uc3QgcHAgPSBwb3NpdGlvbnNbY2hpbGQucGFyZW50XTsKICAgICAgICAgICAgICBjb25zdCBjcCA9IHBvc2l0aW9uc1tjaGlsZC5pZF07CiAgICAgICAgICAgICAgY29uc3QgcHggPSBwcC54ICsgbm9kZVcvMjsKICAgICAgICAgICAgICBjb25zdCBweSA9IHBwLnkgKyBub2RlSDsKICAgICAgICAgICAgICBjb25zdCBjeCA9IGNwLnggKyBub2RlVy8yOwogICAgICAgICAgICAgIGNvbnN0IGN5ID0gY3AueTsKICAgICAgICAgICAgICBjb25zdCBteSA9IHB5ICsgKGN5LXB5KSowLjU7CiAgICAgICAgICAgICAgcmV0dXJuICg8ZyBrZXk9e2l9PgogICAgICAgICAgICAgICAgPGxpbmUgeDE9e3B4fSB5MT17cHl9IHgyPXtweH0geTI9e215fSBzdHJva2U9e0MuYkx9IHN0cm9rZVdpZHRoPSIxLjUiLz4KICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtweH0geTE9e215fSB4Mj17Y3h9IHkyPXtteX0gc3Ryb2tlPXtDLmJMfSBzdHJva2VXaWR0aD0iMS41Ii8+CiAgICAgICAgICAgICAgICA8bGluZSB4MT17Y3h9IHkxPXtteX0geDI9e2N4fSB5Mj17Y3l9IHN0cm9rZT17Qy5iTH0gc3Ryb2tlV2lkdGg9IjEuNSIvPgogICAgICAgICAgICAgIDwvZz4pOwogICAgICAgICAgICB9KX0KCiAgICAgICAgICAgIHsvKiBOb2RlcyAqL30KICAgICAgICAgICAge3RyZWVQZW9wbGUubWFwKHA9PnsKICAgICAgICAgICAgICBjb25zdCBwb3MgPSBwb3NpdGlvbnNbcC5pZF07CiAgICAgICAgICAgICAgaWYgKCFwb3MpIHJldHVybiBudWxsOwogICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gc2VsSWQgPT09IHAuaWQ7CiAgICAgICAgICAgICAgY29uc3QgaXNHYXAgICAgPSBwLnJvbGUgJiYgcC5yb2xlLmluY2x1ZGVzKCJOT1QgSU4gRE9DUyIpOwogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBrZXk9e3AuaWR9IHg9e3Bvcy54fSB5PXtwb3MueX0gd2lkdGg9e25vZGVXfSBoZWlnaHQ9e25vZGVIfT4KICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIKICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKT0+c2V0U2VsSWQoaXNBY3RpdmU/bnVsbDpwLmlkKX0KICAgICAgICAgICAgICAgICAgICBzdHlsZT17e3dpZHRoOiIxMDAlIixoZWlnaHQ6IjEwMCUiLAogICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzoiOHB4IDEwcHgiLGJvcmRlclJhZGl1czo2LGN1cnNvcjoicG9pbnRlciIsdHJhbnNpdGlvbjoiYWxsIC4ycyIsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IjEuNXB4IHNvbGlkICIrKGlzQWN0aXZlP3AuY29sb3I6aXNHYXA/Qy5kYSsiNDQiOnAuY29sb3IrIjMzIiksCiAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmlzQWN0aXZlP3AuY29sb3IrIjBhIjppc0dhcD9DLmRhKyIwNiI6IiNmZmYiLAogICAgICAgICAgICAgICAgICAgICAgYm94U2hhZG93OmlzQWN0aXZlPyIwIDJweCA4cHggcmdiYSgwLDAsMCwuMDgpIjoibm9uZSJ9fT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsZm9udFdlaWdodDo2MDAsY29sb3I6aXNHYXA/Qy5kYTpwLmNvbG9yLGxpbmVIZWlnaHQ6MS4yLG1hcmdpbkJvdHRvbToyfX0+e3AubmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OS41LGNvbG9yOkMudHhMfX0+e3AuYWdlID8gcC5hZ2UrIiB5cnMiIDogIiJ9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2ZvbnRTaXplOjksY29sb3I6aXNHYXA/Qy5kYTpDLnR4RixtYXJnaW5Ub3A6MSxsaW5lSGVpZ2h0OjEuMn19PntwLnJvbGV9PC9kaXY+CiAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pfQoKICAgICAgICAgICAgey8qIFNwb3VzZSBjb25uZWN0b3JzIC0gZm9yIGNoaWxkcmVuJ3Mgc3BvdXNlcyBvbmx5LCBub3QgZ2VuOjAgY291cGxlcyAqL30KICAgICAgICAgICAge3RyZWVTcG91c2VzLm1hcCgoc3AsaSk9PnsKICAgICAgICAgICAgICBjb25zdCByZWwgPSB0cmVlUGVvcGxlLmZpbmQocD0+cC5pZD09PXNwLnJlbHx8cC5pZD09PXNwLmlkKTsKICAgICAgICAgICAgICBpZiAoIXJlbCB8fCAhcG9zaXRpb25zW3JlbC5pZF0pIHJldHVybiBudWxsOwogICAgICAgICAgICAgIGlmIChyZWwuZ2VuID09PSAwKSByZXR1cm4gbnVsbDsgLy8gZ2VuOjAgY291cGxlcyBib3RoIGluIHRyZWVQZW9wbGUsIG5vIGNvbm5lY3RvciBuZWVkZWQKICAgICAgICAgICAgICBjb25zdCBycCA9IHBvc2l0aW9uc1tyZWwuaWRdOwogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBrZXk9e2l9IHg9e3JwLngrbm9kZVcrMTB9IHk9e3JwLnl9IHdpZHRoPXtub2RlV30gaGVpZ2h0PXtub2RlSH0+CiAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiCiAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3t3aWR0aDoiMTAwJSIsaGVpZ2h0OiIxMDAlIixwYWRkaW5nOiI4cHggMTBweCIsYm9yZGVyUmFkaXVzOjYsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IjEuNXB4IGRhc2hlZCAiK0MuYkwsYmFja2dyb3VuZDoiI2ZmZiJ9fT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEsZm9udFdlaWdodDo2MDAsY29sb3I6Qy50eE19fT57c3AubmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6OSxjb2xvcjpDLnR4RixtYXJnaW5Ub3A6Mn19PlNwb3VzZTwvZGl2PgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KX0KICAgICAgICAgIDwvc3ZnPgogICAgICAgIDwvZGl2PgoKICAgICAgICB7LyogU2VsZWN0ZWQgcGVyc29uIGRldGFpbCAqL30KICAgICAgICB7c2VsUCAmJiAoCiAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luOiIwIDE2cHggMTZweCIscGFkZGluZzoiMTRweCAxNnB4IixiYWNrZ3JvdW5kOkMuYmcsYm9yZGVyUmFkaXVzOjYsYm9yZGVyTGVmdDoiM3B4IHNvbGlkICIrc2VsUC5jb2xvcn19PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFdlaWdodDo2MDAsZm9udFNpemU6MTQsY29sb3I6c2VsUC5jb2xvcixtYXJnaW5Cb3R0b206OH19PntzZWxQLm5hbWV9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixmbGV4V3JhcDoid3JhcCIsZ2FwOjQsbWFyZ2luQm90dG9tOjh9fT4KICAgICAgICAgICAgICB7c2VsUC5yb2xlcy5tYXAoKHIsaSk9PnsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQWxlcnQgPSByLnN0YXJ0c1dpdGgoIk5PVCIpOwogICAgICAgICAgICAgICAgcmV0dXJuICg8ZGl2IGtleT17aX0gc3R5bGU9e3twYWRkaW5nOiIzcHggOHB4Iixib3JkZXJSYWRpdXM6Myxmb250U2l6ZToxMC41LAogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOmlzQWxlcnQ/Qy5kYUw6c2VsUC5jb2xvcisiMTEiLAogICAgICAgICAgICAgICAgICBjb2xvcjppc0FsZXJ0P0MuZGE6c2VsUC5jb2xvcixib3JkZXI6IjFweCBzb2xpZCAiKyhpc0FsZXJ0P0MuZGE6c2VsUC5jb2xvcikrIjIyIn19PgogICAgICAgICAgICAgICAgICB7cn0KICAgICAgICAgICAgICAgIDwvZGl2Pik7CiAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICB7c2VsUC5ub3RlcyAmJiA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTEuNSxjb2xvcjpDLnR4TSxsaW5lSGVpZ2h0OjEuNn19PntzZWxQLm5vdGVzfTwvZGl2Pn0KICAgICAgICAgIDwvZGl2PgogICAgICAgICl9CgogICAgICAgIHsvKiBBZHZpc29ycyAqL30KICAgICAgICB7dHJlZUFkdmlzb3JzLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgPGRpdiBzdHlsZT17e3BhZGRpbmc6IjEycHggMTZweCIsYm9yZGVyVG9wOiIxcHggc29saWQgIitDLmJMfX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMCxjb2xvcjpDLnR4TCx0ZXh0VHJhbnNmb3JtOiJ1cHBlcmNhc2UiLGxldHRlclNwYWNpbmc6MC44LG1hcmdpbkJvdHRvbTo4fX0+QWR2aXNvcnkgVGVhbTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheToiZmxleCIsZ2FwOjEwLGZsZXhXcmFwOiJ3cmFwIn19PgogICAgICAgICAgICAgIHt0cmVlQWR2aXNvcnMubWFwKChhLGkpPT4oCiAgICAgICAgICAgICAgICA8ZGl2IGtleT17aX0gc3R5bGU9e3twYWRkaW5nOiI4cHggMTJweCIsYmFja2dyb3VuZDpDLmJnLGJvcmRlclJhZGl1czo1LGJvcmRlcjoiMXB4IHNvbGlkICIrQy5iTH19PgogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7Zm9udFNpemU6MTIsZm9udFdlaWdodDo1MDAsY29sb3I6Qy50eH19PnthLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tmb250U2l6ZToxMC41LGNvbG9yOkMudHhMfX0+e2Eucm9sZX08L2Rpdj4KICAgICAgICAgICAgICAgICAge2Eubm90ZSYmPGRpdiBzdHlsZT17e2ZvbnRTaXplOjEwLGNvbG9yOkMudHhGLG1hcmdpblRvcDoyfX0+e2Eubm90ZX08L2Rpdj59CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICApfQogICAgICA8L0NkPgogICAgKX0KICA8L2Rpdj4pOwp9CgoKLyogPT09PT09PT09PT0gQVBQID09PT09PT09PT09ICovCmZ1bmN0aW9uIEFwcCgpIHsKICBjb25zdCBbdmlldywgc2V0Vmlld10gPSB1c2VTdGF0ZSgwKTsKICBjb25zdCBbYWssIHNldEFrXSA9IHVzZVN0YXRlKDApOwogIGNvbnN0IGdvID0gaSA9PiB7c2V0VmlldyhpKTtzZXRBayhrPT5rKzEpO307CiAgY29uc3QgdGFicyA9IFsiUGxhbiBTbmFwc2hvdCIsIkFzc2V0IE1hcCIsIldhdGVyZmFsbCIsIlN0cmF0ZWd5IiwiVHJ1c3QgQXJjaGl0ZWN0dXJlIiwiTWlsZXN0b25lcyIsIkZhbWlseSBUcmVlIl07CiAgY29uc3QgVmlld3MgPSBbVjEsVjIsVjMsVjQsVjUsVjYsVjddOwogIGNvbnN0IENvbXAgPSBWaWV3c1t2aWV3XTsKICByZXR1cm4gKAogICAgPGRpdiBzdHlsZT17e2ZvbnRGYW1pbHk6Iklvd2FuIE9sZCBTdHlsZSxQYWxhdGlubyBMaW5vdHlwZSxQYWxhdGlubyxHZW9yZ2lhLHNlcmlmIixiYWNrZ3JvdW5kOkMuYmcsbWluSGVpZ2h0OiIxMDB2aCIsY29sb3I6Qy50eH19PgogICAgICA8ZGl2IHN0eWxlPXt7YmFja2dyb3VuZDoiIzFjMmExZSIscGFkZGluZzoiMTNweCAyNHB4IixkaXNwbGF5OiJmbGV4IixqdXN0aWZ5Q29udGVudDoic3BhY2UtYmV0d2VlbiIsYWxpZ25JdGVtczoiY2VudGVyIn19PgogICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiJmbGV4IixhbGlnbkl0ZW1zOiJjZW50ZXIiLGdhcDoxNH19PgogICAgICAgICAgPGRpdiBzdHlsZT17e3dpZHRoOjI2LGhlaWdodDoyNixib3JkZXJSYWRpdXM6IjUwJSIsYm9yZGVyOiIxLjVweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4yNSkiLGRpc3BsYXk6ImZsZXgiLGFsaWduSXRlbXM6ImNlbnRlciIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciJ9fT48c3BhbiBzdHlsZT17e2ZvbnRTaXplOjExLGNvbG9yOiJyZ2JhKDI1NSwyNTUsMjU1LC43KSJ9fT5IPC9zcGFuPjwvZGl2PgogICAgICAgICAgPHNwYW4gc3R5bGU9e3tjb2xvcjoicmdiYSgyNTUsMjU1LDI1NSwuODUpIixmb250U2l6ZToxMy41LGZvbnRXZWlnaHQ6NTAwfX0+SGlnZ2lucyBMZWdhY3lNYXAgdjAuNzwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPXt7Y29sb3I6InJnYmEoMjU1LDI1NSwyNTUsLjQ1KSIsZm9udFNpemU6MTEuNSxmb250RmFtaWx5OiJzYW5zLXNlcmlmIn19PnsoZnVuY3Rpb24oKXt2YXIgcD1mYW1pbHkuY2xpZW50Lm5hbWUudHJpbSgpLnNwbGl0KC9ccysvKTtyZXR1cm4gKHAubGVuZ3RoPjE/cFtwLmxlbmd0aC0xXTpwWzBdKSsiIEZhbWlseSB8ICIrcmVwb3J0RGF0ZTt9KSgpfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT17e2JhY2tncm91bmQ6IiNmZmYiLGJvcmRlckJvdHRvbToiMXB4IHNvbGlkICIrQy5ib3JkZXIsZGlzcGxheToiZmxleCIscGFkZGluZzoiMCAxMnB4IixvdmVyZmxvd1g6ImF1dG8ifX0+CiAgICAgICAge3RhYnMubWFwKCh0LGkpPT4oCiAgICAgICAgICA8YnV0dG9uIGtleT17aX0gb25DbGljaz17KCk9PmdvKGkpfSBzdHlsZT17e3BhZGRpbmc6IjEzcHggMTZweCIsYmFja2dyb3VuZDoidHJhbnNwYXJlbnQiLGJvcmRlcjoibm9uZSIsYm9yZGVyQm90dG9tOnZpZXc9PT1pPyIycHggc29saWQgIitDLmFjOiIycHggc29saWQgdHJhbnNwYXJlbnQiLGNvbG9yOnZpZXc9PT1pP0MuYWM6Qy50eEwsY3Vyc29yOiJwb2ludGVyIixmb250U2l6ZToxMi41LGZvbnRGYW1pbHk6IkRNIFNhbnMsc2Fucy1zZXJpZiIsZm9udFdlaWdodDp2aWV3PT09aT82MDA6NDAwLHdoaXRlU3BhY2U6Im5vd3JhcCIsdHJhbnNpdGlvbjoiYWxsIC4ycyJ9fT4KICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tvcGFjaXR5OjAuMzUsbWFyZ2luUmlnaHQ6NCxmb250U2l6ZTo5LjV9fT57IjAiKyhpKzEpfTwvc3Bhbj57dH0KICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICkpfQogICAgICA8L2Rpdj4KICAgICAgPGRpdiBrZXk9e2FrfSBzdHlsZT17e2FuaW1hdGlvbjoidmYgLjNzIGVhc2UiLHBhZGRpbmc6IjI0cHggMjRweCA1NnB4IixtYXhXaWR0aDoxMDgwLG1hcmdpbjoiMCBhdXRvIn19PjxDb21wIC8+PC9kaXY+CiAgICAgIDxzdHlsZT57IkBrZXlmcmFtZXMgdmZ7ZnJvbXtvcGFjaXR5OjA7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoNXB4KX10b3tvcGFjaXR5OjE7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoMCl9fSBAa2V5ZnJhbWVzIHB1ezAlLDEwMCV7Ym94LXNoYWRvdzowIDAgMCAwIHJnYmEoMjYsOTIsNTgsLjEyKX01MCV7Ym94LXNoYWRvdzowIDAgMCA2cHggcmdiYSgyNiw5Miw1OCwuMDQpfX0gKntib3gtc2l6aW5nOmJvcmRlci1ib3h9IDo6LXdlYmtpdC1zY3JvbGxiYXJ7d2lkdGg6NXB4O2hlaWdodDo1cHh9IDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWJ7YmFja2dyb3VuZDoiK0MuYm9yZGVyKyI7Ym9yZGVyLXJhZGl1czozcHh9In08L3N0eWxlPgogICAgPC9kaXY+CiAgKTsKfQoKUmVhY3RET00uY3JlYXRlUm9vdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpKS5yZW5kZXIoUmVhY3QuY3JlYXRlRWxlbWVudChBcHApKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=';
const HEAD = atob(HEAD_B64);
const COMP = atob(COMP_B64);

const SAMPLE_DATA = `const { useState } = React;

/* --- WHO --- */
const family = {
  client: { name: "John Smith",  age: 55 },
  spouse: { name: "Jane Smith",  age: 52 },
  children: [
    { name: "Emily Smith", age: 28, relationship: "biological", spouse: null, gc: [] },
  ],
};

const assets = [
  { id:1, name:"Primary Residence",   value:1200000, type:"Real Estate",  owner:"joint",  category:"retitle",     liquid:false, basis:450000, mortgage:300000, note:"Main home.", action:"Record deed into trust." },
  { id:2, name:"Brokerage Account",   value:800000,  type:"Investment",   owner:"joint",  category:"retitle",     liquid:true,  note:"Re-title to trust.", action:"Contact brokerage." },
  { id:3, name:"401(k)",              value:650000,  type:"Retirement",   owner:"client", category:"beneficiary", liquid:false, beneficiary:"Spouse (primary), children (contingent)", benStatus:"update", note:"Update contingent beneficiary.", action:"Change contingent to trust." },
  { id:4, name:"Term Life Insurance", value:1000000, type:"Insurance",    owner:"client", category:"beneficiary", liquid:false, beneficiary:"Spouse (primary), children (contingent)", benStatus:"update", note:"Update contingent beneficiary.", action:"Change contingent to trust." },
  { id:5, name:"Cash / Checking",     value:120000,  type:"Cash",         owner:"joint",  category:"retitle",     liquid:true,  note:"Add trust as POD.", action:"Re-title or add POD." },
];

const totalEstate      = assets.reduce((s,a)=>s+a.value,0);
const mortgage         = assets.reduce((s,a)=>s+(a.mortgage||0),0);
const grossEquity      = totalEstate - mortgage;
const liquidVal        = assets.filter(a=>a.liquid).reduce((s,a)=>s+a.value,0);
const inTrustVal       = assets.filter(a=>a.category==="in-trust").reduce((s,a)=>s+a.value,0);
const needsRetitleVal  = assets.filter(a=>a.category==="retitle").reduce((s,a)=>s+a.value,0);
const benefDesigVal    = assets.filter(a=>a.category==="beneficiary").reduce((s,a)=>s+a.value,0);
const custodialVal     = assets.filter(a=>a.category==="custodial").reduce((s,a)=>s+a.value,0);
const benefNeedsUpdate = assets.filter(a=>a.category==="beneficiary"&&a.benStatus==="update").length;

const strategyScore  = 68;
const executionScore = 32;
const reportDate     = "February 2026";
const domicileState  = "Texas";
const cogSummary     = "Texas has no state estate tax. Planning focus is probate avoidance via a funded revocable trust and careful beneficiary designation alignment.";

const planProfile   = "Comprehensive Family Protection";
const planRationale = "Estate size and family structure point to a trust-centered plan.";

const headline = {
  title: "Your instincts are sound. The execution needs catching up.",
  body:  "You have the right framework in mind. What is missing is mostly paperwork: accounts not yet titled into the trust and beneficiary forms that name children directly instead of the trust.",
};

const foundationItems = [
  { t:"Revocable trust established",       n:"Core structure exists." },
  { t:"Life insurance in force",           n:"Coverage is adequate." },
  { t:"Retirement accounts funded",        n:"Spouse correctly named as primary beneficiary." },
];

const executionItems = [
  { t:"Most assets outside the trust",     n:"Brokerage and cash need re-titling." },
  { t:"Beneficiary designations stale",    n:"Contingent beneficiaries name children directly." },
  { t:"Documents more than 5 years old",   n:"POAs and healthcare directives need refreshing." },
];

const priorities = [
  { tier:"now",   label:"Act Now",       tierColor:"#b03a2e", tierBg:"#fbeae8", desc:"Real risk if delayed. Do this quarter.",
    items:[
      { title:"Re-title brokerage account into trust", value:800000, why:"Without this, the account goes through probate.", effort:"Call brokerage", est:"2 weeks" },
      { title:"Update beneficiary designations",       value:1650000, why:"Children named directly bypasses trust protections.", effort:"One form per account", est:"1-2 weeks" },
    ]},
  { tier:"year",  label:"This Year",     tierColor:"#b8860b", tierBg:"#fef8ec", desc:"Important but not emergency.",
    items:[
      { title:"Update trust provisions", value:null, why:"Trust predates current family picture.", effort:"Attorney engagement", est:"$6K-$12K" },
    ]},
  { tier:"later", label:"Future Review", tierColor:"#8a847a", tierBg:"#f6f4ef", desc:"Monitor and revisit.",
    items:[
      { title:"Annual gifting strategy", value:null, why:"Reduces estate over time.", effort:"Annual review", est:"Each year" },
    ]},
];

const documents = [
  { name:"Revocable Trust",       status:"outdated", year:2018, note:"Does not reflect current family." },
  { name:"Pour-Over Will",        status:"outdated", year:2018, note:null },
  { name:"Financial POA",         status:"outdated", year:2018, note:"Add digital asset provisions." },
  { name:"Healthcare Directive",  status:"outdated", year:2018, note:null },
];

const milestones = [
  { date:"2018",    label:"Estate plan established",          st:"done",     cat:"Documents", detail:"Trust, wills, POAs executed." },
  { date:"Q1 2026", label:"Comprehensive review begins",      st:"active",   cat:"Planning",  detail:"Most assets unfunded, docs aging." },
  { date:"Q1 2026", label:"Re-title accounts into trust",     st:"upcoming", cat:"Titling",   detail:"Brokerage and cash accounts." },
  { date:"Q2 2026", label:"Update trust and documents",       st:"upcoming", cat:"Documents", detail:"Attorney engagement." },
  { date:"Annual",  label:"Review trust and beneficiaries",   st:"future",   cat:"Planning",  detail:null },
];

const strategyRows = [
  { l:"Probate Avoidance",        cu:"Partial",              pr:"Full trust funding",       d:"Brokerage and cash need re-titling.", hl:true  },
  { l:"Beneficiary Designations", cu:"Children named directly", pr:"Trust as contingent",  d:"Change contingent to trust on all accounts.", hl:true  },
  { l:"Document Currency",        cu:"2018 docs",            pr:"Refreshed",                d:"POAs and directives need updating.", hl:false },
];

const waterfallConfig = {
  isMarried: true, hasStateTax: false, stateTaxNote: "",
  firstDeathFlow: "to_spouse",
  portabilityNote: "File Form 706 within 9 months to preserve portability.",
  fundingGapNote: "$1.92M in accounts still need re-titling.",
  secondDeathDistribution: "outright", subtrustsNote: "",
  adminCosts: 150000,
  beneficiaryColumns: [
    { label:"Children", people:["Emily Smith"], note:"Outright distribution per trust terms." },
  ],
};

const trustEntities = [
  { name:"Smith Family Revocable Trust", type:"Revocable Living Trust", established:"2018 (needs update)",
    grantor:"John and Jane Smith", trustee:"John and Jane Smith", successor:"Emily Smith",
    protector:null, beneficiaries:"Children equally",
    assetList:["No assets currently titled in trust"],
    totalValue:0, status:"outdated", color:"#b03a2e",
    provisions:[
      { label:"Current State", text:"Basic trust, no assets funded, needs restatement." },
    ],
  },
];

const treePeople = [
  { id:"client", name:"John Smith",  age:55, gen:0, role:"Grantor / Trustee", color:"#2a5a8c", roles:["Co-Grantor","Co-Trustee"], notes:"POA needs updating." },
  { id:"spouse", name:"Jane Smith",  age:52, gen:0, role:"Grantor / Trustee", color:"#6a4a8a", roles:["Co-Grantor","Primary beneficiary"], notes:"Primary beneficiary on all accounts." },
  { id:"child1", name:"Emily Smith", age:28, gen:1, role:"Beneficiary",        color:"#1a5c3a", roles:["Successor Trustee","Outright beneficiary"], notes:"Named successor trustee." },
];
const treeSpouses  = [];
const treeAdvisors = [];

const ilitAnalysis = {
  situation: "Client holds term life insurance. Estate is under federal exemption.",
  pros: [
    { label:"Removes death benefit from estate", text:"Useful if estate grows beyond exemption." },
  ],
  cons: [
    { label:"Irrevocable", text:"Cannot be modified after creation." },
    { label:"Estate under exemption", text:"No immediate tax benefit." },
  ],
  recommendation: "Lean against an ILIT at this time. Revisit if estate grows significantly.",
};

const higginsNote = "The picture here is an encouraging one. The architecture is sound and what remains is a focused quarter of administrative work.";
`;

function validate(text) {
  const el = document.getElementById('validation');
  const btn = document.getElementById('generateBtn');
  if (!text.trim()) {
    el.textContent = '';
    el.className = 'validation';
    btn.disabled = true;
    return false;
  }
  if (!text.includes('const family')) {
    el.textContent = '⚠ Missing family data — paste the full data block from Higgins.';
    el.className = 'validation error';
    btn.disabled = true;
    return false;
  }
  if (!text.includes('const assets')) {
    el.textContent = '⚠ Missing assets data — paste the full data block from Higgins.';
    el.className = 'validation error';
    btn.disabled = true;
    return false;
  }
  if (!text.includes('waterfallConfig')) {
    el.textContent = '⚠ Missing waterfallConfig — paste the full data block from Higgins.';
    el.className = 'validation warn';
    btn.disabled = false;
    return true;
  }
  el.textContent = '✓ Data block looks good.';
  el.className = 'validation ok';
  btn.disabled = false;
  return true;
}

document.getElementById('dataInput').addEventListener('input', function() {
  validate(this.value);
});

function loadSample() {
  document.getElementById('dataInput').value = SAMPLE_DATA;
  validate(SAMPLE_DATA);
}

function generate() {
  const data = document.getElementById('dataInput').value.trim();
  if (!validate(data)) return;

  // Assemble the full HTML
    // Sanitize non-ASCII characters that Babel cannot parse
  const sanitized = data
    .replace(/[\u2018\u2019\u201a\u201b]/g, "'")   // curly single quotes -> '
    .replace(/[\u201c\u201d\u201e\u201f]/g, '"')   // curly double quotes -> "
    .replace(/[\u2010\u2011\u2012\u2013\u2014\u2015]/g, '-') // hyphens/dashes -> -
    .replace(/[\u2026]/g, '...')                       // ellipsis -> ...
    .replace(/[\u00a0]/g, ' ')                         // non-breaking space -> space
    .replace(/[^\x00-\x7F]/g, '');                   // strip any remaining non-ASCII
  // Normalize priorities: Higgins sometimes outputs it as an object instead of array
  let fixed = sanitized;
  const priObjMatch = fixed.match(/const priorities\s*=\s*\{[\s\S]*?^\};/m);
  if (priObjMatch && !fixed.match(/const priorities\s*=\s*\[/)) {
    const objStr = priObjMatch[0];
    const tierMap = {tiernow:'now', tieryear:'year', tierlater:'later'};
    const tierRegex = /\b(tiernow|tieryear|tierlater)\s*:\s*(\{)/g;
    let arrItems = [];
    let m;
    while ((m = tierRegex.exec(objStr)) !== null) {
      const tierKey = m[1];
      const tierStr = tierMap[tierKey] || tierKey.replace('tier','');
      // find matching closing brace
      let depth = 0, pos = m.index + m[0].length - 1;
      const start = pos;
      while (pos < objStr.length) {
        if (objStr[pos] === '{') depth++;
        else if (objStr[pos] === '}') { depth--; if (depth === 0) break; }
        pos++;
      }
      let body = objStr.substring(start, pos + 1);
      // inject tier field
      body = body.replace('{', '{ tier: "' + tierStr + '", ');
      arrItems.push(body);
    }
    if (arrItems.length > 0) {
      const newPri = 'const priorities = [\n  ' + arrItems.join(',\n  ') + '\n]';
      fixed = fixed.replace(objStr, newPri);
    }
  }
  // Normalize estTime -> est
  fixed = fixed.replace(/\bestTime\b/g, 'est');

  const fullHTML = HEAD + fixed + '\n\n' + COMP;

  // Create blob and download link
  const blob = new Blob([fullHTML], { type: 'text/html' });
  const url  = URL.createObjectURL(blob);

  // Get client name for filename
  const nameMatch = data.match(/client:\s*\{\s*name:\s*"([^"]+)"/);
  const lastName  = nameMatch ? nameMatch[1].split(' ').pop() : 'Client';
  const filename  = lastName + '-LegacyMap.html';

  const link = document.getElementById('downloadLink');
  link.href     = url;
  link.download = filename;

  document.getElementById('successCard').classList.add('visible');
  document.getElementById('successCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}
</script>

</body>
</html>